<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case Opening Roulette</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Mobile container */
        @media (max-width: 768px) {
            .container {
                padding: 10px 5px;
            }
            
            .cases-title {
                font-size: 20px !important;
                margin-bottom: 15px !important;
                margin-top: 10px !important;
                letter-spacing: 1px !important;
            }
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .header h1 {
            flex-grow: 1;
            text-align: center;
            margin: 0;
        }

        .profile-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .profile-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            border: 3px solid #ffd700;
            background-size: cover;
            background-position: center;
            flex-shrink: 0;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
        }



        .avatar-upload-input {
            display: none;
        }

        /* Mobile profile optimizations */
        @media (max-width: 768px) {
            .profile-avatar {
                width: 45px;
                height: 45px;
                font-size: 18px;
                border: 2px solid #ffd700;
            }
            
            .profile-section {
                gap: 10px !important;
                justify-content: center !important; /* Центрируем профиль */
            }
            
            .currency {
                font-size: 18px !important;
            }
            
            .profile-section button {
                padding: 8px 16px !important;
                font-size: 12px !important;
            }
            
            #debtStatus {
                font-size: 9px !important;
            }
            
            .header {
                margin-bottom: 15px !important;
                margin-top: -20px !important; /* Поднимаем профиль выше */
                padding: 0 10px;
                justify-content: center !important; /* Центрируем весь header */
                flex-direction: column !important; /* Вертикальное расположение */
                align-items: center !important;
                gap: 10px !important;
            }
            
            .header h1 {
                font-size: 20px !important;
                margin: 0 !important;
                order: 2; /* Заголовок вторым */
            }
            
            .header .profile-section {
                order: 1; /* Профиль первым */
                margin-bottom: 0 !important;
            }
        }

        .currency {
            font-size: 24px;
            font-weight: bold;
            color: #ffd700;
        }

        #balance {
            cursor: pointer;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            padding: 2px 5px;
            border-radius: 3px;
            transition: background-color 0.2s;
        }

        #balance:hover {
            background-color: rgba(255, 215, 0, 0.1);
        }

        .currency::after {
            content: ' ꙮ';
        }

        .winglist-section {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            min-width: 240px;
            max-width: 280px;
            z-index: 1000;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        /* Mobile optimizations */
        @media (max-width: 768px) {
            .winglist-section {
                position: relative; /* Изменяем с absolute на relative */
                top: auto;
                left: auto;
                margin: 10px auto 20px auto; /* Центрируем и добавляем отступы */
                padding: 8px 10px;
                min-width: 280px; /* Увеличиваем ширину */
                max-width: 320px;
                border-radius: 10px;
            }
            
            .winglist-title {
                font-size: 14px !important;
                margin-bottom: 5px !important;
            }
            
            .winglist-subtitle {
                font-size: 10px !important;
                margin-bottom: 8px !important;
            }
            
            .winglist-item {
                padding: 3px !important;
                margin: 2px 0 !important;
                font-size: 9px !important;
            }
            
            .winglist-toggle {
                padding: 3px 6px !important;
                font-size: 10px !important;
                margin-top: 5px !important;
            }
            
            .winglist-items {
                max-height: 60px !important;
            }
            
            .winglist-items.expanded {
                max-height: 150px !important;
            }
        }

        .winglist-title {
            font-size: 22px;
            font-weight: bold;
            color: #ffd700;
            text-align: center;
            margin-bottom: 12px;
        }

        .winglist-subtitle {
            font-size: 15px;
            color: #fff;
            text-align: center;
            margin-bottom: 18px;
        }

        .winglist-items {
            max-height: 140px;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .winglist-items.expanded {
            max-height: 350px;
            overflow-y: auto;
        }

        .winglist-toggle {
            text-align: center;
            margin-top: 12px;
            padding: 6px 12px;
            background: rgba(255, 215, 0, 0.2);
            border-radius: 10px;
            cursor: pointer;
            font-size: 13px;
            color: #ffd700;
            border: 1px solid rgba(255, 215, 0, 0.3);
            transition: all 0.2s ease;
            user-select: none;
        }

        .winglist-toggle:hover {
            background: rgba(255, 215, 0, 0.3);
            transform: translateY(-1px);
        }

        .winglist-item {
            padding: 8px;
            margin: 4px 0;
            background: rgba(255,255,255,0.1);
            border-radius: 6px;
            font-size: 12px;
            opacity: 1;
            transition: opacity 0.2s ease;
        }

        .winglist-item.hidden {
            display: none;
        }

        .promo-section {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            margin-bottom: 30px;
            margin-left: 0; /* Убираем сдвиг - центрируем промо-блок */
        }

        /* Mobile promo section */
        @media (max-width: 768px) {
            .promo-section {
                flex-direction: column;
                gap: 8px;
                margin-bottom: 15px;
                padding: 0 10px;
                margin-left: 0; /* Убираем сдвиг на мобильных */
                margin-top: 10px; /* Опускаем промо-блок на 10px вниз */
            }
            
            .promo-frame {
                padding: 8px 16px;
                min-width: 100px;
                transform: none;
            }
            
            .promo-frame h2 {
                font-size: 14px;
            }
            
            .promo-code-frame {
                padding: 8px 16px;
                min-width: 100px;
            }
            
            .promo-code-title {
                font-size: 12px;
            }
            
            .promo-code {
                font-size: 16px;
            }
            
            .countdown-timer {
                font-size: 14px;
                padding: 6px 12px;
            }
        }

        .promo-frame {
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            border-radius: 15px;
            padding: 12px 24px;
            text-align: center;
            border: 2px solid #ffd700;
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.3);
            display: inline-block;
            width: fit-content;
            min-width: 140px;
            transform: translateY(-12px) translateX(5px);
        }

        .promo-frame h2 {
            font-size: 16px;
            font-weight: bold;
            color: white;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            white-space: nowrap;
            letter-spacing: 0.5px;
            line-height: 1.2;
        }

        .promo-code-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .promo-code-frame {
            background: linear-gradient(145deg, #27ae60, #229954);
            border-radius: 15px;
            padding: 12px 24px;
            text-align: center;
            border: 2px solid #2ecc71;
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
            width: fit-content;
            margin: 0 auto;
            min-width: 140px;
        }

        .promo-code-title {
            font-size: 14px;
            color: #fff;
            margin-bottom: 2px;
            text-align: center;
            line-height: 1.2;
        }

        .promo-code {
            font-size: 18px;
            font-weight: bold;
            color: white;
            margin: 0;
            letter-spacing: 1px;
        }

        .countdown-timer {
            font-size: 18px;
            font-weight: bold;
            color: #e74c3c;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 20px;
            border-radius: 10px;
            border: 1px solid #e74c3c;
        }

        .cases-title {
            text-align: center;
            font-size: 28px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 30px;
            margin-top: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .cases-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Mobile cases grid */
        @media (max-width: 768px) {
            .cases-section {
                grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
                gap: 10px;
                margin-bottom: 20px;
                padding: 0 10px;
            }
            
            .case {
                padding: 15px;
                min-height: 140px;
            }
            
            .case-image {
                width: 100px;
                height: 70px;
                margin-bottom: 10px;
            }
            
            .case-name {
                font-size: 14px;
                margin-bottom: 6px;
            }
            
            .case-price {
                font-size: 14px;
                padding: 6px 12px;
            }
        }

        .case {
            background: linear-gradient(145deg, #2c3e50, #34495e);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 2px solid #e74c3c;
            position: relative;
            overflow: hidden;
            min-height: 180px;
        }

        .case.hidden {
            display: none;
        }

        .case:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.4);
            border-color: #c0392b;
        }
        
        /* 💡 СТИЛИ ДЛЯ ВСПЛЫВАЮЩИХ ПОДСКАЗОК КЕЙСОВ */
        .case-tooltip {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%) translateY(-100%);
            background: linear-gradient(135deg, #2c3e50, #34495e);
            border: 2px solid #e74c3c;
            border-radius: 12px;
            padding: 15px;
            color: white;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease, transform 0.3s ease;
            box-shadow: 0 8px 25px rgba(0,0,0,0.6);
            min-width: 200px;
            text-align: center;
        }
        
        .case:hover .case-tooltip {
            opacity: 1;
            transform: translateX(-50%) translateY(-100%) translateY(-5px);
        }
        
        .case-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -8px;
            width: 0;
            height: 0;
            border-top: 8px solid #e74c3c;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
        }
        
        /* 📱 МОБИЛЬНАЯ АДАПТАЦИЯ ПОДСКАЗОК */
        @media (max-width: 768px) {
            .case-tooltip {
                font-size: 10px;
                padding: 10px;
                min-width: 160px;
                line-height: 1.3;
            }
            
            .case-tooltip::after {
                border-top: 6px solid #e74c3c;
                border-left: 6px solid transparent;
                border-right: 6px solid transparent;
                margin-left: -6px;
            }
        }

        .case.disabled {
            opacity: 0.6;
            cursor: pointer;
        }

        .case-image {
            width: 140px;
            height: 100px;
            background: linear-gradient(45deg, #3498db, #2980b9);
            border-radius: 10px;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            background-size: cover;
            background-position: center center; /* Центрируем изображения идеально */
            transition: background-image 0.3s ease;
            border: 1px solid #34495e;
        }

        .case-name {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #ecf0f1;
        }

        .case-price {
            color: #f39c12;
            font-size: 18px;
            font-weight: bold;
            background: rgba(52, 73, 94, 0.8);
            padding: 8px 15px;
            border-radius: 20px;
            display: inline-block;
        }

        .roulette-section {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            z-index: 9999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            padding: 20px;
            box-sizing: border-box;
        }

        .roulette-section.active {
            display: flex;
        }

        .roulette-modal {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            border-radius: 20px;
            padding: 40px;
            max-width: 800px;
            width: 100%;
            position: relative;
            border: 3px solid #e74c3c;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .case.shake {
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-3px); }
            20%, 40%, 60%, 80% { transform: translateX(3px); }
        }

        .roulette-result {
            text-align: center;
            margin-top: 30px;
            display: none;
        }

        .roulette-result.show {
            display: block;
        }

        .result-item-image {
            width: 150px;
            height: 150px;
            margin: 0 auto 20px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            background-size: cover;
            background-position: center;
            transform: scale(1);
            transition: transform 0.5s ease;
        }

        .result-item-image.animate {
            transform: scale(1.2);
        }

        .roulette-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 20px;
        }

        .roulette-container {
            position: relative;
            width: 100%;
            height: 200px;
            overflow: hidden;
            border-radius: 15px;
            background: linear-gradient(90deg, #2c3e50, #34495e);
            margin-bottom: 20px;
        }

        .roulette-strip {
            display: flex;
            height: 100%;
            transition: none; /* Убираем базовую анимацию, будем устанавливать динамически */
        }

        .roulette-item {
            min-width: 150px;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-right: 2px solid #2c3e50;
            padding: 10px;
            position: relative;
            flex-shrink: 0;
        }

        .roulette-item.loss { background: linear-gradient(145deg, #e74c3c, #c0392b); }      /* 🔴 Убыточные */
        .roulette-item.breakeven { background: linear-gradient(145deg, #f1c40f, #f39c12); } /* 🟡 Окупаемые */
        .roulette-item.profit { background: linear-gradient(145deg, #27ae60, #229954); }   /* 🟢 Прибыльные */
        .roulette-item.jackpot { background: linear-gradient(145deg, #8e44ad, #732d91); }  /* 💎 Джекпоты */
        
        /* Старые цвета для совместимости */
        .roulette-item.common { background: linear-gradient(145deg, #e74c3c, #c0392b); }
        .roulette-item.rare { background: linear-gradient(145deg, #f1c40f, #f39c12); }
        .roulette-item.epic { background: linear-gradient(145deg, #27ae60, #229954); }
        .roulette-item.legendary { background: linear-gradient(145deg, #8e44ad, #732d91); }

        .roulette-pointer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 4px;
            height: 180px;
            background: #e74c3c;
            z-index: 10;
            border-radius: 2px;
        }

        .roulette-pointer::before {
            content: '';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 15px solid #e74c3c;
        }

        .item-result {
            text-align: center;
            display: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
        }

        .item-result.show {
            display: block;
        }

        .item-image {
            width: 120px;
            height: 120px;
            margin: 0 auto 20px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            background-size: cover;
            background-position: center;
        }

        .item-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .item-value {
            font-size: 18px;
            color: #ffd700;
            margin-bottom: 20px;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .btn-primary {
            background: linear-gradient(145deg, #3498db, #2980b9);
            color: white;
        }

        .btn-success {
            background: linear-gradient(145deg, #27ae60, #229954);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(145deg, #f39c12, #d68910);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .inventory {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        /* Mobile inventory */
        @media (max-width: 768px) {
            .inventory {
                padding: 15px 10px;
                margin-top: 15px;
                border-radius: 10px;
            }
            
            .inventory h3 {
                font-size: 18px;
                margin-bottom: 10px;
            }
            
            .inventory-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
                gap: 10px;
            }
            
            .inventory-item {
                padding: 10px;
                font-size: 10px;
                min-height: 100px;
            }
            
            .inventory-item-icon {
                width: 50px !important;
                height: 50px !important;
                font-size: 20px !important;
                margin-bottom: 6px !important;
            }
        }

        .inventory h3 {
            margin-bottom: 15px;
            text-align: center;
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
        }

        .inventory-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 12px;
            text-align: center;
            font-size: 12px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 120px;
        }

        .inventory-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .item-menu-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            z-index: 10000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            padding: 20px;
            box-sizing: border-box;
        }

        .item-menu-modal.active {
            display: flex;
        }

        .item-menu-container {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 100%;
            position: relative;
            border: 3px solid #e74c3c;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            text-align: center;
        }

        .item-menu-image {
            width: 120px;
            height: 120px;
            margin: 0 auto 20px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            background-size: cover;
            background-position: center;
        }

        .item-menu-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .profile-menu-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            z-index: 10001;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            padding: 20px;
            box-sizing: border-box;
        }

        .profile-menu-modal.active {
            display: flex;
        }

        .profile-menu-container {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            position: relative;
            border: 3px solid #e74c3c;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            text-align: center;
        }

        .profile-menu-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            border: 3px solid #ffd700;
            background-size: cover;
            background-position: center;
            margin: 0 auto 20px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .profile-menu-avatar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1;
        }

        .profile-menu-avatar::after {
            content: '📷';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 30px;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 2;
            pointer-events: none;
        }

        .profile-menu-avatar:hover::before {
            opacity: 1;
        }

        .profile-menu-avatar:hover::after {
            opacity: 1;
        }

        .profile-menu-avatar:hover {
            transform: scale(1.05);
        }

        .profile-input-group {
            margin: 20px 0;
            text-align: left;
        }

        .profile-input-group label {
            display: block;
            color: white;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .profile-input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #34495e;
            border-radius: 8px;
            background: #2c3e50;
            color: white;
            font-size: 16px;
            box-sizing: border-box;
        }

        .profile-input-group input:focus {
            outline: none;
            border-color: #e74c3c;
        }

        .promocode-input-container {
            position: relative;
            width: 100%;
        }

        .promocode-input-container input {
            padding-right: 50px !important;
        }

        .promocode-submit-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: #f39c12;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            font-size: 16px;
            transition: all 0.2s ease;
        }

        .promocode-submit-btn:hover {
            background: #d68910;
            transform: translateY(-50%) scale(1.1);
        }

        .promocode-submit-btn:active {
            transform: translateY(-50%) scale(0.95);
        }

        .profile-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }



        .inventory-item-icon {
            width: 40px;
            height: 40px;
            margin: 0 auto 5px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            background-size: cover;
            background-position: center;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .spinning {
            animation: spin 0.5s linear infinite;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        @keyframes jumpscareShake {
            0%, 100% { 
                transform: translate(-50%, -50%) translate(0, 0) rotate(0deg) !important; 
            }
            5% { 
                transform: translate(-50%, -50%) translate(-12px, -8px) rotate(-3deg) !important; 
            }
            10% { 
                transform: translate(-50%, -50%) translate(10px, -12px) rotate(2deg) !important; 
            }
            15% { 
                transform: translate(-50%, -50%) translate(-8px, 10px) rotate(-2deg) !important; 
            }
            20% { 
                transform: translate(-50%, -50%) translate(14px, 8px) rotate(3deg) !important; 
            }
            25% { 
                transform: translate(-50%, -50%) translate(-10px, -6px) rotate(-1deg) !important; 
            }
            30% { 
                transform: translate(-50%, -50%) translate(8px, -14px) rotate(2deg) !important; 
            }
            35% { 
                transform: translate(-50%, -50%) translate(-14px, 12px) rotate(-3deg) !important; 
            }
            40% { 
                transform: translate(-50%, -50%) translate(12px, 6px) rotate(2deg) !important; 
            }
            45% { 
                transform: translate(-50%, -50%) translate(-6px, -10px) rotate(-1deg) !important; 
            }
            50% { 
                transform: translate(-50%, -50%) translate(16px, -8px) rotate(3deg) !important; 
            }
            55% { 
                transform: translate(-50%, -50%) translate(-12px, 14px) rotate(-2deg) !important; 
            }
            60% { 
                transform: translate(-50%, -50%) translate(8px, -6px) rotate(1deg) !important; 
            }
            65% { 
                transform: translate(-50%, -50%) translate(-16px, 10px) rotate(-3deg) !important; 
            }
            70% { 
                transform: translate(-50%, -50%) translate(14px, -12px) rotate(2deg) !important; 
            }
            75% { 
                transform: translate(-50%, -50%) translate(-8px, 8px) rotate(-1deg) !important; 
            }
            80% { 
                transform: translate(-50%, -50%) translate(10px, -14px) rotate(2deg) !important; 
            }
            85% { 
                transform: translate(-50%, -50%) translate(-14px, 6px) rotate(-2deg) !important; 
            }
            90% { 
                transform: translate(-50%, -50%) translate(12px, -10px) rotate(1deg) !important; 
            }
            95% { 
                transform: translate(-50%, -50%) translate(-6px, 12px) rotate(-1deg) !important; 
            }
        }

        .roulette-title {
            text-align: center;
            font-size: 24px;
            margin-bottom: 20px;
            color: #ffd700;
        }
        
        @keyframes bannerPulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 5px 20px rgba(231, 76, 60, 0.4);
            }
            50% { 
                transform: scale(1.02);
                box-shadow: 0 8px 30px rgba(231, 76, 60, 0.7);
            }
        }
    </style>
</head>
<body>
    <div class="winglist-section">
        <div class="winglist-title">WINGLIST</div>
        <div class="winglist-subtitle">У нас выигрывают!</div>
        <div class="winglist-items" id="winglist-items"></div>
        <div class="winglist-toggle" id="winglist-toggle" onclick="toggleWinglist()" style="display: none;">
            Показать все ▼
        </div>
    </div>

    <div class="container">
        <header class="header">
            <div></div>
            <div></div>
            <div class="profile-section">
                <div class="profile-avatar" id="profileAvatar" onclick="handleAvatarClick()">👤</div>
                <input type="file" class="avatar-upload-input" id="avatarUploadInput" accept="image/*" onchange="handleAvatarUpload(event)">
                <div style="display: flex; flex-direction: column; align-items: center; gap: 8px;">
                    <div class="currency">Баланс: <span id="balance" onclick="handleBalanceClick(event)" title="Тройной клик для редактирования">1000</span></div>
                    <button id="debtButton" onclick="takeDebt()" style="
                        background: linear-gradient(145deg, #e74c3c, #c0392b);
                        color: white;
                        border: none;
                        padding: 6px 12px;
                        border-radius: 6px;
                        font-size: 12px;
                        font-weight: bold;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        box-shadow: 0 2px 5px rgba(0,0,0,0.3);
                        white-space: nowrap;
                    " onmouseover="this.style.transform='translateY(-1px)'" onmouseout="this.style.transform='translateY(0)'">
                        💰 Взять госдолг
                    </button>
                    <div id="debtStatus" style="
                        font-size: 11px;
                        color: #ff6b6b;
                        text-align: center;
                        display: none;
                        line-height: 1.2;
                    "></div>
                </div>
            </div>
        </header>

        <div class="promo-section">
            <div class="promo-frame">
                <h2>+30% НА СЧЁТ</h2>
            </div>
            <div class="promo-code-section">
                <div class="promo-code-title">Используй промокод!</div>
                <div class="promo-code-frame">
                    <div class="promo-code">GLISTOK</div>
                </div>
                <div class="countdown-timer" id="countdownTimer">03:25:00</div>
            </div>
        </div>

        <!-- 🚫 БАННЕР БЛОКИРОВКИ КЕЙСОВ -->
        <div id="blockBanner" style="
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            border: 3px solid #fff;
            border-radius: 15px;
            padding: 20px;
            margin: 20px auto;
            max-width: 600px;
            text-align: center;
            display: none;
            animation: bannerPulse 2s ease-in-out infinite;
            box-shadow: 0 5px 20px rgba(231, 76, 60, 0.4);
        ">
            <h2 style="color: #fff; font-size: 24px; margin-bottom: 15px;">🚨 БЛОКИРОВКА АКТИВНА 🚨</h2>
            <p id="blockMessage" style="color: #fff; font-size: 18px; margin-bottom: 20px; line-height: 1.4;"></p>
            <button id="repentButton" onclick="repent()" style="
                background: linear-gradient(145deg, #27ae60, #229954);
                color: white;
                border: none;
                padding: 12px 25px;
                border-radius: 10px;
                font-size: 16px;
                font-weight: bold;
                cursor: pointer;
                margin: 5px;
                transition: all 0.3s ease;
                display: none;
            " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                🙏 ПОКАЯТЬСЯ
            </button>

        </div>

        <div class="cases-title">СЕРИЙНЫЕ КЕЙСЫ</div>
        <!-- 🖥️ ПОДСКАЗКА ДЛЯ КОМПЬЮТЕРА -->
        <div style="
            text-align: center;
            color: #95a5a6;
            font-size: 14px;
            margin-bottom: 20px;
            line-height: 1.3;
        " id="desktop-hint">
            💡 <strong>Клик</strong> - открыть кейс • <strong>Наведение</strong> - шансы • <strong>ПКМ</strong> - все дропы
        </div>
        
        <!-- 📱 ПОДСКАЗКА ДЛЯ МОБИЛЬНЫХ -->
        <div style="
            text-align: center;
            color: #95a5a6;
            font-size: 12px;
            margin-bottom: 15px;
            line-height: 1.3;
            display: none;
        " id="mobile-hint">
            📱 <strong>Тап</strong> - открыть кейс • <strong>Удержание</strong> - посмотреть дропы
        </div>
        <div class="cases-section">
            <div class="case" data-case="1" data-price="120">
                <div class="case-image" data-case-num="1"></div>
                <div class="case-name">Хуюнтик</div>
                <div class="case-price">120 ꙮ</div>
            </div>
            <div class="case" data-case="2" data-price="200">
                <div class="case-image" data-case-num="2"></div>
                <div class="case-name">Кизик</div>
                <div class="case-price">200 ꙮ</div>
            </div>
            <div class="case" data-case="3" data-price="150">
                <div class="case-image" data-case-num="3"></div>
                <div class="case-name">Жало</div>
                <div class="case-price">150 ꙮ</div>
            </div>
            <div class="case" data-case="4" data-price="300">
                <div class="case-image" data-case-num="4"></div>
                <div class="case-name">Шер</div>
                <div class="case-price">300 ꙮ</div>
            </div>
            <div class="case" data-case="5" data-price="130">
                <div class="case-image" data-case-num="5"></div>
                <div class="case-name">Глист</div>
                <div class="case-price">130 ꙮ</div>
            </div>
            <div class="case" data-case="6" data-price="100">
                <div class="case-image" data-case-num="6"></div>
                <div class="case-name">Меофен</div>
                <div class="case-price">100 ꙮ</div>
            </div>
            <div class="case" data-case="7" data-price="250">
                <div class="case-image" data-case-num="7"></div>
                <div class="case-name">ЧВК</div>
                <div class="case-price">250 ꙮ</div>
            </div>
            <div class="case" data-case="8" data-price="180">
                <div class="case-image" data-case-num="8"></div>
                <div class="case-name">Берег</div>
                <div class="case-price">180 ꙮ</div>
            </div>
            <div class="case" data-case="9" data-price="220">
                <div class="case-image" data-case-num="9"></div>
                <div class="case-name">Молот</div>
                <div class="case-price">220 ꙮ</div>
            </div>
            <div class="case" data-case="10" data-price="160">
                <div class="case-image" data-case-num="10"></div>
                <div class="case-name">Вихрь</div>
                <div class="case-price">160 ꙮ</div>
            </div>
            <div class="case" data-case="11" data-price="350">
                <div class="case-image" data-case-num="11"></div>
                <div class="case-name">Призрак</div>
                <div class="case-price">350 ꙮ</div>
            </div>
            <div class="case" data-case="12" data-price="290">
                <div class="case-image" data-case-num="12"></div>
                <div class="case-name">Лёд</div>
                <div class="case-price">290 ꙮ</div>
            </div>
            <div class="case" data-case="13" data-price="400">
                <div class="case-image" data-case-num="13"></div>
                <div class="case-name">Огонь</div>
                <div class="case-price">400 ꙮ</div>
            </div>
            <div class="case" data-case="14" data-price="320">
                <div class="case-image" data-case-num="14"></div>
                <div class="case-name">Тень</div>
                <div class="case-price">320 ꙮ</div>
            </div>
            <div class="case" data-case="15" data-price="270">
                <div class="case-image" data-case-num="15"></div>
                <div class="case-name">Свет</div>
                <div class="case-price">270 ꙮ</div>
            </div>
            <div class="case" data-case="16" data-price="500">
                <div class="case-image" data-case-num="16"></div>
                <div class="case-name">Хаос</div>
                <div class="case-price">500 ꙮ</div>
            </div>
            <div class="case" data-case="17" data-price="450">
                <div class="case-image" data-case-num="17"></div>
                <div class="case-name">Порядок</div>
                <div class="case-price">450 ꙮ</div>
            </div>
            <div class="case" data-case="18" data-price="380">
                <div class="case-image" data-case-num="18"></div>
                <div class="case-name">Время</div>
                <div class="case-price">380 ꙮ</div>
            </div>
            <div class="case" data-case="19" data-price="600">
                <div class="case-image" data-case-num="19"></div>
                <div class="case-name">Космос</div>
                <div class="case-price">600 ꙮ</div>
            </div>
            <div class="case" data-case="20" data-price="750">
                <div class="case-image" data-case-num="20"></div>
                <div class="case-name">Вечность</div>
                <div class="case-price">750 ꙮ</div>
            </div>
        </div>

        <div class="roulette-section" id="rouletteSection">
            <div class="roulette-modal">
                <div class="roulette-title">🎰 Открываем кейс... 🎰</div>
                <div class="roulette-container">
                    <div class="roulette-strip" id="rouletteStrip"></div>
                    <div class="roulette-pointer"></div>
                </div>
                <div class="roulette-result" id="rouletteResult">
                    <div class="result-item-image" id="resultItemImage"></div>
                    <div class="item-name" id="resultItemName"></div>
                    <div class="item-value" id="resultItemValue"></div>
                    <div class="roulette-buttons">
                        <button class="btn btn-success" onclick="keepItem()">Оставить предмет</button>
                        <button class="btn btn-warning" onclick="sellItem()">Продать предмет</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="item-result" id="itemResult">
            <div class="item-image" id="itemImage"></div>
            <div class="item-name" id="itemName"></div>
            <div class="item-value" id="itemValue"></div>
            <div class="action-buttons">
                <button class="btn btn-success" onclick="keepItem()">Оставить предмет</button>
                <button class="btn btn-warning" onclick="sellItem()">Продать предмет</button>
            </div>
        </div>

        <div class="inventory">
            <h3>🎒 Ваш инвентарь</h3>
            <div class="inventory-grid" id="inventoryGrid">
                <div class="inventory-item">
                    <div class="inventory-item-icon" style="background: #95a5a6;">🔧</div>
                    <div>Стартовый инструмент</div>
                </div>
            </div>
        </div>

        <div class="item-menu-modal" id="itemMenuModal">
            <div class="item-menu-container">
                <div class="item-menu-image" id="itemMenuImage"></div>
                <div class="item-name" id="itemMenuName"></div>
                <div class="item-value" id="itemMenuValue"></div>
                <div class="item-menu-buttons">
                    <button class="btn btn-warning" onclick="sellItemFromMenu()">Продать предмет</button>
                    <button class="btn btn-primary" onclick="closeItemMenu()">Отмена</button>
                </div>
            </div>
        </div>

        <div class="profile-menu-modal" id="profileMenuModal">
            <div class="profile-menu-container">
                <h3 style="color: #ffd700; margin-bottom: 20px;">Настройки профиля</h3>
                <div class="profile-menu-avatar" id="profileMenuAvatar" onclick="openAvatarUpload()">👤</div>
                
                <div class="profile-input-group">
                    <label for="nicknameInput">Никнейм:</label>
                    <input type="text" id="nicknameInput" placeholder="Введите ваш никнейм" maxlength="20">
                </div>
                

                
                <div class="profile-input-group">
                    <label for="promocodeInput">Промокод:</label>
                    <div class="promocode-input-container">
                        <input type="text" id="promocodeInput" placeholder="Введите промокод" maxlength="20" style="text-transform: uppercase;" onkeydown="handlePromocodeKeydown(event)" onclick="handlePromocodeInputClick(event)">
                        <button class="promocode-submit-btn" onclick="activatePromocode()" title="Активировать промокод">→</button>
                    </div>
                    <div style="font-size: 12px; color: #95a5a6; margin-top: 5px;">
                        Введите промокод для получения бонуса
                    </div>
                    <div id="promocodeMessage" style="font-size: 12px; margin-top: 5px; display: none;"></div>
                </div>
                
                <div class="profile-buttons">
                    <button class="btn btn-success" onclick="saveProfile()">Сохранить</button>
                    <button class="btn btn-primary" onclick="closeProfileMenu()">Отмена</button>
                </div>
            </div>
        </div>

        <div class="profile-menu-modal" id="noDropsModal">
            <div class="profile-menu-container">
                <h3 style="color: #e74c3c; margin-bottom: 20px;">⚠️ Нет дропов!</h3>
                <p style="color: white; font-size: 18px; margin-bottom: 30px; text-align: center;">
                    Для этого кейса ещё нет дропа!
                </p>
                <div style="text-align: center;">
                    <button class="btn btn-primary" onclick="closeNoDropsModal()">ОК</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let balance = 1000;
        let currentItem = null;
        let currentCasePrice = 120; // 🎨 Переменная для хранения цены текущего открываемого кейса
        let inventory = [
            { name: 'Стартовый инструмент', image: 'dropcase1_1', rarity: 'common', value: 10 }
        ];
        let userNickname = 'Игрок';
        let userAvatar = null; // Хранит base64 данные аватара
        let balanceClickCount = 0;
        let balanceClickTimer = null;
        
        // Защита от мискликов
        let rouletteProtection = false; // Флаг защиты рулетки
        let caseCooldowns = {}; // Кулдауны для кейсов
        
        // 🏛️ СИСТЕМА ГОСДОЛГА
        let hasDebt = false; // Есть ли активный долг
        let debtCasesLeft = 0; // Сколько кейсов осталось до списания
        let debtAmount = 500; // Сумма к возврату (по умолчанию 500)
        let isBlocked = false; // Заблокирован ли доступ к кейсам
        let hasBadCredit = false; // Плохой кредитный рейтинг (не вернул долг хотя бы раз)

        // Загрузка ТВОИХ изображений дропов
        function loadDropImage(imageElement, imageName) {
            // Очищаем предыдущий контент
            imageElement.textContent = '';
            
            const img = new Image();
            img.onload = () => {
                // Твоё изображение найдено - используем его
                imageElement.style.backgroundImage = `url('${imageName}.png')`;
                imageElement.style.backgroundSize = 'cover';
                imageElement.style.backgroundPosition = 'center';
                imageElement.textContent = '';
                
                console.log(`✅ Загружено изображение: ${imageName}.png`);
            };
            img.onerror = () => {
                // Твоё изображение НЕ найдено - показываем синий квадрат с "?"
                imageElement.style.backgroundImage = 'none';
                const currentBg = imageElement.style.backgroundColor;
                if (!currentBg || currentBg === '') {
                    imageElement.style.backgroundColor = '#3498db';
                }
                imageElement.textContent = '?';
                imageElement.style.display = 'flex';
                imageElement.style.alignItems = 'center';
                imageElement.style.justifyContent = 'center';
                
                // Адаптивный размер шрифта в зависимости от размера элемента
                const elementWidth = imageElement.offsetWidth || 80;
                const fontSize = Math.max(16, elementWidth * 0.4);
                imageElement.style.fontSize = `${fontSize}px`;
                imageElement.style.color = 'white';
                imageElement.style.fontWeight = 'bold';
                
                console.log(`❌ Не найдено изображение: ${imageName}.png - показываем заглушку`);
            };
            img.src = `${imageName}.png`; // Ищет dropcase1_1.png, dropcase2_5.png и т.д.
        }

        // Никаких ассетов - только простые файлы!

        // 🎰 СБАЛАНСИРОВАННАЯ ЭКОНОМИКА - МЕНЬШЕ КРАСНЫХ, БОЛЬШЕ ОКУПА!
        // Каждый дроп имеет реальный процент шанса выпадения
        const items = {
            1: [ // Кейс "Хуюнтик" 120 ꙮ - УНИКАЛЬНЫЕ РАЗНООБРАЗНЫЕ ДРОПЫ
                // 🔴 УБЫТОЧНЫЕ ДРОПЫ (45% общий шанс) - СНИЖЕНО с 70%!
                { name: 'Хуюнтик Камушек', image: 'dropcase1_3', rarity: 'common', value: 30, chance: 20 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                { name: 'Хуюнтик Палочка', image: 'dropcase1_2', rarity: 'common', value: 60, chance: 15 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                { name: 'Хуюнтик Шнурок', image: 'dropcase1_4', rarity: 'common', value: 100, chance: 10 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                
                // 🟡 ОКУПАЕМЫЕ ДРОПЫ (35% общий шанс) - УВЕЛИЧЕНО с 20%!
                { name: 'Хуюнтик Резак', image: 'dropcase1_1', rarity: 'rare', value: 140, chance: 20 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                { name: 'Хуюнтик Арбалет', image: 'dropcase1_8', rarity: 'rare', value: 180, chance: 15 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                
                // 🟢 ПРИБЫЛЬНЫЕ ДРОПЫ (20% общий шанс) - УВЕЛИЧЕНО в 2 раза!
                { name: 'Хуюнтик Доспехи', image: 'dropcase1_6', rarity: 'epic', value: 250, chance: 10 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                { name: 'Хуюнтик Сабля', image: 'dropcase1_7', rarity: 'epic', value: 300, chance: 6 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                { name: 'Хуюнтик Бронешит', image: 'dropcase1_5', rarity: 'epic', value: 400, chance: 3 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                { name: 'Хуюнтик Реликвия', image: 'dropcase1_10', rarity: 'legendary', value: 600, chance: 0.8 }, // ЛЕГЕНДАРНЫЙ ДРОП
                { name: 'Хуюнтик Эликсир Силы', image: 'dropcase1_9', rarity: 'legendary', value: 1000, chance: 0.2 } // ЛЕГЕНДАРНЫЙ ДРОП
            ],
            2: [ // Кейс "Кизик" 200 ꙮ - УНИКАЛЬНЫЕ РАЗНООБРАЗНЫЕ ДРОПЫ
                // 🔴 УБЫТОЧНЫЕ ДРОПЫ (40% общий шанс) - СНИЖЕНО с 65%!
                { name: 'Кизик Стилет', image: 'dropcase2_1', rarity: 'common', value: 50, chance: 18 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                { name: 'Кизик Баклер', image: 'dropcase2_2', rarity: 'common', value: 120, chance: 12 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                { name: 'Кизик Отвар', image: 'dropcase2_3', rarity: 'common', value: 180, chance: 10 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                
                // 🟡 ОКУПАЕМЫЕ ДРОПЫ (40% общий шанс) - УВЕЛИЧЕНО с 25%!
                { name: 'Кизик Талисман', image: 'dropcase2_6', rarity: 'rare', value: 240, chance: 22 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                { name: 'Кизик Наручи', image: 'dropcase2_9', rarity: 'rare', value: 300, chance: 18 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                
                // 🟢 ПРИБЫЛЬНЫЕ ДРОПЫ (20% общий шанс) - УВЕЛИЧЕНО в 2 раза!
                { name: 'Кизик Жезл', image: 'dropcase2_7', rarity: 'epic', value: 450, chance: 10 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                { name: 'Кизик Печать', image: 'dropcase2_4', rarity: 'epic', value: 600, chance: 6 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                { name: 'Кизик Ботинки', image: 'dropcase2_10', rarity: 'epic', value: 800, chance: 3 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                { name: 'Кизик Древняя Монета', image: 'dropcase2_5', rarity: 'legendary', value: 1200, chance: 0.8 }, // ЛЕГЕНДАРНЫЙ ДРОП
                { name: 'Кизик Диадема', image: 'dropcase2_8', rarity: 'legendary', value: 2000, chance: 0.2 } // ЛЕГЕНДАРНЫЙ ДРОП
            ],
            3: [ // Кейс "Жало" 150 ꙮ - УНИКАЛЬНЫЕ РАЗНООБРАЗНЫЕ ДРОПЫ
                // 🔴 УБЫТОЧНЫЕ ДРОПЫ (42% общий шанс) - СНИЖЕНО с 70%!
                { name: 'Жало Токсин', image: 'dropcase3_3', rarity: 'common', value: 40, chance: 19 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                { name: 'Жало Метательный Нож', image: 'dropcase3_6', rarity: 'common', value: 80, chance: 13 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                { name: 'Жало Колючка', image: 'dropcase3_8', rarity: 'common', value: 130, chance: 10 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                
                // 🟡 ОКУПАЕМЫЕ ДРОПЫ (38% общий шанс) - УВЕЛИЧЕНО с 20%!
                { name: 'Жало Болт', image: 'dropcase3_7', rarity: 'rare', value: 180, chance: 21 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                { name: 'Жало Кираса', image: 'dropcase3_2', rarity: 'rare', value: 220, chance: 17 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                
                // 🟢 ПРИБЫЛЬНЫЕ ДРОПЫ (20% общий шанс) - УВЕЛИЧЕНО в 2 раза!
                { name: 'Жало Кортик', image: 'dropcase3_1', rarity: 'epic', value: 350, chance: 10 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                { name: 'Жало Артефакт Убийцы', image: 'dropcase3_10', rarity: 'epic', value: 450, chance: 6 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                { name: 'Жало Композитный Лук', image: 'dropcase3_4', rarity: 'epic', value: 600, chance: 3 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                { name: 'Жало Кристалл Сапфира', image: 'dropcase3_5', rarity: 'legendary', value: 900, chance: 0.8 }, // ЛЕГЕНДАРНЫЙ ДРОП
                { name: 'Жало Реликвия Древних', image: 'dropcase3_9', rarity: 'legendary', value: 1500, chance: 0.2 } // ЛЕГЕНДАРНЫЙ ДРОП
            ],
            4: [ // Кейс "Шер" 300 ꙮ - УНИКАЛЬНЫЕ РАЗНООБРАЗНЫЕ ДРОПЫ
                // 🔴 УБЫТОЧНЫЕ ДРОПЫ (38% общий шанс) - СНИЖЕНО с 65%!
                { name: 'Шер Настойка', image: 'dropcase4_3', rarity: 'common', value: 80, chance: 16 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                { name: 'Шер Стилет', image: 'dropcase4_6', rarity: 'common', value: 180, chance: 12 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                { name: 'Шер Топор', image: 'dropcase4_9', rarity: 'common', value: 280, chance: 10 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                
                // 🟡 ОКУПАЕМЫЕ ДРОПЫ (42% общий шанс) - УВЕЛИЧЕНО с 25%!
                { name: 'Шер Башер', image: 'dropcase4_2', rarity: 'rare', value: 380, chance: 24 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                { name: 'Шер Клеймор', image: 'dropcase4_1', rarity: 'rare', value: 480, chance: 18 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                
                // 🟢 ПРИБЫЛЬНЫЕ ДРОПЫ (20% общий шанс) - УВЕЛИЧЕНО в 2 раза!
                { name: 'Шер Морningstar', image: 'dropcase4_7', rarity: 'epic', value: 700, chance: 10 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                { name: 'Шер Глефа', image: 'dropcase4_10', rarity: 'epic', value: 900, chance: 6 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                { name: 'Шер Элвенский Лук', image: 'dropcase4_4', rarity: 'epic', value: 1200, chance: 3 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                { name: 'Шер Кровавый Рубин', image: 'dropcase4_5', rarity: 'legendary', value: 1800, chance: 0.8 }, // ЛЕГЕНДАРНЫЙ ДРОП
                { name: 'Шер Корона Властелина', image: 'dropcase4_8', rarity: 'legendary', value: 3000, chance: 0.2 } // ЛЕГЕНДАРНЫЙ ДРОП
            ],
            5: [ // Кейс "Глист" 130 ꙮ - УНИКАЛЬНЫЕ РАЗНООБРАЗНЫЕ ДРОПЫ
                // 🔴 УБЫТОЧНЫЕ ДРОПЫ (44% общий шанс) - СНИЖЕНО с 70%!
                { name: 'Глист Экстракт', image: 'dropcase5_3', rarity: 'common', value: 35, chance: 20 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                { name: 'Глист Паразит', image: 'dropcase5_6', rarity: 'common', value: 70, chance: 14 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                { name: 'Глист Куколка', image: 'dropcase5_7', rarity: 'common', value: 110, chance: 10 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                
                // 🟡 ОКУПАЕМЫЕ ДРОПЫ (36% общий шанс) - УВЕЛИЧЕНО с 20%!
                { name: 'Глист Капсула', image: 'dropcase5_8', rarity: 'rare', value: 160, chance: 20 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                { name: 'Глист Химера', image: 'dropcase5_10', rarity: 'rare', value: 200, chance: 16 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                
                // 🟢 ПРИБЫЛЬНЫЕ ДРОПЫ (20% общий шанс) - УВЕЛИЧЕНО в 2 раза!
                { name: 'Глист Хитиновая Броня', image: 'dropcase5_2', rarity: 'epic', value: 300, chance: 10 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                { name: 'Глист Биооружие', image: 'dropcase5_1', rarity: 'epic', value: 400, chance: 6 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                { name: 'Глист Органический Лук', image: 'dropcase5_4', rarity: 'epic', value: 550, chance: 3 }, // УНИКАЛЬНОЕ НАЗВАНИЕ
                { name: 'Глист Матка Роя', image: 'dropcase5_9', rarity: 'legendary', value: 800, chance: 0.8 }, // ЛЕГЕНДАРНЫЙ ДРОП
                { name: 'Глист Кристалл Жизни', image: 'dropcase5_5', rarity: 'legendary', value: 1300, chance: 0.2 } // ЛЕГЕНДАРНЫЙ ДРОП
            ],
            6: [ // Кейс "Меофен" 100 ꙮ - СБАЛАНСИРОВАННЫЕ ШАНСЫ
                // 🔴 УБЫТОЧНЫЕ ДРОПЫ (40% общий шанс) - СНИЖЕНО с 70%!
                { name: 'Меофен Порошок', image: 'dropcase6_8', rarity: 'common', value: 40, chance: 15 }, // СНИЖЕНО с 25% до 15%
                { name: 'Меофен Таблетка', image: 'dropcase6_6', rarity: 'common', value: 65, chance: 15 }, // СНИЖЕНО с 25% до 15%
                { name: 'Меофен Зелье', image: 'dropcase6_3', rarity: 'common', value: 85, chance: 10 }, // СНИЖЕНО с 20% до 10%
                
                // 🟡 ОКУПАЕМЫЕ ДРОПЫ (40% общий шанс) - УВЕЛИЧЕНО с 20%!
                { name: 'Меофен Капсула', image: 'dropcase6_7', rarity: 'rare', value: 115, chance: 16 }, // УВЕЛИЧЕНО с 10% до 16%
                { name: 'Меофен Щит', image: 'dropcase6_2', rarity: 'rare', value: 135, chance: 14 }, // УВЕЛИЧЕНО с 8% до 14%
                { name: 'Меофен Меч', image: 'dropcase6_1', rarity: 'rare', value: 155, chance: 10 }, // УВЕЛИЧЕНО с 2% до 10%
                
                // 🟢 ПРИБЫЛЬНЫЕ ДРОПЫ (20% общий шанс) - УВЕЛИЧЕНО в 2 раза!
                { name: 'Меофен Лук', image: 'dropcase6_4', rarity: 'epic', value: 210, chance: 10 }, // УВЕЛИЧЕНО с 5% до 10%
                { name: 'Меофен Раствор', image: 'dropcase6_9', rarity: 'epic', value: 280, chance: 6 }, // УВЕЛИЧЕНО с 3% до 6%
                { name: 'Меофен Изумруд', image: 'dropcase6_5', rarity: 'epic', value: 350, chance: 3 }, // УВЕЛИЧЕНО с 1.5% до 3%
                { name: 'Меофен Сыворотка', image: 'dropcase6_10', rarity: 'legendary', value: 600, chance: 1 } // УВЕЛИЧЕНО с 0.5% до 1%
            ],
            7: [ // Кейс "ЧВК" 250 ꙮ - СБАЛАНСИРОВАННЫЕ ШАНСЫ
                // 🔴 УБЫТОЧНЫЕ ДРОПЫ (37% общий шанс) - СНИЖЕНО с 65%!
                { name: 'ЧВК Стимулятор', image: 'dropcase7_3', rarity: 'common', value: 100, chance: 16 }, // СНИЖЕНО с 30%
                { name: 'ЧВК Бронежилет', image: 'dropcase7_8', rarity: 'common', value: 150, chance: 11 }, // СНИЖЕНО с 20%
                { name: 'ЧВК Клинок', image: 'dropcase7_1', rarity: 'common', value: 200, chance: 10 }, // СНИЖЕНО с 15%
                
                // 🟡 ОКУПАЕМЫЕ ДРОПЫ (43% общий шанс) - УВЕЛИЧЕНО с 25%!
                { name: 'ЧВК Броня', image: 'dropcase7_2', rarity: 'rare', value: 300, chance: 25 }, // УВЕЛИЧЕНО с 15%
                { name: 'ЧВК Автомат', image: 'dropcase7_6', rarity: 'rare', value: 380, chance: 18 }, // УВЕЛИЧЕНО с 10%
                
                // 🟢 ПРИБЫЛЬНЫЕ ДРОПЫ (20% общий шанс) - УВЕЛИЧЕНО!
                { name: 'ЧВК Гранатомёт', image: 'dropcase7_7', rarity: 'epic', value: 520, chance: 10 }, // УВЕЛИЧЕНО с 5%
                { name: 'ЧВК Снайперка', image: 'dropcase7_4', rarity: 'epic', value: 680, chance: 6 }, // УВЕЛИЧЕНО с 3%
                { name: 'ЧВК Командир', image: 'dropcase7_9', rarity: 'epic', value: 900, chance: 3 }, // УВЕЛИЧЕНО с 1.5%
                { name: 'ЧВК Алмаз', image: 'dropcase7_5', rarity: 'legendary', value: 1300, chance: 0.8 }, // УВЕЛИЧЕНО с 0.4%
                { name: 'ЧВК Легенда', image: 'dropcase7_10', rarity: 'legendary', value: 2000, chance: 0.2 } // УВЕЛИЧЕНО с 0.1%
            ],
            8: [ // Кейс "Берег" 180 ꙮ - СБАЛАНСИРОВАННЫЕ ШАНСЫ
                // 🔴 УБЫТОЧНЫЕ ДРОПЫ (38% общий шанс) - СНИЖЕНО!
                { name: 'Берег Раковина', image: 'dropcase8_6', rarity: 'common', value: 75, chance: 17 },
                { name: 'Берег Щит', image: 'dropcase8_2', rarity: 'common', value: 115, chance: 11 },
                { name: 'Берег Меч', image: 'dropcase8_1', rarity: 'common', value: 155, chance: 10 },
                
                // 🟡 ОКУПАЕМЫЕ ДРОПЫ (42% общий шанс) - УВЕЛИЧЕНО!
                { name: 'Берег Якорь', image: 'dropcase8_7', rarity: 'rare', value: 220, chance: 24 },
                { name: 'Берег Жемчужина', image: 'dropcase8_3', rarity: 'rare', value: 280, chance: 18 },
                
                // 🟢 ПРИБЫЛЬНЫЕ ДРОПЫ (20% общий шанс) - УВЕЛИЧЕНО!
                { name: 'Берег Прилив', image: 'dropcase8_9', rarity: 'epic', value: 380, chance: 10 },
                { name: 'Берег Волна', image: 'dropcase8_8', rarity: 'epic', value: 500, chance: 6 },
                { name: 'Берег Трезубец', image: 'dropcase8_4', rarity: 'epic', value: 650, chance: 3 },
                { name: 'Берег Океан', image: 'dropcase8_10', rarity: 'legendary', value: 950, chance: 0.8 },
                { name: 'Берег Коралл', image: 'dropcase8_5', rarity: 'legendary', value: 1400, chance: 0.2 }
            ],
            9: [ // Кейс "Молот" 220 ꙮ - СБАЛАНСИРОВАННЫЕ ШАНСЫ
                // 🔴 УБЫТОЧНЫЕ ДРОПЫ (39% общий шанс) - СНИЖЕНО!
                { name: 'Молот Буря', image: 'dropcase9_3', rarity: 'common', value: 90, chance: 17 },
                { name: 'Молот Щит', image: 'dropcase9_2', rarity: 'common', value: 135, chance: 12 },
                { name: 'Молот Удар', image: 'dropcase9_8', rarity: 'common', value: 180, chance: 10 },
                
                // 🟡 ОКУПАЕМЫЕ ДРОПЫ (41% общий шанс) - УВЕЛИЧЕНО!
                { name: 'Молот Наковальня', image: 'dropcase9_6', rarity: 'rare', value: 260, chance: 23 },
                { name: 'Молот Кувалда', image: 'dropcase9_7', rarity: 'rare', value: 320, chance: 18 },
                
                // 🟢 ПРИБЫЛЬНЫЕ ДРОПЫ (20% общий шанс) - УВЕЛИЧЕНО!
                { name: 'Молот Грома', image: 'dropcase9_1', rarity: 'epic', value: 460, chance: 10 },
                { name: 'Молот Посох', image: 'dropcase9_4', rarity: 'epic', value: 600, chance: 6 },
                { name: 'Молот Тора', image: 'dropcase9_10', rarity: 'epic', value: 780, chance: 3 },
                { name: 'Молот Мьёльнир', image: 'dropcase9_9', rarity: 'legendary', value: 1200, chance: 0.8 },
                { name: 'Молот Молния', image: 'dropcase9_5', rarity: 'legendary', value: 1800, chance: 0.2 }
            ],
            10: [ // Кейс "Вихрь" 160 ꙮ - СБАЛАНСИРОВАННЫЕ ШАНСЫ
                // 🔴 УБЫТОЧНЫЕ ДРОПЫ (40% общий шанс) - СНИЖЕНО!
                { name: 'Вихрь Эликсир', image: 'dropcase10_3', rarity: 'common', value: 65, chance: 18 },
                { name: 'Вихрь Ветер', image: 'dropcase10_6', rarity: 'common', value: 100, chance: 12 },
                { name: 'Вихрь Щит', image: 'dropcase10_2', rarity: 'common', value: 135, chance: 10 },
                
                // 🟡 ОКУПАЕМЫЕ ДРОПЫ (40% общий шанс) - УВЕЛИЧЕНО!
                { name: 'Вихрь Клинок', image: 'dropcase10_1', rarity: 'rare', value: 180, chance: 22 },
                { name: 'Вихрь Буря', image: 'dropcase10_7', rarity: 'rare', value: 240, chance: 18 },
                
                // 🟢 ПРИБЫЛЬНЫЕ ДРОПЫ (20% общий шанс) - УВЕЛИЧЕНО!
                { name: 'Вихрь Ураган', image: 'dropcase10_8', rarity: 'epic', value: 340, chance: 10 },
                { name: 'Вихрь Лук', image: 'dropcase10_4', rarity: 'epic', value: 450, chance: 6 },
                { name: 'Вихрь Циклон', image: 'dropcase10_10', rarity: 'epic', value: 580, chance: 3 },
                { name: 'Вихрь Торнадо', image: 'dropcase10_9', rarity: 'legendary', value: 850, chance: 0.8 },
                { name: 'Вихрь Перо', image: 'dropcase10_5', rarity: 'legendary', value: 1200, chance: 0.2 }
            ],
            11: [ // Кейс "Призрак" 350 ꙮ
                // 🔴 УБЫТОЧНЫЕ ДРОПЫ (65% общий шанс)
                { name: 'Призрак Зелье', image: 'dropcase11_3', rarity: 'common', value: 140, chance: 30 },
                { name: 'Призрак Тень', image: 'dropcase11_6', rarity: 'common', value: 210, chance: 20 },
                { name: 'Призрак Эктоплазма', image: 'dropcase11_8', rarity: 'common', value: 280, chance: 15 },
                
                // 🟡 ОКУПАЕМЫЕ ДРОПЫ (25% общий шанс)
                { name: 'Призрак Броня', image: 'dropcase11_2', rarity: 'rare', value: 420, chance: 15 },
                { name: 'Призрак Меч', image: 'dropcase11_1', rarity: 'rare', value: 520, chance: 10 },
                
                // 🟢 ПРИБЫЛЬНЫЕ ДРОПЫ (10% общий шанс)
                { name: 'Призрак Дух', image: 'dropcase11_7', rarity: 'epic', value: 730, chance: 5 },
                { name: 'Призрак Лук', image: 'dropcase11_4', rarity: 'epic', value: 950, chance: 3 },
                { name: 'Призрак Король', image: 'dropcase11_9', rarity: 'epic', value: 1250, chance: 1.5 },
                { name: 'Призрак Душа', image: 'dropcase11_5', rarity: 'legendary', value: 1800, chance: 0.4 },
                { name: 'Призрак Бог', image: 'dropcase11_10', rarity: 'legendary', value: 2800, chance: 0.1 }
            ],
            12: [ // Кейс "Лёд" 290 ꙮ
                // 🔴 УБЫТОЧНЫЕ ДРОПЫ (65% общий шанс)
                { name: 'Лёд Зелье', image: 'dropcase12_3', rarity: 'common', value: 115, chance: 30 },
                { name: 'Лёд Кристалл', image: 'dropcase12_6', rarity: 'common', value: 175, chance: 20 },
                { name: 'Лёд Щит', image: 'dropcase12_2', rarity: 'common', value: 235, chance: 15 },
                
                // 🟡 ОКУПАЕМЫЕ ДРОПЫ (25% общий шанс)
                { name: 'Лёд Иней', image: 'dropcase12_7', rarity: 'rare', value: 350, chance: 15 },
                { name: 'Лёд Клинок', image: 'dropcase12_1', rarity: 'rare', value: 440, chance: 10 },
                
                // 🟢 ПРИБЫЛЬНЫЕ ДРОПЫ (10% общий шанс)
                { name: 'Лёд Мороз', image: 'dropcase12_8', rarity: 'epic', value: 610, chance: 5 },
                { name: 'Лёд Посох', image: 'dropcase12_4', rarity: 'epic', value: 800, chance: 3 },
                { name: 'Лёд Айсберг', image: 'dropcase12_9', rarity: 'epic', value: 1050, chance: 1.5 },
                { name: 'Лёд Снежинка', image: 'dropcase12_5', rarity: 'legendary', value: 1500, chance: 0.4 },
                { name: 'Лёд Вечность', image: 'dropcase12_10', rarity: 'legendary', value: 2300, chance: 0.1 }
            ],
            13: [ // Кейс "Огонь" 400 ꙮ
                // 🔴 УБЫТОЧНЫЕ ДРОПЫ (65% общий шанс)
                { name: 'Огонь Эликсир', image: 'dropcase13_3', rarity: 'common', value: 160, chance: 30 },
                { name: 'Огонь Пламя', image: 'dropcase13_6', rarity: 'common', value: 240, chance: 20 },
                { name: 'Огонь Броня', image: 'dropcase13_2', rarity: 'common', value: 320, chance: 15 },
                
                // 🟡 ОКУПАЕМЫЕ ДРОПЫ (25% общий шанс)
                { name: 'Огонь Меч', image: 'dropcase13_1', rarity: 'rare', value: 480, chance: 15 },
                { name: 'Огонь Феникс', image: 'dropcase13_8', rarity: 'rare', value: 600, chance: 10 },
                
                // 🟢 ПРИБЫЛЬНЫЕ ДРОПЫ (10% общий шанс)
                { name: 'Огонь Лава', image: 'dropcase13_7', rarity: 'epic', value: 840, chance: 5 },
                { name: 'Огонь Посох', image: 'dropcase13_4', rarity: 'epic', value: 1100, chance: 3 },
                { name: 'Огонь Дракон', image: 'dropcase13_9', rarity: 'epic', value: 1450, chance: 1.5 },
                { name: 'Огонь Сердце', image: 'dropcase13_5', rarity: 'legendary', value: 2100, chance: 0.4 },
                { name: 'Огонь Солнце', image: 'dropcase13_10', rarity: 'legendary', value: 3200, chance: 0.1 }
            ],
            14: [ // Кейс "Тень" 320 ꙮ
                // 🔴 УБЫТОЧНЫЕ ДРОПЫ (65% общий шанс)
                { name: 'Тень Зелье', image: 'dropcase14_3', rarity: 'common', value: 130, chance: 30 },
                { name: 'Тень Сумрак', image: 'dropcase14_6', rarity: 'common', value: 195, chance: 20 },
                { name: 'Тень Мрак', image: 'dropcase14_8', rarity: 'common', value: 260, chance: 15 },
                
                // 🟡 ОКУПАЕМЫЕ ДРОПЫ (25% общий шанс)
                { name: 'Тень Мантия', image: 'dropcase14_2', rarity: 'rare', value: 380, chance: 15 },
                { name: 'Тень Клинок', image: 'dropcase14_1', rarity: 'rare', value: 480, chance: 10 },
                
                // 🟢 ПРИБЫЛЬНЫЕ ДРОПЫ (10% общий шанс)
                { name: 'Тень Кинжал', image: 'dropcase14_4', rarity: 'epic', value: 670, chance: 5 },
                { name: 'Тень Ночь', image: 'dropcase14_7', rarity: 'epic', value: 880, chance: 3 },
                { name: 'Тень Бездна', image: 'dropcase14_9', rarity: 'epic', value: 1150, chance: 1.5 },
                { name: 'Тень Осколок', image: 'dropcase14_5', rarity: 'legendary', value: 1650, chance: 0.4 },
                { name: 'Тень Пустота', image: 'dropcase14_10', rarity: 'legendary', value: 2500, chance: 0.1 }
            ],
            15: [ // Кейс "Свет" 270 ꙮ
                // 🔴 УБЫТОЧНЫЕ ДРОПЫ (65% общий шанс)
                { name: 'Свет Вода', image: 'dropcase15_3', rarity: 'common', value: 110, chance: 30 },
                { name: 'Свет Луч', image: 'dropcase15_6', rarity: 'common', value: 165, chance: 20 },
                { name: 'Свет Доспехи', image: 'dropcase15_2', rarity: 'common', value: 220, chance: 15 },
                
                // 🟡 ОКУПАЕМЫЕ ДРОПЫ (25% общий шанс)
                { name: 'Свет Меч', image: 'dropcase15_1', rarity: 'rare', value: 320, chance: 15 },
                { name: 'Свет Аура', image: 'dropcase15_8', rarity: 'rare', value: 410, chance: 10 },
                
                // 🟢 ПРИБЫЛЬНЫЕ ДРОПЫ (10% общий шанс)
                { name: 'Свет Сияние', image: 'dropcase15_7', rarity: 'epic', value: 570, chance: 5 },
                { name: 'Свет Посох', image: 'dropcase15_4', rarity: 'epic', value: 750, chance: 3 },
                { name: 'Свет Святость', image: 'dropcase15_9', rarity: 'epic', value: 980, chance: 1.5 },
                { name: 'Свет Благословение', image: 'dropcase15_5', rarity: 'legendary', value: 1400, chance: 0.4 },
                { name: 'Свет Божество', image: 'dropcase15_10', rarity: 'legendary', value: 2100, chance: 0.1 }
            ],
            16: [ // Кейс "Хаос" 500 ꙮ - СБАЛАНСИРОВАННЫЕ ШАНСЫ
                // 🔴 УБЫТОЧНЫЕ ДРОПЫ (35% общий шанс) - СИЛЬНО СНИЖЕНО!
                { name: 'Хаос Зелье', image: 'dropcase16_3', rarity: 'common', value: 200, chance: 15 },
                { name: 'Хаос Разрушение', image: 'dropcase16_6', rarity: 'common', value: 300, chance: 10 },
                { name: 'Хаос Доспех', image: 'dropcase16_2', rarity: 'common', value: 400, chance: 10 },
                
                // 🟡 ОКУПАЕМЫЕ ДРОПЫ (45% общий шанс) - СИЛЬНО УВЕЛИЧЕНО!
                { name: 'Хаос Клинок', image: 'dropcase16_1', rarity: 'rare', value: 600, chance: 25 },
                { name: 'Хаос Анархия', image: 'dropcase16_7', rarity: 'rare', value: 750, chance: 20 },
                
                // 🟢 ПРИБЫЛЬНЫЕ ДРОПЫ (20% общий шанс) - УВЕЛИЧЕНО!
                { name: 'Хаос Безумие', image: 'dropcase16_8', rarity: 'epic', value: 1050, chance: 10 },
                { name: 'Хаос Посох', image: 'dropcase16_4', rarity: 'epic', value: 1400, chance: 6 },
                { name: 'Хаос Энтропия', image: 'dropcase16_9', rarity: 'epic', value: 1800, chance: 3 },
                { name: 'Хаос Сердце', image: 'dropcase16_5', rarity: 'legendary', value: 2600, chance: 0.8 },
                { name: 'Хаос Апокалипсис', image: 'dropcase16_10', rarity: 'legendary', value: 4000, chance: 0.2 }
            ],
            17: [ // Кейс "Порядок" 450 ꙮ
                // 🔴 УБЫТОЧНЫЕ ДРОПЫ (65% общий шанс)
                { name: 'Порядок Эликсир', image: 'dropcase17_3', rarity: 'common', value: 180, chance: 30 },
                { name: 'Порядок Закон', image: 'dropcase17_6', rarity: 'common', value: 270, chance: 20 },
                { name: 'Порядок Доспех', image: 'dropcase17_2', rarity: 'common', value: 360, chance: 15 },
                
                // 🟡 ОКУПАЕМЫЕ ДРОПЫ (25% общий шанс)
                { name: 'Порядок Меч', image: 'dropcase17_1', rarity: 'rare', value: 540, chance: 15 },
                { name: 'Порядок Справедливость', image: 'dropcase17_7', rarity: 'rare', value: 680, chance: 10 },
                
                // 🟢 ПРИБЫЛЬНЫЕ ДРОПЫ (10% общий шанс)
                { name: 'Порядок Гармония', image: 'dropcase17_8', rarity: 'epic', value: 950, chance: 5 },
                { name: 'Порядок Посох', image: 'dropcase17_4', rarity: 'epic', value: 1250, chance: 3 },
                { name: 'Порядок Баланс', image: 'dropcase17_9', rarity: 'epic', value: 1650, chance: 1.5 },
                { name: 'Порядок Печать', image: 'dropcase17_5', rarity: 'legendary', value: 2350, chance: 0.4 },
                { name: 'Порядок Абсолют', image: 'dropcase17_10', rarity: 'legendary', value: 3600, chance: 0.1 }
            ],
            18: [ // Кейс "Время" 380 ꙮ
                // 🔴 УБЫТОЧНЫЕ ДРОПЫ (65% общий шанс)
                { name: 'Время Зелье', image: 'dropcase18_3', rarity: 'common', value: 150, chance: 30 },
                { name: 'Время Хронос', image: 'dropcase18_6', rarity: 'common', value: 230, chance: 20 },
                { name: 'Время Доспех', image: 'dropcase18_2', rarity: 'common', value: 310, chance: 15 },
                
                // 🟡 ОКУПАЕМЫЕ ДРОПЫ (25% общий шанс)
                { name: 'Время Клинок', image: 'dropcase18_1', rarity: 'rare', value: 450, chance: 15 },
                { name: 'Время Петля', image: 'dropcase18_7', rarity: 'rare', value: 580, chance: 10 },
                
                // 🟢 ПРИБЫЛЬНЫЕ ДРОПЫ (10% общий шанс)
                { name: 'Время Портал', image: 'dropcase18_8', rarity: 'epic', value: 800, chance: 5 },
                { name: 'Время Посох', image: 'dropcase18_4', rarity: 'epic', value: 1050, chance: 3 },
                { name: 'Время Парадокс', image: 'dropcase18_9', rarity: 'epic', value: 1380, chance: 1.5 },
                { name: 'Время Часы', image: 'dropcase18_5', rarity: 'legendary', value: 1980, chance: 0.4 },
                { name: 'Время Вечность', image: 'dropcase18_10', rarity: 'legendary', value: 3000, chance: 0.1 }
            ],
            19: [ // Кейс "Космос" 600 ꙮ
                // 🔴 УБЫТОЧНЫЕ ДРОПЫ (65% общий шанс)
                { name: 'Космос Нектар', image: 'dropcase19_3', rarity: 'common', value: 240, chance: 30 },
                { name: 'Космос Звезда', image: 'dropcase19_6', rarity: 'common', value: 360, chance: 20 },
                { name: 'Космос Броня', image: 'dropcase19_2', rarity: 'common', value: 480, chance: 15 },
                
                // 🟡 ОКУПАЕМЫЕ ДРОПЫ (25% общий шанс)
                { name: 'Космос Меч', image: 'dropcase19_1', rarity: 'rare', value: 720, chance: 15 },
                { name: 'Космос Галактика', image: 'dropcase19_7', rarity: 'rare', value: 900, chance: 10 },
                
                // 🟢 ПРИБЫЛЬНЫЕ ДРОПЫ (10% общий шанс)
                { name: 'Космос Посох', image: 'dropcase19_4', rarity: 'epic', value: 1260, chance: 5 },
                { name: 'Космос Туманность', image: 'dropcase19_8', rarity: 'epic', value: 1650, chance: 3 },
                { name: 'Космос Квазар', image: 'dropcase19_9', rarity: 'epic', value: 2150, chance: 1.5 },
                { name: 'Космос Сердце', image: 'dropcase19_5', rarity: 'legendary', value: 3100, chance: 0.4 },
                { name: 'Космос Вселенная', image: 'dropcase19_10', rarity: 'legendary', value: 4800, chance: 0.1 }
            ],
            20: [ // Кейс "Вечность" 750 ꙮ - СБАЛАНСИРОВАННЫЕ ШАНСЫ
                // 🔴 УБЫТОЧНЫЕ ДРОПЫ (32% общий шанс) - СИЛЬНО СНИЖЕНО!
                { name: 'Вечность Эликсир', image: 'dropcase20_3', rarity: 'common', value: 300, chance: 14 },
                { name: 'Вечность Бессмертие', image: 'dropcase20_6', rarity: 'common', value: 450, chance: 9 },
                { name: 'Вечность Доспех', image: 'dropcase20_2', rarity: 'common', value: 600, chance: 9 },
                
                // 🟡 ОКУПАЕМЫЕ ДРОПЫ (48% общий шанс) - СИЛЬНО УВЕЛИЧЕНО!
                { name: 'Вечность Клинок', image: 'dropcase20_1', rarity: 'rare', value: 900, chance: 26 },
                { name: 'Вечность Бесконечность', image: 'dropcase20_7', rarity: 'rare', value: 1125, chance: 22 },
                
                // 🟢 ПРИБЫЛЬНЫЕ ДРОПЫ (20% общий шанс) - УВЕЛИЧЕНО!
                { name: 'Вечность Абсолют', image: 'dropcase20_8', rarity: 'epic', value: 1575, chance: 10 },
                { name: 'Вечность Посох', image: 'dropcase20_4', rarity: 'epic', value: 2100, chance: 6 },
                { name: 'Вечность Омега', image: 'dropcase20_9', rarity: 'epic', value: 2700, chance: 3 },
                { name: 'Вечность Душа', image: 'dropcase20_5', rarity: 'legendary', value: 3900, chance: 0.8 },
                { name: 'Вечность Альфа', image: 'dropcase20_10', rarity: 'legendary', value: 6000, chance: 0.2 }
            ]
        };

        function updateBalance() {
            document.getElementById('balance').textContent = balance;
            
            // Update case availability
            document.querySelectorAll('.case').forEach(caseEl => {
                const price = parseInt(caseEl.dataset.price);
                if (balance < price) {
                    caseEl.classList.add('disabled');
                } else {
                    caseEl.classList.remove('disabled');
                }
            });
            
            // 🚨 НОВАЯ ЛОГИКА: АВТОМАТИЧЕСКОЕ СПИСАНИЕ ДОЛГА ПРИ ДОСТИЖЕНИИ СУММЫ
            checkAutoDebtPayment();
            
            // 🚨 ПРОВЕРЯЕМ АВТОМАТИЧЕСКУЮ БЛОКИРОВКУ ОТ ГОСДОЛГА
            checkAutoDebtBlock();
            
            // 💡 ПРОВЕРЯЕМ ПОЛНЫЙ НОЛЬ И ПОКАЗЫВАЕМ ПОДСКАЗКУ
            checkZeroBalance();
            
            // Save data when balance changes
            saveGameData();
        }
        
        // 💰 НОВАЯ ФУНКЦИЯ: АВТОМАТИЧЕСКОЕ СПИСАНИЕ ДОЛГА ПРИ ДОСТИЖЕНИИ СУММЫ
        function checkAutoDebtPayment() {
            if (!hasDebt || isBlocked) return; // Нет долга или уже заблокирован
            
            // Проверяем, достаточно ли денег для погашения долга
            if (balance >= debtAmount) {
                console.log(`💰 АВТОМАТИЧЕСКОЕ СПИСАНИЕ: Баланс ${balance} ꙮ >= долг ${debtAmount} ꙮ`);
                
                // Списываем долг автоматически!
                balance -= debtAmount;
                const paidAmount = debtAmount;
                
                // Сбрасываем долг
                hasDebt = false;
                debtCasesLeft = 0;
                const oldDebtAmount = debtAmount;
                debtAmount = 500; // Возвращаем к дефолту
                
                // Обновляем интерфейс
                updateDebtStatus();
                document.getElementById('balance').textContent = balance; // Сразу обновляем отображение
                saveGameData();
                
                // Показываем сообщение об успешном погашении
                showDebtPaymentMessage(paidAmount, oldDebtAmount);
                
                console.log(`✅ Госдолг автоматически погашен! Списано: ${paidAmount} ꙮ, остаток: ${balance} ꙮ`);
            }
        }
        
        // 🚨 АВТОМАТИЧЕСКАЯ БЛОКИРОВКА: если есть госдолг, но нельзя открыть ни одного кейса
        function checkAutoDebtBlock() {
            if (!hasDebt || isBlocked) return; // Нет долга или уже заблокирован
            
            // Проверяем минимальную цену кейса
            const minCasePrice = Math.min(...Array.from(document.querySelectorAll('.case')).map(el => parseInt(el.dataset.price)));
            
            // Если баланс меньше самого дешёвого кейса - блокируем сразу!
            if (balance < minCasePrice) {
                console.log(`🚨 АВТОБЛОКИРОВКА: Баланс ${balance} ꙮ < минимальная цена кейса ${minCasePrice} ꙮ при активном госдолге!`);
                
                // Сразу блокируем без возможности открыть кейсы
                isBlocked = true;
                hasDebt = false;
                debtCasesLeft = 0;
                hasBadCredit = true; // 📉 ПОРТИМ КРЕДИТНЫЙ РЕЙТИНГ!
                
                updateDebtStatus();
                showBlockBanner();
                saveGameData();
                
                // Показываем специальное сообщение
                showDebtMessage('Госдолг не возвращён! Денег нет даже на самый дешёвый кейс! БЛОКИРОВКА!', 'error');
            }
        }

        let selectedInventoryIndex = -1;

        function updateInventory() {
            const inventoryGrid = document.getElementById('inventoryGrid');
            inventoryGrid.innerHTML = '';
            
            // 🚫 ПРОВЕРЯЕМ АРЕСТ ИНВЕНТАРЯ
            if (isBlocked) {
                showArrestedInventory();
                return;
            }
            
            inventory.forEach((item, index) => {
                const itemEl = document.createElement('div');
                itemEl.className = 'inventory-item';
                itemEl.style.cursor = 'pointer';
                
                const iconEl = document.createElement('div');
                // 🎨 ИСПРАВЛЕНО: Используем реальную цену кейса откуда получен дроп (или среднюю)
                const dropColor = getDropValueColor(item, item.casePrice || 200); // Цена кейса откуда получен дроп
                iconEl.className = `inventory-item-icon ${item.rarity}`;
                iconEl.style.cssText = `
                    width: 60px;
                    height: 60px;
                    margin: 0 auto 8px;
                    border-radius: 8px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 30px;
                    background-size: cover;
                    background-position: center;
                    background-color: ${dropColor};
                    border: 3px solid ${dropColor};
                    box-shadow: 0 0 10px ${dropColor}40;
                `;
                
                // Загружаем изображение дропа для инвентаря
                loadDropImage(iconEl, item.image);
                
                // Add click event to open item menu
                itemEl.addEventListener('click', () => {
                    openItemMenu(index);
                });
                
                itemEl.appendChild(iconEl);
                
                // Создаем отдельные элементы для названия и цены
                const nameEl = document.createElement('div');
                nameEl.textContent = item.name;
                nameEl.style.cssText = 'font-size: 12px; text-align: center; margin-bottom: 4px; word-wrap: break-word; line-height: 1.2; max-width: 100px;';
                itemEl.appendChild(nameEl);
                
                const valueEl = document.createElement('div');
                valueEl.textContent = `${item.value} ꙮ`;
                valueEl.style.cssText = 'color: #ffd700; font-size: 11px; text-align: center; font-weight: bold;';
                itemEl.appendChild(valueEl);
                
                inventoryGrid.appendChild(itemEl);
            });
        }
        
        // 🚫 ПОКАЗЫВАЕМ АРЕСТОВАННЫЙ ИНВЕНТАРЬ
        function showArrestedInventory() {
            const inventoryGrid = document.getElementById('inventoryGrid');
            
            const arrestBanner = document.createElement('div');
            arrestBanner.style.cssText = `
                grid-column: 1 / -1;
                background: linear-gradient(135deg, #e74c3c, #c0392b);
                border: 3px solid #fff;
                border-radius: 15px;
                padding: 30px;
                text-align: center;
                animation: arrestPulse 2s ease-in-out infinite;
                margin: 20px 0;
                box-shadow: 0 5px 20px rgba(231, 76, 60, 0.5);
            `;
            
            arrestBanner.innerHTML = `
                <h3 style="color: #fff; font-size: 24px; margin-bottom: 15px; text-shadow: 2px 2px 4px rgba(0,0,0,0.7);">
                    🚫 ВАШЕ ИМУЩЕСТВО АРЕСТОВАНО! 🚫
                </h3>
                <p style="color: #fff; font-size: 16px; margin-bottom: 20px; line-height: 1.4; text-shadow: 1px 1px 2px rgba(0,0,0,0.7);">
                    За неуплату госдолга СПО конфисковало ваш инвентарь.<br>
                    <strong style="color: #ffeb3b;">Все предметы заблокированы до погашения долгов!</strong>
                </p>
                <div style="
                    background: rgba(255,255,255,0.2);
                    border-radius: 10px;
                    padding: 15px;
                    margin-bottom: 20px;
                    border: 1px solid rgba(255,255,255,0.3);
                ">
                    <p style="color: #fff; font-size: 14px; margin: 0; line-height: 1.3;">
                        📦 Заблокировано предметов: <strong>${inventory.length}</strong><br>
                        💰 Общая стоимость: <strong>${inventory.reduce((sum, item) => sum + item.value, 0)} ꙮ</strong><br>
                        🔒 Доступ восстановится после покаяния
                    </p>
                </div>
                <div style="
                    background: rgba(0,0,0,0.3);
                    border-radius: 8px;
                    padding: 10px;
                    border: 1px solid rgba(255,255,255,0.2);
                ">
                    <p style="color: #ffd700; font-size: 12px; margin: 0; font-style: italic;">
                        ⚖️ "Согласно статье 228 УК СПО, неплательщики госдолга<br>
                        подлежат конфискации имущества до полного расчёта."
                    </p>
                </div>
            `;
            
            // Добавляем анимацию пульсации для ареста
            if (!document.getElementById('arrest-pulse-style')) {
                const style = document.createElement('style');
                style.id = 'arrest-pulse-style';
                style.textContent = `
                    @keyframes arrestPulse {
                        0%, 100% { 
                            transform: scale(1);
                            box-shadow: 0 5px 20px rgba(231, 76, 60, 0.5);
                        }
                        50% { 
                            transform: scale(1.02);
                            box-shadow: 0 8px 30px rgba(231, 76, 60, 0.8), 0 0 40px rgba(231, 76, 60, 0.3);
                        }
                    }
                `;
                document.head.appendChild(style);
            }
            
            inventoryGrid.appendChild(arrestBanner);
            
            console.log('🚫 Инвентарь арестован! Показан баннер конфискации');
        }

        function openItemMenu(index) {
            // 🚫 БЛОКИРУЕМ МЕНЮ ПРЕДМЕТОВ ПРИ АРЕСТЕ
            if (isBlocked) {
                showArrestMessage();
                return;
            }
            
            if (index >= 0 && index < inventory.length) {
                selectedInventoryIndex = index;
                const item = inventory[index];
                
                const itemMenuModal = document.getElementById('itemMenuModal');
                const itemMenuImage = document.getElementById('itemMenuImage');
                const itemMenuName = document.getElementById('itemMenuName');
                const itemMenuValue = document.getElementById('itemMenuValue');
                
                // Set up item image
                // 🎨 ИСПРАВЛЕНО: Используем сохранённую цену кейса для дропа
                const dropColor = getDropValueColor(item, item.casePrice || 200);
                itemMenuImage.style.background = dropColor;
                itemMenuImage.style.border = `3px solid ${dropColor}`;
                itemMenuImage.style.boxShadow = `0 0 15px ${dropColor}40`;
                itemMenuImage.innerHTML = '';
                itemMenuImage.style.display = 'flex';
                itemMenuImage.style.alignItems = 'center';
                itemMenuImage.style.justifyContent = 'center';
                
                // Простая загрузка изображения дропа
                loadDropImage(itemMenuImage, item.image);
                
                itemMenuName.textContent = item.name;
                itemMenuValue.textContent = `Стоимость: ${item.value} ꙮ`;
                
                itemMenuModal.classList.add('active');
            }
        }
        
        // 🚫 ПОКАЗЫВАЕМ СООБЩЕНИЕ О БЛОКИРОВКЕ ИНВЕНТАРЯ
        function showArrestMessage() {
            const message = document.createElement('div');
            message.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #e74c3c, #c0392b);
                border: 3px solid #fff;
                border-radius: 15px;
                padding: 25px;
                z-index: 10006;
                text-align: center;
                max-width: 400px;
                width: 90vw;
                box-shadow: 0 10px 30px rgba(0,0,0,0.8);
                animation: arrestShake 0.5s ease-in-out;
            `;
            
            message.innerHTML = `
                <h3 style="color: #fff; font-size: 22px; margin-bottom: 15px;">🚫 ДОСТУП ЗАПРЕЩЁН! 🚫</h3>
                <p style="color: #fff; font-size: 16px; margin-bottom: 20px; line-height: 1.4;">
                    Ваше имущество арестовано СПО!<br>
                    <strong style="color: #ffeb3b;">Предметы заблокированы до погашения долгов!</strong>
                </p>
                <div style="
                    background: rgba(255,255,255,0.2);
                    border-radius: 8px;
                    padding: 12px;
                    margin-bottom: 20px;
                ">
                    <p style="color: #ffd700; font-size: 13px; margin: 0;">
                        🔒 Для разблокировки покайтесь и погасите долги
                    </p>
                </div>
                <button onclick="this.parentElement.remove()" style="
                    background: #fff;
                    color: #e74c3c;
                    border: none;
                    padding: 12px 25px;
                    border-radius: 10px;
                    font-size: 16px;
                    font-weight: bold;
                    cursor: pointer;
                    transition: all 0.3s ease;
                " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                    😤 Понял!
                </button>
            `;
            
            // Добавляем анимацию тряски
            if (!document.getElementById('arrest-shake-style')) {
                const style = document.createElement('style');
                style.id = 'arrest-shake-style';
                style.textContent = `
                    @keyframes arrestShake {
                        0%, 100% { transform: translate(-50%, -50%) rotate(0deg); }
                        10% { transform: translate(-50%, -50%) rotate(-1deg); }
                        20% { transform: translate(-50%, -50%) rotate(1deg); }
                        30% { transform: translate(-50%, -50%) rotate(-1deg); }
                        40% { transform: translate(-50%, -50%) rotate(1deg); }
                        50% { transform: translate(-50%, -50%) rotate(-1deg); }
                        60% { transform: translate(-50%, -50%) rotate(1deg); }
                        70% { transform: translate(-50%, -50%) rotate(-1deg); }
                        80% { transform: translate(-50%, -50%) rotate(1deg); }
                        90% { transform: translate(-50%, -50%) rotate(-1deg); }
                    }
                `;
                document.head.appendChild(style);
            }
            
            document.body.appendChild(message);
            
            // Автоматически убираем через 4 секунды
            setTimeout(() => {
                if (document.body.contains(message)) {
                    document.body.removeChild(message);
                }
            }, 4000);
            
            console.log('🚫 Показано сообщение о блокировке инвентаря');
        }

        function sellItemFromMenu() {
            if (selectedInventoryIndex >= 0 && selectedInventoryIndex < inventory.length) {
                const item = inventory[selectedInventoryIndex];
                balance += item.value;
                inventory.splice(selectedInventoryIndex, 1);
                updateBalance();
                updateInventory();
                addToWinglist(item);
                saveGameData(); // Save when selling from menu
                closeItemMenu();
                
                // 💡 Дополнительная проверка подсказки после продажи
                checkZeroBalance();
                
                // 💡 ПРОВЕРЯЕМ ОТЛОЖЕННУЮ ПОДСКАЗКУ ПОСЛЕ ДЕЙСТВИЯ
                checkPendingBonusHint();
            }
        }

        function closeItemMenu() {
            document.getElementById('itemMenuModal').classList.remove('active');
            selectedInventoryIndex = -1;
        }

        function sellInventoryItem(index) {
            if (index >= 0 && index < inventory.length) {
                const item = inventory[index];
                balance += item.value;
                inventory.splice(index, 1);
                updateBalance();
                updateInventory();
                addToWinglist(item);
            }
        }

        // 🎨 ФУНКЦИЯ ПОЛУЧЕНИЯ ЦЕНЫ ТЕКУЩЕГО ОТКРЫТОГО КЕЙСА
        function getCurrentCasePrice() {
            return currentCasePrice;
        }
        
        // 🎨 НОВАЯ СИСТЕМА ЦВЕТОВ ДРОПОВ ПО ПРИБЫЛЬНОСТИ
        function getDropValueColor(item, casePrice) {
            const value = item.value;
            const price = casePrice || 120; // Цена кейса по умолчанию
            
            console.log(`🎨 Расчёт цвета: дроп ${value} ꙮ vs кейс ${price} ꙮ`);
            
            if (value < price) {
                // 🔴 УБЫТОЧНЫЕ ДРОПЫ - красный
                console.log(`🔴 УБЫТОЧНЫЙ: ${value} < ${price} = красный`);
                return '#e74c3c';
            } else if (value >= price && value < price * 2) {
                // 🟡 ОКУПАЕМЫЕ ДРОПЫ - жёлтый
                console.log(`🟡 ОКУПАЕМЫЙ: ${value} >= ${price} && < ${price * 2} = жёлтый`);
                return '#f1c40f';
            } else if (value >= price * 2 && value < price * 5) {
                // 🟢 ПРИБЫЛЬНЫЕ ДРОПЫ - зелёный
                console.log(`🟢 ПРИБЫЛЬНЫЙ: ${value} >= ${price * 2} && < ${price * 5} = зелёный`);
                return '#27ae60';
            } else {
                // 💎 ДЖЕКПОТЫ - фиолетовый (очень прибыльные)
                console.log(`💎 ДЖЕКПОТ: ${value} >= ${price * 5} = фиолетовый`);
                return '#8e44ad';
            }
        }
        
        // 📊 ФУНКЦИЯ ОПРЕДЕЛЕНИЯ ТИПА ДРОПА ПО ПРИБЫЛЬНОСТИ
        function getDropType(item, casePrice) {
            const value = item.value;
            const price = casePrice || 120;
            
            if (value < price) {
                return 'loss';      // 🔴 Убыточные
            } else if (value >= price && value < price * 2) {
                return 'breakeven'; // 🟡 Окупаемые
            } else if (value >= price * 2 && value < price * 5) {
                return 'profit';    // 🟢 Прибыльные
            } else {
                return 'jackpot';   // 💎 Джекпоты
            }
        }
        
        // Функция для совместимости со старым кодом
        function getRarityColor(rarity) {
            switch (rarity) {
                case 'common': return '#e74c3c';    // Красный для обычных
                case 'rare': return '#f1c40f';      // Жёлтый для редких
                case 'epic': return '#27ae60';      // Зелёный для эпических
                case 'legendary': return '#8e44ad'; // Фиолетовый для легендарных
                default: return '#95a5a6';
            }
        }

        // Error sound for insufficient funds
        function playErrorSound() {
            // Звуки отключены - только визуальная обратная связь
            console.log('⚠️ Недостаточно средств для открытия кейса');
        }

        // 📊 ФУНКЦИЯ ПОКАЗА ШАНСОВ ДРОПОВ
        function showCaseDrops(caseType) {
            const caseItems = items[caseType];
            if (!caseItems) {
                showNoDropsMessage();
                return;
            }
            
            // Получаем цену кейса для расчётов
            const casePrice = parseInt(document.querySelector(`[data-case="${caseType}"]`).dataset.price);
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background: rgba(0, 0, 0, 0.8);
                z-index: 10006;
                display: flex;
                justify-content: center;
                align-items: center;
                padding: 20px;
                box-sizing: border-box;
            `;
            
            // Определяем название кейса
            const caseNames = {
                1: 'Хуюнтик', 2: 'Кизик', 3: 'Жало', 4: 'Шер', 5: 'Глист',
                6: 'Меофен', 7: 'ЧВК', 8: 'Берег', 9: 'Молот', 10: 'Вихрь',
                11: 'Призрак', 12: 'Лёд', 13: 'Огонь', 14: 'Тень', 15: 'Свет',
                16: 'Хаос', 17: 'Порядок', 18: 'Время', 19: 'Космос', 20: 'Вечность'
            };
            
            const caseName = caseNames[caseType] || `Кейс ${caseType}`;
            const isMobile = window.innerWidth <= 768;
            
            modal.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, #2c3e50, #34495e);
                    border: 3px solid #e74c3c;
                    border-radius: ${isMobile ? '15px' : '20px'};
                    padding: ${isMobile ? '20px 15px' : '30px'};
                    max-width: ${isMobile ? '350px' : '600px'};
                    width: ${isMobile ? '95vw' : 'auto'};
                    max-height: 80vh;
                    overflow-y: auto;
                    text-align: center;
                ">
                    <h2 style="color: #ffd700; font-size: ${isMobile ? '18px' : '24px'}; margin-bottom: ${isMobile ? '15px' : '20px'};">
                        📊 ДРОПЫ КЕЙСА "${caseName.toUpperCase()}"
                    </h2>
                    <div style="
                        display: grid;
                        grid-template-columns: ${isMobile ? '1fr' : 'repeat(auto-fit, minmax(250px, 1fr))'};
                        gap: ${isMobile ? '8px' : '12px'};
                        margin-bottom: ${isMobile ? '20px' : '25px'};
                    ">
                        ${caseItems.map(item => {
                            const dropColor = getDropValueColor(item, casePrice);
                            return `
                            <div style="
                                background: ${dropColor};
                                background: linear-gradient(145deg, ${dropColor}, ${dropColor}CC);
                                border-radius: ${isMobile ? '8px' : '10px'};
                                padding: ${isMobile ? '10px' : '12px'};
                                border: 2px solid rgba(255,255,255,0.3);
                                display: flex;
                                align-items: center;
                                gap: ${isMobile ? '8px' : '10px'};
                                text-align: left;
                                box-shadow: 0 2px 8px ${dropColor}40;
                            ">
                                <div style="
                                    width: ${isMobile ? '40px' : '50px'};
                                    height: ${isMobile ? '40px' : '50px'};
                                    background: rgba(255,255,255,0.1);
                                    border-radius: 6px;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    font-size: ${isMobile ? '16px' : '20px'};
                                    flex-shrink: 0;
                                ">📦</div>
                                <div style="flex-grow: 1;">
                                    <div style="color: #fff; font-size: ${isMobile ? '12px' : '14px'}; font-weight: bold; line-height: 1.2;">
                                        ${item.name}
                                    </div>
                                    <div style="color: #ffd700; font-size: ${isMobile ? '11px' : '13px'}; margin-top: 2px;">
                                        ${item.value} ꙮ
                                    </div>
                                </div>
                                <div style="
                                    background: rgba(255,255,255,0.2);
                                    border-radius: 4px;
                                    padding: ${isMobile ? '4px 6px' : '5px 8px'};
                                    font-size: ${isMobile ? '10px' : '12px'};
                                    font-weight: bold;
                                    color: #fff;
                                    text-align: center;
                                    min-width: ${isMobile ? '35px' : '40px'};
                                ">
                                    ${item.chance}%
                                </div>
                            </div>`;
                        }).join('')}
                    </div>
                    <div style="
                        background: rgba(255,255,255,0.1);
                        border-radius: ${isMobile ? '8px' : '10px'};
                        padding: ${isMobile ? '12px' : '15px'};
                        margin-bottom: ${isMobile ? '15px' : '20px'};
                        text-align: left;
                    ">
                        <h3 style="color: #ffd700; font-size: ${isMobile ? '14px' : '16px'}; margin-bottom: 8px;">📈 Статистика шансов:</h3>
                        <div style="color: #fff; font-size: ${isMobile ? '11px' : '13px'}; line-height: 1.4;">
                            🔴 Убыточные дропы: <strong>${caseItems.filter(item => item.value < casePrice).reduce((sum, item) => sum + item.chance, 0).toFixed(1)}%</strong><br>
                            🟡 Окупаемые дропы: <strong>${caseItems.filter(item => item.value >= casePrice && item.value < casePrice * 2).reduce((sum, item) => sum + item.chance, 0).toFixed(1)}%</strong><br>
                            🟢 Прибыльные дропы: <strong>${caseItems.filter(item => item.value >= casePrice * 2 && item.value < casePrice * 5).reduce((sum, item) => sum + item.chance, 0).toFixed(1)}%</strong><br>
                            💎 Джекпоты (Legendary): <strong>${caseItems.filter(item => item.value >= casePrice * 5 || item.rarity === 'legendary').reduce((sum, item) => sum + item.chance, 0).toFixed(1)}%</strong>
                        </div>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" style="
                        background: linear-gradient(145deg, #3498db, #2980b9);
                        color: white;
                        border: none;
                        padding: ${isMobile ? '12px 25px' : '15px 30px'};
                        border-radius: ${isMobile ? '10px' : '12px'};
                        font-size: ${isMobile ? '14px' : '16px'};
                        font-weight: bold;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        ${isMobile ? 'width: 100%; max-width: 200px;' : ''}
                    " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                        👍 Понятно
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Закрытие по клику на фон
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    document.body.removeChild(modal);
                }
            });
            
            console.log(`📊 Показаны дропы кейса ${caseName} с шансами в процентах`);
        }

        function openCase(caseType, price) {
            // 🚫 ПРОВЕРКА БЛОКИРОВКИ ОТ ГОСДОЛГА
            if (isBlocked) {
                showDebtMessage('Кейсы заблокированы! Погасите долг или покайтесь!', 'error');
                return;
            }
            
            // 🛡️ ЗАЩИТА ОТ КУЛДАУНА
            const now = Date.now();
            if (caseCooldowns[caseType] && now - caseCooldowns[caseType] < 2000) {
                console.log(`⏰ Кейс ${caseType} на кулдауне!`);
                const caseElement = document.querySelector(`[data-case="${caseType}"]`);
                if (caseElement) {
                    caseElement.style.opacity = '0.5';
                    setTimeout(() => {
                        caseElement.style.opacity = '1';
                    }, 300);
                }
                return;
            }
            
            if (balance < price) {
                // Только визуальная обратная связь - NO ROULETTE
                playErrorSound(); // Теперь только console.log
                const caseElement = document.querySelector(`[data-case="${caseType}"]`);
                if (caseElement) {
                    caseElement.classList.add('shake');
                    setTimeout(() => {
                        caseElement.classList.remove('shake');
                    }, 500);
                }
                // STOP HERE - don't continue to roulette
                return;
            }

            // 🛡️ УСТАНАВЛИВАЕМ КУЛДАУН
            caseCooldowns[caseType] = now;
            console.log(`🔒 Кейс ${caseType} заблокирован на 2 секунды`);

            // Only proceed with roulette if balance is sufficient
            balance -= price;
            
            // 🎨 СОХРАНЯЕМ ЦЕНУ ОТКРЫВАЕМОГО КЕЙСА ДЛЯ ПРАВИЛЬНЫХ ЦВЕТОВ!
            currentCasePrice = price;
            console.log(`🎨 Открываем кейс за ${price} ꙮ - сохранили цену для расчёта цветов`);
            
            updateBalance();
            
            // 🏛️ ПРОВЕРЯЕМ ГОСДОЛГ ПОСЛЕ ОТКРЫТИЯ КЕЙСА
            checkDebtOnCaseOpen();
            
            // 🛡️ ВКЛЮЧАЕМ ЗАЩИТУ РУЛЕТКИ
            rouletteProtection = true;
            console.log('🔒 РУЛЕТКА ПОЛНОСТЬЮ ЗАБЛОКИРОВАНА! Выход только после получения дропа!');
            
            // 🚫 БЛОКИРУЕМ ESC И ДРУГИЕ СПОСОБЫ ЗАКРЫТИЯ
            blockRouletteEscape();

            const rouletteSection = document.getElementById('rouletteSection');
            const rouletteStrip = document.getElementById('rouletteStrip');
            const rouletteResult = document.getElementById('rouletteResult');
            
            // Очищаем трек и сбрасываем состояние
            rouletteStrip.innerHTML = '';
            rouletteResult.classList.remove('show');
            currentItem = null;
            
            rouletteSection.classList.add('active');

            // Звуки отключены

            // 🎲 НОВАЯ СИСТЕМА ВЫБОРА ДРОПОВ ПО ПРОЦЕНТАМ
            const availableItems = items[caseType];
            const rouletteItems = [];
            
            // Функция выбора дропа по проценту шанса
            function getRandomItemByChance(items) {
                // Проверяем что сумма шансов = 100%
                const totalChance = items.reduce((sum, item) => sum + item.chance, 0);
                console.log(`🎲 Общий шанс кейса ${caseType}: ${totalChance}%`);
                
                // Генерируем случайное число от 0 до 100
                let random = Math.random() * 100;
                console.log(`🎲 Выпало число: ${random.toFixed(2)}%`);
                
                // Ищем какой дроп выпал
                let currentChance = 0;
                for (let item of items) {
                    currentChance += item.chance;
                    if (random <= currentChance) {
                        console.log(`🎯 Выпал дроп: ${item.name} (шанс ${item.chance}%, стоимость ${item.value} ꙮ)`);
                        return item;
                    }
                }
                
                // Fallback - самый частый дроп
                console.log('🔄 Fallback - берём самый частый дроп');
                return items.reduce((prev, current) => (prev.chance > current.chance) ? prev : current);
            }
            
            // 🎰 СОЗДАЁМ РУЛЕТКУ - СНАЧАЛА ОПРЕДЕЛЯЕМ ВЫИГРЫШ!
            const actualWinningItem = getRandomItemByChance(availableItems);
            console.log(`🎯 РЕАЛЬНЫЙ ВЫИГРЫШ: ${actualWinningItem.name} (${actualWinningItem.value} ꙮ, шанс ${actualWinningItem.chance}%)`);
            
            // Генерируем 30 дропов для визуального эффекта
            for (let i = 0; i < 30; i++) {
                if (i === 15) {
                    // 15-й элемент (центральный) - ставим РЕАЛЬНЫЙ выигрышный дроп!
                    rouletteItems.push(actualWinningItem);
                    console.log(`🎯 ВЫИГРЫШНЫЙ СЛОТ (15): ${actualWinningItem.name} - размещён в рулетке`);
                } else {
                    // Остальные слоты - случайные дропы для визуального эффекта
                    const visualItem = getRandomItemByChance(availableItems);
                    rouletteItems.push(visualItem);
                }
            }

            // Create roulette items
            // 🎨 ИСПОЛЬЗУЕМ СОХРАНЁННУЮ ЦЕНУ КЕЙСА ВМЕСТО ПОИСКА В DOM
            const casePrice = currentCasePrice; // Уже сохранена выше!
            
            rouletteItems.forEach((item, index) => {
                const dropType = getDropType(item, casePrice);
                const itemEl = document.createElement('div');
                itemEl.className = `roulette-item ${dropType}`;
                itemEl.dataset.index = index;
                itemEl.dataset.originalIndex = index; // Сохраняем оригинальный индекс
                itemEl.style.transition = 'all 0.2s'; // Для плавного выделения
                
                const imageDiv = document.createElement('div');
                imageDiv.style.cssText = `
                    font-size: 32px; 
                    margin-bottom: 8px; 
                    width: 80px; 
                    height: 80px; 
                    background-size: cover; 
                    background-position: center; 
                    margin: 0 auto 8px; 
                    display: flex; 
                    align-items: center; 
                    justify-content: center;
                    border-radius: 8px;
                    border: 2px solid rgba(255,255,255,0.3);
                `;
                
                // Простая загрузка изображения дропа
                loadDropImage(imageDiv, item.image);
                
                itemEl.appendChild(imageDiv);
                
                const nameDiv = document.createElement('div');
                nameDiv.style.cssText = 'font-size: 11px; text-align: center; margin-bottom: 4px; line-height: 1.2; max-width: 130px; word-wrap: break-word;';
                nameDiv.textContent = item.name;
                itemEl.appendChild(nameDiv);
                
                const valueDiv = document.createElement('div');
                valueDiv.style.cssText = 'font-size: 10px; color: #ffd700; font-weight: bold; text-align: center;';
                valueDiv.textContent = `${item.value} ꙮ`;
                itemEl.appendChild(valueDiv);
                
                rouletteStrip.appendChild(itemEl);
            });

            // Улучшенная анимация рулетки
            setTimeout(() => {
                // ОСТАНАВЛИВАЕМСЯ ТОЧНО НА 15-м элементе (где размещён реальный выигрыш)
                const stopIndex = 15; // Фиксированная остановка на выигрышном элементе!
                const itemWidth = 150; // Ширина одного элемента
                const containerWidth = document.querySelector('.roulette-container').offsetWidth;
                const centerPosition = containerWidth / 2; // Центр контейнера
                
                // Точный расчёт для остановки ПОД СТРЕЛКОЙ
                const offset = -(stopIndex * itemWidth) + centerPosition - (itemWidth / 2);
                
                // Сбрасываем позицию
                rouletteStrip.style.transition = 'none';
                rouletteStrip.style.transform = 'translateX(0)';
                void rouletteStrip.offsetWidth; // Принудительный reflow
                
                // Запускаем анимацию с улучшенной кривой замедления
                rouletteStrip.style.transition = 'transform 5s cubic-bezier(0.2, 0.8, 0.2, 1)';
                rouletteStrip.style.transform = `translateX(${offset}px)`;
                
                console.log(`🎰 Рулетка: остановка ТОЧНО на элементе 15 - ${actualWinningItem.name}`);
                
                // Выделяем выигрышный элемент во время анимации
                setTimeout(() => {
                    const winningElement = rouletteStrip.children[15]; // Всегда 15-й элемент!
                    if (winningElement) {
                        winningElement.style.transform = 'scale(1.1)';
                        winningElement.style.filter = 'brightness(1.3)';
                        winningElement.style.boxShadow = '0 0 20px rgba(255, 215, 0, 0.8)';
                    }
                }, 4500); // Выделяем за 0.5 сек до окончания анимации
                
                // После анимации показываем результат
                setTimeout(() => {
                    // ПОКАЗЫВАЕМ РЕАЛЬНЫЙ ВЫИГРЫШНЫЙ ДРОП (не тот что под стрелкой!)
                    console.log(`🏆 ИТОГОВЫЙ РЕЗУЛЬТАТ: ${actualWinningItem.name} (${actualWinningItem.value} ꙮ, шанс ${actualWinningItem.chance}%)`);
                    
                    // 🎵 ПРОИГРЫВАЕМ ЗВУК В ЗАВИСИМОСТИ ОТ РЕДКОСТИ И ЦЕННОСТИ
                    playDropSoundByRarity(actualWinningItem);
                    
                    showResult(actualWinningItem);
                    
                    // 🛡️ ОТКЛЮЧАЕМ ЗАЩИТУ ПОСЛЕ ПОКАЗА РЕЗУЛЬТАТА
                    rouletteProtection = false;
                    unblockRouletteEscape();
                    console.log('🎯 Результат показан - защита отключена, можно выбирать действие');
                }, 5200); // Показываем результат через 5.2 секунды
            }, 300);
        }

        function showResult(item) {
            currentItem = item;
            
            const rouletteResult = document.getElementById('rouletteResult');
            const resultItemImage = document.getElementById('resultItemImage');
            const resultItemName = document.getElementById('resultItemName');
            const resultItemValue = document.getElementById('resultItemValue');
            
            // 🎨 ИСПРАВЛЕНО: Используем цену ТОГО КЕЙСА который открывали, а не дефолтную 120!
            const openedCasePrice = getCurrentCasePrice(); // Получаем реальную цену открытого кейса
            const dropColor = getDropValueColor(item, openedCasePrice);
            resultItemImage.style.background = dropColor;
            resultItemImage.style.border = `3px solid ${dropColor}`;
            resultItemImage.style.boxShadow = `0 0 20px ${dropColor}60`;
            resultItemImage.innerHTML = '';
            
            // Простая загрузка изображения дропа
            loadDropImage(resultItemImage, item.image);
            
            resultItemName.textContent = item.name;
            resultItemValue.textContent = `Стоимость: ${item.value} ꙮ`;
            
            // Show result with animation
            rouletteResult.classList.add('show');
            
            // Animate item image (scale up effect)
            setTimeout(() => {
                resultItemImage.classList.add('animate');
            }, 100);
            
            console.log(`🎨 Результат: ${item.name} (${item.value} ꙮ) vs кейс (${openedCasePrice} ꙮ) = цвет ${dropColor}`);
        }

        function keepItem() {
            if (currentItem) {
                // 🎨 СОХРАНЯЕМ ЦЕНУ КЕЙСА В ДРОП ДЛЯ ПРАВИЛЬНЫХ ЦВЕТОВ В ИНВЕНТАРЕ
                currentItem.casePrice = currentCasePrice;
                inventory.push(currentItem);
                updateInventory();
                saveGameData(); // Save when keeping item
                hideResult();
                
                // 💡 ПРОВЕРЯЕМ ОТЛОЖЕННУЮ ПОДСКАЗКУ ПОСЛЕ ДЕЙСТВИЯ
                checkPendingBonusHint();
            }
        }

        function sellItem() {
            if (currentItem) {
                // 🎨 СОХРАНЯЕМ ЦЕНУ КЕЙСА В ДРОП ПЕРЕД ДОБАВЛЕНИЕМ В WINGLIST
                currentItem.casePrice = currentCasePrice;
                balance += currentItem.value;
                updateBalance();
                addToWinglist(currentItem);
                saveGameData(); // Save when selling item
                hideResult();
                
                // 💡 ПРОВЕРЯЕМ ОТЛОЖЕННУЮ ПОДСКАЗКУ ПОСЛЕ ДЕЙСТВИЯ
                checkPendingBonusHint();
            }
        }

        function hideResult() {
            document.getElementById('rouletteResult').classList.remove('show');
            document.getElementById('rouletteSection').classList.remove('active');
            document.getElementById('resultItemImage').classList.remove('animate');
            
            // 🛡️ ОТКЛЮЧАЕМ ЗАЩИТУ РУЛЕТКИ
            rouletteProtection = false;
            unblockRouletteEscape();
            console.log('🔓 Защита рулетки ОТКЛЮЧЕНА - можно нормально кликать по сайту');
            
            // Останавливаем все звуки
            if (rollSound && !rollSound.paused) {
                rollSound.pause();
                rollSound.currentTime = 0;
            }
            if (dropSound && !dropSound.paused) {
                dropSound.pause();
                dropSound.currentTime = 0;
            }
            
            // Сбрасываем рулетку для следующего использования
            const rouletteStrip = document.getElementById('rouletteStrip');
            rouletteStrip.style.transition = 'none';
            rouletteStrip.style.transform = 'translateX(0)';
            
            // Убираем выделение с элементов
            const highlightedItems = rouletteStrip.querySelectorAll('.roulette-item[style*="scale"]');
            highlightedItems.forEach(item => {
                item.style.transform = '';
                item.style.filter = '';
                item.style.boxShadow = '';
            });
            
            currentItem = null;
            
            // 💡 ПРОВЕРЯЕМ ОТЛОЖЕННУЮ ПОДСКАЗКУ ПОСЛЕ ЗАКРЫТИЯ РУЛЕТКИ
            checkPendingBonusHint();
        }

        // 🛡️ ПОЛНАЯ ЗАЩИТА РУЛЕТКИ ОТ МИСКЛИКОВ
        document.getElementById('rouletteSection').addEventListener('click', function(e) {
            // БЛОКИРУЕМ ВСЕ КЛИКИ ВОКРУГ РУЛЕТКИ!
            if (e.target === this) {
                if (rouletteProtection && currentItem === null) {
                    // Рулетка крутится - НИКАКИХ ДЕЙСТВИЙ!
                    console.log('🔒 Рулетка заблокирована! Ждите результата!');
                    showBlockedMessage();
                    return false;
                } else if (currentItem !== null && !rouletteProtection) {
                    // Дроп выпал, но кликнули ВНЕ кнопок - НЕ ЗАКРЫВАЕМ!
                    console.log('⚠️ Кликнули вне кнопок действия - рулетка остается открытой!');
                    showMisclickWarning();
                    return false;
                }
            }
        });

        // Close item menu on background click
        document.getElementById('itemMenuModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeItemMenu();
            }
        });

        // Avatar functions
        function handleAvatarClick() {
            // Клик на аватар сразу открывает меню профиля
            openProfileMenu();
        }

        function openAvatarUpload() {
            const input = document.getElementById('avatarUploadInput');
            input.click();
        }

        function handleAvatarUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Проверяем размер файла (5 МБ максимум)
            if (file.size > 5 * 1024 * 1024) {
                alert('Файл слишком большой! Максимальный размер: 5 МБ');
                return;
            }

            // Проверяем тип файла
            if (!file.type.startsWith('image/')) {
                alert('Пожалуйста, выберите изображение!');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const avatarData = e.target.result;
                
                // Создаем превью для подтверждения
                const preview = document.createElement('div');
                preview.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100vw;
                    height: 100vh;
                    background: rgba(0,0,0,0.8);
                    z-index: 10003;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    flex-direction: column;
                `;
                
                preview.innerHTML = `
                    <div style="background: #2c3e50; padding: 30px; border-radius: 20px; text-align: center; border: 3px solid #e74c3c;">
                        <h3 style="color: #ffd700; margin-bottom: 20px;">Предпросмотр аватара</h3>
                        <div style="
                            width: 120px; 
                            height: 120px; 
                            border-radius: 50%; 
                            background-image: url('${avatarData}');
                            background-size: cover;
                            background-position: center;
                            margin: 0 auto 20px;
                            border: 3px solid #ffd700;
                        "></div>
                        <div style="display: flex; gap: 15px; justify-content: center;">
                            <button id="confirmAvatar" style="
                                background: #27ae60; color: white; border: none; padding: 12px 25px; 
                                border-radius: 10px; cursor: pointer; font-size: 16px;
                            ">✅ Установить</button>
                            <button id="cancelAvatar" style="
                                background: #e74c3c; color: white; border: none; padding: 12px 25px; 
                                border-radius: 10px; cursor: pointer; font-size: 16px;
                            ">❌ Отмена</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(preview);
                
                // Обработчики кнопок
                document.getElementById('confirmAvatar').onclick = () => {
                    setUserAvatar(avatarData);
                    document.body.removeChild(preview);
                };
                
                document.getElementById('cancelAvatar').onclick = () => {
                    document.body.removeChild(preview);
                };
            };
            
            reader.readAsDataURL(file);
            
            // Очищаем input для повторной загрузки того же файла
            event.target.value = '';
        }

        function setUserAvatar(avatarData) {
            userAvatar = avatarData;
            
            // Обновляем все аватары на странице
            const profileAvatar = document.getElementById('profileAvatar');
            profileAvatar.style.backgroundImage = `url('${avatarData}')`;
            profileAvatar.style.backgroundSize = 'cover';
            profileAvatar.style.backgroundPosition = 'center';
            profileAvatar.textContent = '';
            
            // Сохраняем в localStorage
            saveGameData();
            
            console.log('✅ Аватар успешно установлен и сохранён!');
        }

        // Profile menu functions
        function openProfileMenu() {
            const profileMenuModal = document.getElementById('profileMenuModal');
            const profileMenuAvatar = document.getElementById('profileMenuAvatar');
            const nicknameInput = document.getElementById('nicknameInput');
            const promocodeInput = document.getElementById('promocodeInput');
            const promocodeMessage = document.getElementById('promocodeMessage');
            
            // Update avatar preview
            if (userAvatar) {
                profileMenuAvatar.style.backgroundImage = `url('${userAvatar}')`;
                profileMenuAvatar.style.backgroundSize = 'cover';
                profileMenuAvatar.style.backgroundPosition = 'center';
                profileMenuAvatar.textContent = '';
            } else {
                profileMenuAvatar.style.backgroundImage = 'none';
                profileMenuAvatar.textContent = '👤';
            }
            
            // Load current nickname
            nicknameInput.value = userNickname;
            
            // НЕ ОЧИЩАЕМ промокод при открытии меню - сохраняем то что было введено
            // promocodeInput.value = ''; // УБРАЛИ ЭТУ СТРОКУ
            promocodeMessage.style.display = 'none';
            
            profileMenuModal.classList.add('active');
        }

        function closeProfileMenu() {
            document.getElementById('profileMenuModal').classList.remove('active');
        }

        function saveProfile() {
            const nicknameInput = document.getElementById('nicknameInput');
            const newNickname = nicknameInput.value.trim();
            
            if (newNickname.length > 0) {
                userNickname = newNickname;
                saveGameData(); // Save to localStorage
                closeProfileMenu();
                
                // 🔥 НЕ ОЧИЩАЕМ промокод при сохранении профиля!
                console.log('✅ Профиль сохранён, промокод остался в поле');
            } else {
                alert('Введите корректный никнейм!');
            }
        }

        // Close profile menu on background click
        document.getElementById('profileMenuModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeProfileMenu();
            }
        });

        // Functions for no drops modal
        function showNoDropsMessage() {
            document.getElementById('noDropsModal').classList.add('active');
        }

        function closeNoDropsModal() {
            document.getElementById('noDropsModal').classList.remove('active');
        }

        // Close no drops modal on background click
        document.getElementById('noDropsModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeNoDropsModal();
            }
        });

        // Balance editing functionality
        function handleBalanceClick(event) {
            // Prevent text selection
            event.preventDefault();
            event.stopPropagation();
            
            balanceClickCount++;
            
            // Clear existing timer
            if (balanceClickTimer) {
                clearTimeout(balanceClickTimer);
            }
            
            // Set timer to reset click count
            balanceClickTimer = setTimeout(() => {
                balanceClickCount = 0;
            }, 800); // Increased timeout for easier triple clicking
            
            // Check for triple click
            if (balanceClickCount === 3) {
                // Triple click detected - enable balance editing
                enableBalanceEditing();
                balanceClickCount = 0;
                clearTimeout(balanceClickTimer);
            } else if (balanceClickCount === 1) {
                // Visual feedback for first click
                const balanceEl = document.getElementById('balance');
                balanceEl.style.backgroundColor = 'rgba(255, 215, 0, 0.2)';
                setTimeout(() => {
                    balanceEl.style.backgroundColor = '';
                }, 200);
            }
        }

        function enableBalanceEditing() {
            const balanceEl = document.getElementById('balance');
            const currentBalance = balance;
            
            // Create input field
            const input = document.createElement('input');
            input.type = 'number';
            input.value = currentBalance;
            input.style.cssText = `
                background: #2c3e50;
                color: #ffd700;
                border: 2px solid #e74c3c;
                border-radius: 5px;
                padding: 2px 5px;
                font-size: 18px;
                font-weight: bold;
                width: 100px;
                text-align: center;
            `;
            
            // Replace balance text with input
            balanceEl.innerHTML = '';
            balanceEl.appendChild(input);
            input.focus();
            input.select();
            
            // Handle input completion
            function finishEditing() {
                const newBalance = parseInt(input.value) || 0;
                if (newBalance >= 0) {
                    balance = Math.max(0, newBalance); // Prevent negative balance
                    updateBalance();
                    console.log(`💰 Баланс изменён на: ${balance} ꙮ`);
                } else {
                    // Restore original balance if invalid input
                    balanceEl.textContent = currentBalance;
                }
            }
            
            // Listen for Enter key or blur
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    finishEditing();
                }
                if (e.key === 'Escape') {
                    balanceEl.textContent = currentBalance;
                }
            });
            
            input.addEventListener('blur', finishEditing);
            
            // 🔥 УБРАЛ автосохранение через 5 секунд - оно мешало!
        }

        // Promocode system
        let usedPromocodes = [];
        let promocodeClickCount = 0;
        let promocodeClickTimer = null;
        
        function activatePromocode() {
            const promocodeInput = document.getElementById('promocodeInput');
            const promocodeMessage = document.getElementById('promocodeMessage');
            const promocode = promocodeInput.value.trim().toUpperCase();
            
            if (!promocode) {
                showPromocodeMessage('Введите промокод!', 'error');
                return;
            }
            
            // Check if promocode was already used
            if (usedPromocodes.includes(promocode)) {
                showPromocodeMessage('Промокод уже был использован!', 'error');
                return;
            }
            
            // Available promocodes
            const promocodes = {
                'GLISTOK': {
                    bonus: 500,
                    description: '+500 ꙮ на баланс'
                },
                'MEOFEN': {
                    bonus: 300,
                    description: '+300 ꙮ на баланс'
                },
                'IVA STUDIO': {
                    bonus: 1000,
                    description: '+1000 ꙮ на баланс'
                },
                'BONUS': {
                    bonus: 200,
                    description: '+200 ꙮ на баланс'
                },
                'START': {
                    bonus: 100,
                    description: '+100 ꙮ на баланс'
                },
                'GLIST': {
                    bonus: 0,
                    description: 'Особый промокод - СКРИМЕР',
                    special: 'jumpscare'
                }
            };
            
            console.log(`🔍 Проверяем промокод: "${promocode}"`);
            console.log('📋 Доступные промокоды:', Object.keys(promocodes));
            console.log('🚫 Использованные промокоды:', usedPromocodes);
            
            if (promocodes[promocode]) {
                const promoData = promocodes[promocode];
                console.log(`✅ Промокод найден: ${promocode}`, promoData);
                
                // Special handling for GLIST promocode
                if (promoData.special === 'jumpscare') {
                    console.log('👻 GLIST промокод активирован - запускаем скример!');
                    
                    // Сначала показываем сообщение
                    showPromocodeMessage('😈 GLIST активирован! ГОТОВЬСЯ...', 'success');
                    promocodeInput.value = '';
                    
                    // Добавляем в использованные
                    usedPromocodes.push(promocode);
                    saveGameData();
                    
                    // Закрываем меню
                    setTimeout(() => {
                        closeProfileMenu();
                        
                        // Запускаем скример через небольшую задержку
                        setTimeout(() => {
                            executeJumpscare();
                        }, 500);
                    }, 1000);
                    
                    return;
                }
                
                // Regular promocode handling
                balance += promoData.bonus;
                showPromocodeMessage(`✅ Промокод активирован! ${promoData.description}`, 'success');
                
                usedPromocodes.push(promocode);
                updateBalance(); // Это автоматически скроет подсказку BONUS если баланс > 0
                saveGameData();
                promocodeInput.value = ''; // Очищаем ТОЛЬКО после успешной активации!
                
                console.log(`🎁 Промокод "${promocode}" активирован: +${promoData.bonus} ꙮ`);
            } else {
                console.log(`❌ Промокод "${promocode}" не найден!`);
                showPromocodeMessage('❌ Неверный промокод!', 'error');
            }
        }
        
        function showPromocodeMessage(message, type) {
            const promocodeMessage = document.getElementById('promocodeMessage');
            promocodeMessage.textContent = message;
            promocodeMessage.style.display = 'block';
            
            if (type === 'success') {
                promocodeMessage.style.color = '#27ae60';
            } else if (type === 'error') {
                promocodeMessage.style.color = '#e74c3c';
            }
            
            // Hide message after 3 seconds
            setTimeout(() => {
                promocodeMessage.style.display = 'none';
            }, 3000);
        }
        
        // Handle Enter key in promocode input
        function handlePromocodeKeydown(event) {
            if (event.key === 'Enter') {
                activatePromocode();
            }
        }
        
        // Cheat function: Triple click on promocode input to reset EVERYTHING
        function handlePromocodeInputClick(event) {
            promocodeClickCount++;
            
            // Clear existing timer
            if (promocodeClickTimer) {
                clearTimeout(promocodeClickTimer);
            }
            
            // Set timer to reset click count
            promocodeClickTimer = setTimeout(() => {
                promocodeClickCount = 0;
            }, 800);
            
            // Check for triple click
            if (promocodeClickCount === 3) {
                resetEverything();
                promocodeClickCount = 0;
                clearTimeout(promocodeClickTimer);
            }
        }
        
        // ULTIMATE CHEAT: Reset EVERYTHING including credit history
        function resetEverything() {
            // Сброс промокодов
            usedPromocodes = [];
            
            // СБРОС КРЕДИТНОЙ ИСТОРИИ - ГЛАВНОЕ!
            hasBadCredit = false;
            
            // СБРОС ПОДСКАЗКИ BONUS
            bonusHintShown = false;
            pendingBonusHint = false;
            pendingBonusHint = false;
            pendingBonusHint = false;
            
            // Убираем блокировки если есть
            isBlocked = false;
            hasDebt = false;
            debtCasesLeft = 0;
            debtAmount = 500;
            
            // Обновляем все интерфейсы
            updateDebtStatus();
            if (isBlocked) {
                hideBlockBanner();
            }
            
            // Сохраняем изменения
            saveGameData();
            
            const promocodeMessage = document.getElementById('promocodeMessage');
            promocodeMessage.innerHTML = `
                <div style="color: #27ae60; font-weight: bold;">🔄 ВСЁ СБРОШЕНО!</div>
                <div style="color: #ffd700; font-size: 10px; margin-top: 2px;">
                    ✅ Промокоды сброшены<br>
                    ✅ Кредитная история очищена<br>
                    ✅ Подсказка BONUS сброшена<br>
                    ✅ Госдолг снова доступен
                </div>
            `;
            promocodeMessage.style.display = 'block';
            promocodeMessage.style.fontSize = '11px';
            
            // Hide message after 5 seconds
            setTimeout(() => {
                promocodeMessage.style.display = 'none';
            }, 5000);
            
            console.log('🔥 ULTIMATE CHEAT: Промокоды + кредитная история + подсказка BONUS ПОЛНОСТЬЮ сброшены!');
            console.log('💰 Теперь можно снова брать госдолг и использовать все промокоды!');
        }
        
        // 💡 ГЛОБАЛЬНЫЕ ФУНКЦИИ ДЛЯ КНОПОК
        window.closeBonusModal = function() {
            const modal = document.getElementById('bonus-modal');
            if (modal) {
                document.body.removeChild(modal);
                bonusHintShown = true; // Помечаем что показали
                saveGameData(); // Сохраняем флаг
                console.log('💡 Менюшка BONUS закрыта, больше не показываем');
            }
        };
        
        window.closeDebtSelectionMenu = function() {
            const modal = document.getElementById('debt-selection-modal');
            if (modal) {
                document.body.removeChild(modal);
            }
        };

        // 👻 СКРИМЕР С PNG ИЗОБРАЖЕНИЕМ НА ВЕСЬ ЭКРАН
        function executeJumpscare() {
            console.log('😈 GLIST СКРИМЕР ЗАПУЩЕН! 👻');
            
            // 🔊 МАКСИМАЛЬНЫЙ ЗВУК БЕЗ ДОСТУПА К МИКРОФОНУ!
            
            // Создаем контейнер скримера БЕЗ ЗАТЕМНЕНИЯ
            const screamer = document.createElement('div');
            screamer.id = 'glist-screamer';
            screamer.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background: transparent;
                z-index: 999999;
                display: flex;
                justify-content: center;
                align-items: center;
                overflow: hidden;
            `;
            
            // Добавляем CSS анимацию тряски
            if (!document.getElementById('glist-shake-style')) {
                const style = document.createElement('style');
                style.id = 'glist-shake-style';
                style.textContent = `
                    @keyframes glistShake {
                        0% { transform: translate(0, 0) rotate(0deg) scale(1); }
                        10% { transform: translate(-8px, -8px) rotate(-2deg) scale(1.02); }
                        20% { transform: translate(8px, -8px) rotate(2deg) scale(0.98); }
                        30% { transform: translate(-8px, 8px) rotate(-1deg) scale(1.01); }
                        40% { transform: translate(8px, 8px) rotate(2deg) scale(0.99); }
                        50% { transform: translate(-8px, -8px) rotate(-2deg) scale(1.02); }
                        60% { transform: translate(8px, -8px) rotate(1deg) scale(0.98); }
                        70% { transform: translate(-8px, 8px) rotate(-2deg) scale(1.01); }
                        80% { transform: translate(8px, 8px) rotate(2deg) scale(0.99); }
                        90% { transform: translate(-8px, -8px) rotate(-1deg) scale(1.01); }
                        100% { transform: translate(0, 0) rotate(0deg) scale(1); }
                    }
                    
                    @keyframes glistPulse {
                        0%, 100% { 
                            filter: brightness(1) contrast(1) hue-rotate(0deg);
                            transform: scale(1);
                        }
                        25% { 
                            filter: brightness(1.3) contrast(1.5) hue-rotate(10deg);
                            transform: scale(1.05);
                        }
                        50% { 
                            filter: brightness(0.8) contrast(2) hue-rotate(-10deg);
                            transform: scale(0.95);
                        }
                        75% { 
                            filter: brightness(1.2) contrast(1.2) hue-rotate(15deg);
                            transform: scale(1.03);
                        }
                    }
                    
                    .glist-image-effect {
                        animation: glistShake 0.1s infinite, glistPulse 0.3s infinite;
                    }
                `;
                document.head.appendChild(style);
            }
            
            // Добавляем скример на страницу
            document.body.appendChild(screamer);
            
            // 🔊 ЗВУК С МАКСИМАЛЬНОЙ ГРОМКОСТЬЮ
            playMaxVolumeScreamerSound();
            
            // 🖼️ ЗАГРУЖАЕМ PNG ИЗОБРАЖЕНИЕ
            setTimeout(() => {
                console.log('🖼️ Загружаем PNG изображение на весь экран...');
                
                const glistImage = document.createElement('img');
                glistImage.src = 'glist.png'; // Твоё изображение в корневой папке
                
                // Определяем мобильную версию
                const isMobile = window.innerWidth <= 768;
                
                glistImage.style.cssText = `
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100vw;
                    height: 100vh;
                    object-fit: ${isMobile ? 'contain' : 'cover'};
                    object-position: center;
                    z-index: 1000000;
                    background: transparent;
                    image-rendering: ${isMobile ? 'crisp-edges' : 'auto'};
                `;
                
                // Когда изображение загрузилось
                glistImage.onload = () => {
                    console.log('✅ PNG изображение загружено! Показываем на весь экран.');
                    
                    // Очищаем контейнер и добавляем изображение
                    screamer.innerHTML = '';
                    screamer.appendChild(glistImage);
                    
                    // Добавляем эффекты тряски и пульсации
                    glistImage.classList.add('glist-image-effect');
                    
                    // 📱 АДАПТАЦИЯ ДЛЯ МОБИЛЬНЫХ - дополнительные эффекты
                    if (isMobile) {
                        // Отключаем скролл на время скримера
                        document.body.style.overflow = 'hidden';
                        document.documentElement.style.overflow = 'hidden';
                        
                        // Блокируем зум на мобильных
                        const viewport = document.querySelector('meta[name=viewport]');
                        if (viewport) {
                            viewport.content = 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no';
                        }
                        
                        console.log('📱 Мобильная адаптация скримера активирована');
                    }
                };
                
                // Если изображение не загрузилось - показываем резервный текст
                glistImage.onerror = () => {
                    console.log('❌ PNG изображение не найдено - показываем резервный текст');
                    showFallbackScreamerText(screamer, isMobile);
                };
                
            }, 300); // Уменьшили задержку для более быстрого появления
            
            // Удаляем скример через 8 секунд (уменьшили время)
            setTimeout(() => {
                if (document.getElementById('glist-screamer')) {
                    // Восстанавливаем скролл на мобильных
                    if (window.innerWidth <= 768) {
                        document.body.style.overflow = '';
                        document.documentElement.style.overflow = '';
                        
                        // Восстанавливаем viewport
                        const viewport = document.querySelector('meta[name=viewport]');
                        if (viewport) {
                            viewport.content = 'width=device-width, initial-scale=1.0';
                        }
                    }
                    
                    document.body.removeChild(screamer);
                    console.log('🔚 Скример завершён');
                }
            }, 8000);
        }
        
        // 📱 РЕЗЕРВНЫЙ ТЕКСТОВЫЙ СКРИМЕР (если PNG не загрузился)
        function showFallbackScreamerText(screamer, isMobile) {
            const textScreamer = document.createElement('div');
            textScreamer.id = 'text-screamer';
            textScreamer.style.cssText = `
                color: #ff0000;
                font-size: ${isMobile ? '12vw' : '15vw'};
                font-weight: bold;
                text-align: center;
                font-family: Arial, sans-serif;
                animation: glistShake 0.1s infinite;
                text-shadow: 0 0 50px #ff0000, 0 0 100px #ff0000, 0 0 150px #ff0000;
                width: 100%;
                height: 100%;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                background: rgba(0, 0, 0, 0.3);
                backdrop-filter: blur(2px);
            `;
            
            textScreamer.innerHTML = `
                <div style="line-height: 0.9;">👻 GLIST! 👻</div>
                <div style="
                    font-size: ${isMobile ? '6vw' : '8vw'}; 
                    color: #ffff00; 
                    margin-top: ${isMobile ? '15px' : '20px'}; 
                    text-shadow: 0 0 30px #ffff00, 0 0 60px #ffff00;
                    line-height: 1;
                ">
                    ИСПУГАЛСЯ?! 😈
                </div>
            `;
            
            screamer.appendChild(textScreamer);
            console.log('📱 Резервный текстовый скример активирован');
        }



        // 🔊 МАКСИМАЛЬНЫЙ ЗВУК СКРИМЕРА - ИСПРАВЛЕННАЯ ВЕРСИЯ!
        function playMaxVolumeScreamerSound() {
            console.log('🔊 ЗАПУСК МАКСИМАЛЬНОГО ЗВУКА СКРИМЕРА!');
            
            // Создаём ОДИН основной аудио элемент
            const screamAudio = new Audio();
            screamAudio.volume = 1.0;
            screamAudio.preload = 'auto';
            
            // НЕМЕДЛЕННО устанавливаем источник
            screamAudio.src = 'scream.mp3';
            
            console.log('🔊 Попытка загрузки scream.mp3...');
            
            // Обработчик успешной загрузки
            screamAudio.addEventListener('canplaythrough', function() {
                console.log('✅ scream.mp3 загружен и готов к воспроизведению!');
                
                // НЕМЕДЛЕННО воспроизводим
                screamAudio.play().then(() => {
                    console.log('🔊 SCREAM.MP3 УСПЕШНО ВОСПРОИЗВОДИТСЯ!');
                }).catch(error => {
                    console.log('❌ Ошибка воспроизведения scream.mp3:', error);
                    // Запускаем запасной звук
                    playGeneratedMaxScream();
                });
            });
            
            // Обработчик ошибки загрузки
            screamAudio.addEventListener('error', function(e) {
                console.log('❌ Ошибка загрузки scream.mp3:', e);
                // Запускаем запасной звук
                playGeneratedMaxScream();
            });
            
            // Принудительная загрузка
            screamAudio.load();
            
            // Запасной таймер - если файл не загрузился за 500ms
            setTimeout(() => {
                if (screamAudio.readyState < 3) { // Если не загружен
                    console.log('⏰ scream.mp3 не загрузился за 500ms, запускаем запасной звук');
                    playGeneratedMaxScream();
                }
            }, 500);
            
            // Дополнительная попытка воспроизведения через 1 секунду
            setTimeout(() => {
                if (screamAudio.readyState >= 3) { // Если файл загружен
                    screamAudio.play().then(() => {
                        console.log('🔊 ПОВТОРНАЯ ПОПЫТКА: scream.mp3 воспроизводится!');
                    }).catch(error => {
                        console.log('❌ Повторная попытка неудачна:', error);
                    });
                }
            }, 1000);
        }
        
        // 🔊 ГЕНЕРИРОВАННЫЙ МАКСИМАЛЬНЫЙ ЗВУК СКРИМЕРА
        function playGeneratedMaxScream() {
            console.log('🎵 ЗАПУСК СИНТЕЗИРОВАННОГО СКРИМЕРА!');
            
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // 🎵 РАЗБЛОКИРОВКА АУДИО КОНТЕКСТА (важно для современных браузеров)
                if (audioContext.state === 'suspended') {
                    audioContext.resume().then(() => {
                        console.log('🔓 AudioContext разблокирован!');
                        generateScreamSound(audioContext);
                    });
                } else {
                    generateScreamSound(audioContext);
                }
                
            } catch (e) {
                console.log('🔊 Ошибка создания AudioContext:', e);
                
                // Резервный метод - попытка создать простой аудио элемент
                tryFallbackAudio();
            }
        }
        
        // 🎵 ФУНКЦИЯ ГЕНЕРАЦИИ ЗВУКА
        function generateScreamSound(audioContext) {
            try {
                // 🔊 МНОЖЕСТВЕННЫЕ ОСЦИЛЛЯТОРЫ ДЛЯ МАКСИМАЛЬНОГО ХАОСА
                const oscillators = [];
                const masterGain = audioContext.createGain();
                masterGain.connect(audioContext.destination);
                
                // МАКСИМАЛЬНАЯ ГРОМКОСТЬ!
                masterGain.gain.setValueAtTime(1.0, audioContext.currentTime);
                
                // Создаём 5 осцилляторов с разными частотами для жуткого звука
                const frequencies = [150, 300, 450, 600, 800];
                const waveTypes = ['sawtooth', 'square', 'triangle', 'sine', 'sawtooth'];
                
                frequencies.forEach((baseFreq, i) => {
                    const osc = audioContext.createOscillator();
                    const oscGain = audioContext.createGain();
                    
                    osc.connect(oscGain);
                    oscGain.connect(masterGain);
                    
                    // Хаотичные частоты для страшного эффекта
                    const startFreq = baseFreq + (Math.random() * 100);
                    const midFreq = baseFreq * 2 + (Math.random() * 200);
                    const endFreq = baseFreq * 0.5 + (Math.random() * 50);
                    
                    osc.frequency.setValueAtTime(startFreq, audioContext.currentTime);
                    osc.frequency.exponentialRampToValueAtTime(midFreq, audioContext.currentTime + 0.3);
                    osc.frequency.exponentialRampToValueAtTime(endFreq, audioContext.currentTime + 0.8);
                    osc.frequency.exponentialRampToValueAtTime(startFreq * 1.5, audioContext.currentTime + 1.5);
                    
                    // Громкость каждого осциллятора
                    oscGain.gain.setValueAtTime(0.3, audioContext.currentTime);
                    oscGain.gain.exponentialRampToValueAtTime(0.6, audioContext.currentTime + 0.2);
                    oscGain.gain.exponentialRampToValueAtTime(0.1, audioContext.currentTime + 1.5);
                    oscGain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 2);
                    
                    osc.type = waveTypes[i];
                    osc.start();
                    osc.stop(audioContext.currentTime + 2);
                    
                    oscillators.push(osc);
                });
                
                // 📱 Дополнительные низкие частоты для мобильных (они лучше передают низы)
                const bassOsc = audioContext.createOscillator();
                const bassGain = audioContext.createGain();
                
                bassOsc.connect(bassGain);
                bassGain.connect(masterGain);
                
                bassOsc.frequency.setValueAtTime(50, audioContext.currentTime);
                bassOsc.frequency.exponentialRampToValueAtTime(80, audioContext.currentTime + 0.5);
                bassOsc.frequency.exponentialRampToValueAtTime(30, audioContext.currentTime + 1);
                
                bassGain.gain.setValueAtTime(0.4, audioContext.currentTime);
                bassGain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1.5);
                
                bassOsc.type = 'sine';
                bassOsc.start();
                bassOsc.stop(audioContext.currentTime + 1.5);
                
                console.log('🔊 СГЕНЕРИРОВАННЫЙ МАКСИМАЛЬНЫЙ ЗВУК СКРИМЕРА ЗАПУЩЕН!');
                
            } catch (e) {
                console.log('🔊 Ошибка генерации звука:', e);
            }
        }
        
        // 🔊 ФУНКЦИЯ РЕЗЕРВНОГО АУДИО
        function tryFallbackAudio() {
            try {
                // Последний резерв - системный звук браузера
                try {
                    // Создаём короткий звуковой сигнал
                    const audioElement = document.createElement('audio');
                    audioElement.volume = 1.0;
                    audioElement.autoplay = true;
                    
                    // Используем data URL для простого звука
                    const soundData = 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LGcSEFl31ydJj8q2ApBTiR1+TGcSEHPIXL8NiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LGcSEGl31ydJj8q2ApBTiR1+TGcSEHPIXL8NiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LGcSEGl31ydJj8q2ApBTiR1+TGcSEHPIXL8NiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LGcSEGl31ydJj8q2ApBTiR1+TGcSEHPIXL8NiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LGcSEGl31ydJj8q2ApBTiR1+TGcSEHPIXL8NiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LGcSEGl31ydJj8q2ApBTiR1+TGcSEHPIXL8NiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LGcSEGl31ydJj8q2ApBTiR1+TGcSEHPIXL8NiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LGcSEGl31ydJj8q2ApBTiR1+TGcSEHPIXL8NiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LGcSEGl31ydJj8q2ApBTiR1+TGcSEHPIXL8NiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LGcSEGl31ydJj8q2ApBTiR1+TGcSEHPIXL8NiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LGcSEGl31ydJj8q2ApBTiR1+TGcSEHPIXL8NiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LGcSEGl31ydJj8q2ApBTiR1+TGcSEHPIXL8NiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LGcSEGl31ydJj8q2ApBTiR1+TGcSEHPIXL8NiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LGcSEGl31ydJj8q2ApBTiR1+TGcSEHPIXL8NiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LGcSEG';
                    audioElement.src = soundData;
                    
                    console.log('🔊 Используем резервный системный звук');
                } catch (e2) {
                    console.log('🔊 Все звуки недоступны, но визуальный скример будет работать');
                }
            } catch (mainError) {
                console.log('🔊 Полная ошибка fallback аудио:', mainError);
            }
        }

        // 🔒 БЛОКИРОВКА ВСЕХ СПОСОБОВ ЗАКРЫТЬ РУЛЕТКУ
        let escapeBlocker = null;
        
        function blockRouletteEscape() {
            // Блокируем ESC и другие клавиши
            escapeBlocker = function(e) {
                if (rouletteProtection && currentItem === null) {
                    // Блокируем ESC, Enter, Space, и другие клавиши закрытия
                    if (e.key === 'Escape' || e.key === 'Enter' || e.key === ' ' || e.key === 'Backspace') {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('🚫 Клавиша заблокирована! Ждите результата рулетки!');
                        showBlockedMessage();
                        return false;
                    }
                }
            };
            
            // Добавляем слушатель клавиш
            document.addEventListener('keydown', escapeBlocker, true);
            document.addEventListener('keyup', escapeBlocker, true);
            
            console.log('🔒 Все способы выхода заблокированы!');
        }
        
        function unblockRouletteEscape() {
            // Убираем блокировку клавиш
            if (escapeBlocker) {
                document.removeEventListener('keydown', escapeBlocker, true);
                document.removeEventListener('keyup', escapeBlocker, true);
                escapeBlocker = null;
            }
            
            console.log('🔓 Блокировка снята, можно закрыть рулетку');
        }
        
        function showMisclickWarning() {
            // Показываем предупреждение о мисклике при выпавшем дропе
            const existingMessage = document.getElementById('misclick-warning-message');
            if (existingMessage) return; // Уже показано
            
            const message = document.createElement('div');
            message.id = 'misclick-warning-message';
            message.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(255, 152, 0, 0.95);
                color: white;
                padding: 15px 25px;
                border-radius: 12px;
                font-weight: bold;
                z-index: 10005;
                animation: warningShake 0.6s ease-in-out;
                border: 3px solid #fff;
                text-align: center;
                max-width: 90vw;
                box-shadow: 0 5px 20px rgba(0,0,0,0.4);
            `;
            
            message.innerHTML = `
                ⚠️ <strong>ВЫБЕРИТЕ ДЕЙСТВИЕ!</strong><br>
                <span style="font-size: 14px;">Используйте кнопки "Оставить" или "Продать"</span>
            `;
            
            // Добавляем анимацию тряски
            if (!document.getElementById('warning-shake-style')) {
                const style = document.createElement('style');
                style.id = 'warning-shake-style';
                style.textContent = `
                    @keyframes warningShake {
                        0%, 100% { transform: translateX(-50%) rotate(0deg); }
                        10% { transform: translateX(-50%) rotate(-2deg); }
                        20% { transform: translateX(-50%) rotate(2deg); }
                        30% { transform: translateX(-50%) rotate(-2deg); }
                        40% { transform: translateX(-50%) rotate(2deg); }
                        50% { transform: translateX(-50%) rotate(-2deg); }
                        60% { transform: translateX(-50%) rotate(2deg); }
                        70% { transform: translateX(-50%) rotate(-2deg); }
                        80% { transform: translateX(-50%) rotate(2deg); }
                        90% { transform: translateX(-50%) rotate(-2deg); }
                    }
                `;
                document.head.appendChild(style);
            }
            
            document.body.appendChild(message);
            
            // Убираем сообщение через 3 секунды
            setTimeout(() => {
                if (document.body.contains(message)) {
                    document.body.removeChild(message);
                }
            }, 3000);
        }
        
        function showBlockedMessage() {
            // Показываем короткое уведомление о блокировке
            const existingMessage = document.getElementById('roulette-blocked-message');
            if (existingMessage) return; // Уже показано
            
            const message = document.createElement('div');
            message.id = 'roulette-blocked-message';
            message.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(231, 76, 60, 0.9);
                color: white;
                padding: 10px 20px;
                border-radius: 10px;
                font-weight: bold;
                z-index: 10005;
                animation: blockPulse 0.5s ease-in-out;
                border: 2px solid #fff;
            `;
            
            message.textContent = '🔒 Рулетка заблокирована! Ждите результата!';
            
            // Добавляем анимацию пульсации
            if (!document.getElementById('block-pulse-style')) {
                const style = document.createElement('style');
                style.id = 'block-pulse-style';
                style.textContent = `
                    @keyframes blockPulse {
                        0% { transform: translateX(-50%) scale(0.8); opacity: 0; }
                        50% { transform: translateX(-50%) scale(1.1); opacity: 1; }
                        100% { transform: translateX(-50%) scale(1); opacity: 1; }
                    }
                `;
                document.head.appendChild(style);
            }
            
            document.body.appendChild(message);
            
            // Убираем сообщение через 2 секунды
            setTimeout(() => {
                if (document.body.contains(message)) {
                    document.body.removeChild(message);
                }
            }, 2000);
        }
        
        // 🏛️ ФУНКЦИИ ГОСДОЛГА
        
        function takeDebt() {
            if (hasBadCredit) {
                showDebtMessage('Плохой кредитный рейтинг! Госдолг вам недоступен!', 'error');
                return;
            }
            
            if (hasDebt) {
                showDebtMessage('У вас уже есть активный госдолг!', 'warning');
                return;
            }
            
            if (isBlocked) {
                showDebtMessage('Сначала погасите предыдущий долг!', 'error');
                return;
            }
            
            // Показываем меню выбора суммы долга
            showDebtSelectionMenu();
        }
        
        // 💰 ФУНКЦИЯ РАСЧЁТА КОЛИЧЕСТВА КЕЙСОВ ДЛЯ ДОЛГА
        function calculateCasesForDebt(amount) {
            const returnAmount = amount * 2;
            
            // Считаем что средний доход с кейса примерно 50-100 ꙮ
            // С учётом вероятности окупа 50/50 и средних цен кейсов
            
            let casesNeeded;
            if (amount <= 500) {
                casesNeeded = Math.ceil(returnAmount / 80); // ~12-13 кейсов
            } else if (amount <= 1000) {
                casesNeeded = Math.ceil(returnAmount / 85); // ~23-24 кейса
            } else if (amount <= 5000) {
                casesNeeded = Math.ceil(returnAmount / 90); // ~111 кейсов
            } else if (amount <= 10000) {
                casesNeeded = Math.ceil(returnAmount / 95); // ~210 кейсов
            } else {
                casesNeeded = Math.ceil(returnAmount / 100); // ~400 кейсов для максимума
            }
            
            // Ограничиваем максимум 30 кейсами как ты просил
            casesNeeded = Math.min(casesNeeded, 30);
            
            // Минимум 5 кейсов для любого долга
            casesNeeded = Math.max(casesNeeded, 5);
            
            return casesNeeded;
        }

        function showDebtSelectionMenu() {
            const selectionModal = document.createElement('div');
            selectionModal.id = 'debt-selection-modal';
            selectionModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background: rgba(0, 0, 0, 0.8);
                z-index: 10005;
                display: flex;
                justify-content: center;
                align-items: center;
                flex-direction: column;
                padding: 20px;
                box-sizing: border-box;
            `;
            
            // Определяем мобильную версию
            const isMobile = window.innerWidth <= 768;
            
            selectionModal.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, #2c3e50, #34495e);
                    border: 3px solid #e74c3c;
                    border-radius: ${isMobile ? '15px' : '20px'};
                    padding: ${isMobile ? '25px 20px' : '30px'};
                    text-align: center;
                    max-width: ${isMobile ? '340px' : '520px'};
                    width: ${isMobile ? '90vw' : 'auto'};
                    box-shadow: 0 10px 30px rgba(0,0,0,0.7);
                ">
                    <h2 style="color: #e74c3c; font-size: ${isMobile ? '18px' : '22px'}; margin-bottom: ${isMobile ? '15px' : '20px'};">💰 ВЫБОР СУММЫ ГОСДОЛГА 💰</h2>
                    <p style="color: #fff; font-size: ${isMobile ? '13px' : '15px'}; margin-bottom: ${isMobile ? '20px' : '25px'}; line-height: 1.4;">
                        Выберите сумму которую хотите взять в долг у СПО.<br>
                        <strong style="color: #ff6b6b;">⚠️ К возврату: сумма × 2!</strong><br>
                        <span style="color: #ffd700; font-size: ${isMobile ? '11px' : '13px'};">📊 Количество кейсов до списания рассчитывается автоматически</span>
                    </p>
                    <div style="
                        display: grid;
                        grid-template-columns: ${isMobile ? 'repeat(2, 1fr)' : 'repeat(3, 1fr)'};
                        gap: ${isMobile ? '8px' : '12px'};
                        margin-bottom: ${isMobile ? '20px' : '25px'};
                        max-width: ${isMobile ? '320px' : '500px'};
                        margin-left: auto;
                        margin-right: auto;
                    ">
                        <button class="debt-amount-btn" data-amount="500" style="
                            background: linear-gradient(145deg, #3498db, #2980b9);
                            color: white;
                            border: none;
                            padding: ${isMobile ? '8px 4px' : '10px 6px'};
                            border-radius: ${isMobile ? '8px' : '10px'};
                            font-size: ${isMobile ? '10px' : '12px'};
                            font-weight: bold;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            text-align: center;
                            line-height: 1.2;
                        ">
                            💵 500 ꙮ<br>
                            <span style="font-size: ${isMobile ? '8px' : '10px'}; opacity: 0.8;">→ 1000 ꙮ</span><br>
                            <span style="font-size: ${isMobile ? '8px' : '9px'}; color: #ffeb3b;">~13 кейсов</span>
                        </button>
                        <button class="debt-amount-btn" data-amount="1000" style="
                            background: linear-gradient(145deg, #f39c12, #d68910);
                            color: white;
                            border: none;
                            padding: ${isMobile ? '8px 4px' : '10px 6px'};
                            border-radius: ${isMobile ? '8px' : '10px'};
                            font-size: ${isMobile ? '10px' : '12px'};
                            font-weight: bold;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            text-align: center;
                            line-height: 1.2;
                        ">
                            💰 1000 ꙮ<br>
                            <span style="font-size: ${isMobile ? '8px' : '10px'}; opacity: 0.8;">→ 2000 ꙮ</span><br>
                            <span style="font-size: ${isMobile ? '8px' : '9px'}; color: #ffeb3b;">~24 кейса</span>
                        </button>
                        <button class="debt-amount-btn" data-amount="5000" style="
                            background: linear-gradient(145deg, #9b59b6, #8e44ad);
                            color: white;
                            border: none;
                            padding: ${isMobile ? '8px 4px' : '10px 6px'};
                            border-radius: ${isMobile ? '8px' : '10px'};
                            font-size: ${isMobile ? '10px' : '12px'};
                            font-weight: bold;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            text-align: center;
                            line-height: 1.2;
                        ">
                            💎 5000 ꙮ<br>
                            <span style="font-size: ${isMobile ? '8px' : '10px'}; opacity: 0.8;">→ 10000 ꙮ</span><br>
                            <span style="font-size: ${isMobile ? '8px' : '9px'}; color: #ffeb3b;">30 кейсов</span>
                        </button>
                        <button class="debt-amount-btn" data-amount="10000" style="
                            background: linear-gradient(145deg, #e74c3c, #c0392b);
                            color: white;
                            border: none;
                            padding: ${isMobile ? '8px 4px' : '10px 6px'};
                            border-radius: ${isMobile ? '8px' : '10px'};
                            font-size: ${isMobile ? '10px' : '12px'};
                            font-weight: bold;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            text-align: center;
                            line-height: 1.2;
                        ">
                            🔥 10000 ꙮ<br>
                            <span style="font-size: ${isMobile ? '8px' : '10px'}; opacity: 0.8;">→ 20000 ꙮ</span><br>
                            <span style="font-size: ${isMobile ? '8px' : '9px'}; color: #ffeb3b;">30 кейсов</span>
                        </button>
                        <button class="debt-amount-btn" data-amount="20000" style="
                            background: linear-gradient(145deg, #2c3e50, #34495e);
                            color: #ffd700;
                            border: 2px solid #ffd700;
                            padding: ${isMobile ? '8px 4px' : '10px 6px'};
                            border-radius: ${isMobile ? '8px' : '10px'};
                            font-size: ${isMobile ? '10px' : '12px'};
                            font-weight: bold;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            text-align: center;
                            line-height: 1.2;
                            ${isMobile ? 'grid-column: 1 / -1;' : 'grid-column: 2 / 4;'}
                            position: relative;
                            overflow: hidden;
                        ">
                            ⚡ 20000 ꙮ ⚡<br>
                            <span style="font-size: ${isMobile ? '8px' : '10px'}; opacity: 0.9; color: #ff6b6b;">→ 40000 ꙮ</span><br>
                            <span style="font-size: ${isMobile ? '8px' : '9px'}; color: #ffeb3b;">30 кейсов</span>
                            <div style="
                                position: absolute;
                                top: -2px;
                                right: -2px;
                                background: linear-gradient(45deg, #ff6b6b, #ffd700);
                                color: #000;
                                font-size: ${isMobile ? '7px' : '9px'};
                                font-weight: bold;
                                padding: 2px 4px;
                                border-radius: 0 8px 0 8px;
                                text-shadow: none;
                            ">МАКС</div>
                        </button>
                    </div>
                    <div id="debt-selection-info" style="
                        background: rgba(255,255,255,0.1);
                        border-radius: ${isMobile ? '8px' : '10px'};
                        padding: ${isMobile ? '12px' : '15px'};
                        margin-bottom: ${isMobile ? '15px' : '20px'};
                        display: none;
                    ">
                        <p id="debt-selection-text" style="color: #ffd700; font-size: ${isMobile ? '12px' : '14px'}; margin: 0; font-weight: bold;"></p>
                    </div>
                    <div style="
                        display: flex;
                        gap: ${isMobile ? '10px' : '15px'};
                        justify-content: center;
                        ${isMobile ? 'flex-direction: column;' : ''}
                    ">
                        <button id="confirm-debt-btn" style="
                            background: linear-gradient(145deg, #e74c3c, #c0392b);
                            color: white;
                            border: none;
                            padding: ${isMobile ? '12px 25px' : '15px 30px'};
                            border-radius: ${isMobile ? '10px' : '12px'};
                            font-size: ${isMobile ? '14px' : '16px'};
                            font-weight: bold;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            opacity: 0.5;
                            ${isMobile ? 'width: 100%;' : ''}
                        " disabled>
                            💸 Взять в долг
                        </button>
                        <button onclick="closeDebtSelectionMenu()" style="
                            background: linear-gradient(145deg, #7f8c8d, #95a5a6);
                            color: white;
                            border: none;
                            padding: ${isMobile ? '12px 25px' : '15px 30px'};
                            border-radius: ${isMobile ? '10px' : '12px'};
                            font-size: ${isMobile ? '14px' : '16px'};
                            font-weight: bold;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            ${isMobile ? 'width: 100%;' : ''}
                        " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            ❌ Отмена
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(selectionModal);
            
            // Добавляем обработчики для кнопок выбора суммы
            let selectedAmount = 0;
            const amountButtons = selectionModal.querySelectorAll('.debt-amount-btn');
            const confirmButton = selectionModal.querySelector('#confirm-debt-btn');
            const infoDiv = selectionModal.querySelector('#debt-selection-info');
            const infoText = selectionModal.querySelector('#debt-selection-text');
            
            amountButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // Убираем выделение с других кнопок
                    amountButtons.forEach(btn => {
                        btn.style.transform = 'scale(1)';
                        btn.style.boxShadow = 'none';
                        btn.style.border = 'none';
                    });
                    
                    // Выделяем текущую кнопку
                    this.style.transform = 'scale(1.05)';
                    this.style.boxShadow = '0 0 20px rgba(255, 215, 0, 0.6)';
                    this.style.border = '2px solid #ffd700';
                    
                    selectedAmount = parseInt(this.dataset.amount);
                    const returnAmount = selectedAmount * 2;
                    const casesNeeded = calculateCasesForDebt(selectedAmount);
                    
                    // Показываем информацию
                    infoDiv.style.display = 'block';
                    infoText.innerHTML = `
                        📋 Взять: <strong>${selectedAmount} ꙮ</strong><br>
                        💰 К возврату: <strong>${returnAmount} ꙮ</strong><br>
                        🎰 Количество кейсов до списания: <strong style="color: #ff6b6b;">${casesNeeded}</strong>
                    `;
                    
                    // Активируем кнопку подтверждения
                    confirmButton.disabled = false;
                    confirmButton.style.opacity = '1';
                    confirmButton.style.cursor = 'pointer';
                    
                    console.log(`💰 Выбрана сумма долга: ${selectedAmount} ꙮ (к возврату: ${returnAmount} ꙮ, кейсов: ${casesNeeded})`);
                });
                
                // Эффекты наведения
                button.addEventListener('mouseenter', function() {
                    if (parseInt(this.dataset.amount) !== selectedAmount) {
                        this.style.transform = 'scale(1.02)';
                    }
                });
                
                button.addEventListener('mouseleave', function() {
                    if (parseInt(this.dataset.amount) !== selectedAmount) {
                        this.style.transform = 'scale(1)';
                    }
                });
            });
            
            // Обработчик кнопки подтверждения
            confirmButton.addEventListener('click', function() {
                if (selectedAmount > 0) {
                    confirmDebtTaking(selectedAmount);
                    closeDebtSelectionMenu();
                }
            });
            
            console.log('💰 Показано меню выбора суммы госдолга с адаптивным количеством кейсов');
        }
        
        function closeDebtSelectionMenu() {
            const modal = document.getElementById('debt-selection-modal');
            if (modal) {
                document.body.removeChild(modal);
            }
        }
        
        function confirmDebtTaking(amount) {
            const returnAmount = amount * 2;
            const casesNeeded = calculateCasesForDebt(amount);
            
            // Выдаем госдолг
            balance += amount;
            hasDebt = true;
            debtCasesLeft = casesNeeded; // Теперь используем рассчитанное количество
            debtAmount = returnAmount; // Сохраняем сумму к возврату
            
            updateBalance();
            updateDebtStatus();
            saveGameData();
            
            // Показываем предупреждение с новой информацией
            showDebtWarning(amount, returnAmount, casesNeeded);
            
            console.log(`💰 Госдолг взят: +${amount} ꙮ, к возврату: ${returnAmount} ꙮ через ${casesNeeded} кейсов`);
        }
        
        function showDebtWarning(amount = 500, returnAmount = 1000, casesNeeded = 13) {
            const warning = document.createElement('div');
            warning.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #2c3e50, #34495e);
                border: 3px solid #e74c3c;
                border-radius: 20px;
                padding: 20px;
                z-index: 10004;
                text-align: center;
                max-width: 380px;
                width: 90vw;
                box-shadow: 0 10px 30px rgba(0,0,0,0.7);
            `;
            
            // Мобильная адаптация
            const isMobile = window.innerWidth <= 768;
            
            if (isMobile) {
                warning.innerHTML = `
                    <h2 style="color: #e74c3c; font-size: 18px; margin-bottom: 12px; line-height: 1.2;">⚠️ ГОСДОЛГ ВЫДАН ⚠️</h2>
                    <p style="color: #fff; font-size: 13px; margin-bottom: 15px; line-height: 1.3;">
                        Вы взяли госдолг у СПО.<br>
                        <strong style="color: #ff6b6b;">Вы будете ликвидированы, если не расплатитесь.</strong>
                    </p>
                    <div style="background: rgba(255,255,255,0.1); border-radius: 8px; padding: 12px; margin-bottom: 15px;">
                        <p style="color: #ffd700; font-size: 12px; margin: 0; line-height: 1.3;">
                            💰 Получено: +${amount} ꙮ<br>
                            📅 К возврату: <strong style="color: #ff6b6b;">${returnAmount} ꙮ</strong><br>
                            🎰 Через <strong style="color: #ff6b6b;">${casesNeeded}</strong> открытых кейсов
                        </p>
                    </div>
                    <div style="background: rgba(255, 107, 107, 0.2); border-radius: 6px; padding: 8px; margin-bottom: 15px; border: 1px solid rgba(255, 107, 107, 0.4);">
                        <p style="color: #ff6b6b; font-size: 11px; margin: 0; font-style: italic;">
                            ⏰ Каждый открытый кейс приближает списание!<br>
                            💡 Совет: продавайте дропы для погашения долга
                        </p>
                    </div>
                    <button onclick="this.parentElement.remove()" style="
                        background: #e74c3c; color: white; border: none; padding: 10px 20px;
                        border-radius: 8px; font-size: 14px; font-weight: bold; cursor: pointer;
                        width: 100%; max-width: 250px;
                    ">😰 Понятно</button>
                `;
            } else {
                warning.innerHTML = `
                    <h2 style="color: #e74c3c; font-size: 24px; margin-bottom: 15px;">⚠️ ГОСДОЛГ ВЫДАН ⚠️</h2>
                    <p style="color: #fff; font-size: 16px; margin-bottom: 20px; line-height: 1.4;">
                        Вы взяли госдолг у СПО.<br>
                        <strong style="color: #ff6b6b;">Вы будете ликвидированы, если не расплатитесь.</strong>
                    </p>
                    <div style="background: rgba(255,255,255,0.1); border-radius: 10px; padding: 15px; margin-bottom: 15px;">
                        <p style="color: #ffd700; font-size: 14px; margin: 0; line-height: 1.4;">
                            💰 Получено: +${amount} ꙮ<br>
                            📅 К возврату: <strong style="color: #ff6b6b;">${returnAmount} ꙮ</strong><br>
                            🎰 Через <strong style="color: #ff6b6b;">${casesNeeded}</strong> открытых кейсов
                        </p>
                    </div>
                    <div style="background: rgba(255, 107, 107, 0.2); border-radius: 8px; padding: 12px; margin-bottom: 20px; border: 1px solid rgba(255, 107, 107, 0.4);">
                        <p style="color: #ff6b6b; font-size: 13px; margin: 0; font-style: italic; line-height: 1.3;">
                            ⏰ Каждый открытый кейс приближает автоматическое списание!<br>
                            💡 Совет: продавайте дропы для накопления средств на погашение долга
                        </p>
                    </div>
                    <button onclick="this.parentElement.remove()" style="
                        background: #e74c3c; color: white; border: none; padding: 12px 25px;
                        border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer;
                    ">😰 Понятно</button>
                `;
            }
            
            document.body.appendChild(warning);
            
            // Автоматически убираем через 12 секунд (больше времени для чтения)
            setTimeout(() => {
                if (document.body.contains(warning)) {
                    document.body.removeChild(warning);
                }
            }, 12000);
        }
        
        function updateDebtStatus() {
            const debtButton = document.getElementById('debtButton');
            const debtStatus = document.getElementById('debtStatus');
            
            if (hasBadCredit) {
                debtButton.style.display = 'none';
                debtStatus.style.display = 'block';
                debtStatus.innerHTML = `🚫 ПЛОХОЙ РЕЙТИНГ`;
                debtStatus.style.color = '#e74c3c';
            } else if (hasDebt && debtCasesLeft > 0) {
                debtButton.style.display = 'none';
                debtStatus.style.display = 'block';
                // Показываем информацию о долге и автоматическом списании
                const neededAmount = debtAmount - balance;
                const casesText = debtCasesLeft === 1 ? 'кейс' : debtCasesLeft < 5 ? 'кейса' : 'кейсов';
                if (neededAmount <= 0) {
                    debtStatus.innerHTML = `💰 Долг ${debtAmount} ꙮ будет списан сейчас!`;
                    debtStatus.style.color = '#27ae60'; // Зелёным если хватает денег
                } else {
                    debtStatus.innerHTML = `⚠️ Долг: нужно ещё ${neededAmount} ꙮ (или ${debtCasesLeft} ${casesText})`;
                    debtStatus.style.color = debtCasesLeft <= 3 ? '#ff3333' : '#ff6b6b'; // Красным если мало кейсов осталось
                }
            } else if (isBlocked) {
                debtButton.style.display = 'none';
                debtStatus.style.display = 'block';
                debtStatus.innerHTML = `🚨 ЗАБЛОКИРОВАНО`;
                debtStatus.style.color = '#e74c3c';
            } else {
                debtButton.style.display = 'block';
                debtStatus.style.display = 'none';
            }
        }
        
        function checkDebtOnCaseOpen() {
            if (!hasDebt || debtCasesLeft <= 0) return;
            
            debtCasesLeft--;
            console.log(`📉 Кейс открыт, осталось ${debtCasesLeft} до принудительного списания`);
            
            if (debtCasesLeft <= 0) {
                // Принудительное списание - даже если денег нет!
                processForceDebtPayment();
            }
            
            updateDebtStatus();
            saveGameData();
        }
        
        function processForceDebtPayment() {
            if (balance >= debtAmount) {
                // Достаточно денег - списываем (но этого не должно происходить, так как автоматическое списание уже сработало бы)
                balance -= debtAmount;
                hasDebt = false;
                debtCasesLeft = 0;
                
                updateBalance();
                updateDebtStatus();
                saveGameData();
                
                showDebtMessage(`✅ Госдолг принудительно погашен! Списано ${debtAmount} ꙮ`, 'success');
                console.log('✅ Госдолг принудительно погашен (резервный механизм)');
            } else {
                // Денег нет - блокируем И портим кредитный рейтинг!
                isBlocked = true;
                hasDebt = false;
                debtCasesLeft = 0;
                hasBadCredit = true; // 📉 ПОРТИМ КРЕДИТНЫЙ РЕЙТИНГ НАВСЕГДА!
                
                updateDebtStatus();
                showBlockBanner();
                saveGameData();
                
                console.log('🚫 Принудительное списание: долг не погашен - пользователь заблокирован! Кредитный рейтинг испорчен!');
            }
        }
        
        function showBlockBanner() {
            const blockBanner = document.getElementById('blockBanner');
            const blockMessage = document.getElementById('blockMessage');
            const repentButton = document.getElementById('repentButton');
            
            blockMessage.textContent = 'Долг не возвращён. За вами выехала пчелиция!';
            
            // Показываем кнопку покаяния если есть что забрать
            if (balance > 0 || inventory.length > 0) { // Любой инвентарь или баланс
                repentButton.style.display = 'inline-block';
                console.log('🙏 Показываем кнопку покаяния - есть что забрать');
            } else {
                repentButton.style.display = 'none';
                console.log('💡 Нечего забирать - только покаяние недоступно');
            }
            
            blockBanner.style.display = 'block';
            
            // Скрываем кейсы
            document.querySelector('.cases-section').style.opacity = '0.3';
            document.querySelector('.cases-section').style.pointerEvents = 'none';
        }
        
        function hideBlockBanner() {
            const blockBanner = document.getElementById('blockBanner');
            blockBanner.style.display = 'none';
            
            // Показываем кейсы
            document.querySelector('.cases-section').style.opacity = '1';
            document.querySelector('.cases-section').style.pointerEvents = 'auto';
        }
        
        function repent() {
            // Запускаем интерактивное покаяние с счётчиком кликов
            startRepentanceClicking();
        }
        
        function startRepentanceClicking() {
            let clickCount = 0;
            let maxClicks = 500; // Теперь переменная, может быть уменьшена
            let spoServiceUsed = false; // Флаг использования службы СПО
            
            // Сохраняем старые значения для показа потерь
            const oldBalance = balance;
            const oldInventoryCount = inventory.length;
            
            // Создаём интерфейс покаяния с счётчиком
            const repentanceInterface = document.createElement('div');
            repentanceInterface.id = 'repentance-clicking';
            repentanceInterface.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background: rgba(0, 0, 0, 0.3);
                backdrop-filter: blur(3px);
                z-index: 10005;
                display: flex;
                justify-content: center;
                align-items: center;
                flex-direction: column;
            `;
            
            // Определяем мобильную версию
            const isMobile = window.innerWidth <= 768;
            
            const modalContent = `
                <div style="
                    background: linear-gradient(135deg, #27ae60, #229954);
                    border: 3px solid #fff;
                    border-radius: ${isMobile ? '15px' : '20px'};
                    padding: ${isMobile ? '25px 20px' : '40px'};
                    text-align: center;
                    max-width: ${isMobile ? '320px' : '500px'};
                    width: ${isMobile ? '90vw' : 'auto'};
                    box-shadow: 0 10px 30px rgba(0,0,0,0.7);
                    animation: repentGlow 2s ease-in-out infinite;
                ">
                    <h2 style="color: #fff; font-size: ${isMobile ? '20px' : '28px'}; margin-bottom: ${isMobile ? '15px' : '20px'};">🙏 ПОКАЯНИЕ 🙏</h2>
                    <p id="repent-description" style="color: #fff; font-size: ${isMobile ? '14px' : '18px'}; margin-bottom: ${isMobile ? '20px' : '30px'}; line-height: 1.4;">
                        Для прощения кликайте по кнопке<br>
                        <span id="clicks-required">500</span> раз со искренним раскаянием
                    </p>
                    <div style="
                        background: rgba(255,255,255,0.2);
                        border-radius: ${isMobile ? '10px' : '15px'};
                        padding: ${isMobile ? '15px' : '20px'};
                        margin-bottom: ${isMobile ? '20px' : '30px'};
                    ">
                        <div id="repent-counter" style="
                            color: #fff;
                            font-size: ${isMobile ? '24px' : '32px'};
                            font-weight: bold;
                            margin-bottom: 10px;
                        ">0 / 500</div>
                        <div style="
                            background: rgba(255,255,255,0.2);
                            height: ${isMobile ? '8px' : '10px'};
                            border-radius: ${isMobile ? '4px' : '5px'};
                            overflow: hidden;
                        ">
                            <div id="repent-progress" style="
                                background: #fff;
                                height: 100%;
                                width: 0%;
                                transition: width 0.1s ease;
                                border-radius: ${isMobile ? '4px' : '5px'};
                            "></div>
                        </div>
                    </div>
                    <div style="
                        display: flex;
                        flex-direction: ${isMobile ? 'column' : 'row'};
                        gap: ${isMobile ? '10px' : '15px'};
                        align-items: center;
                        justify-content: center;
                        margin-bottom: ${isMobile ? '15px' : '20px'};
                    ">
                        <button id="repent-click-btn" style="
                            background: #fff;
                            color: #27ae60;
                            border: none;
                            padding: ${isMobile ? '15px 30px' : '20px 40px'};
                            border-radius: ${isMobile ? '12px' : '15px'};
                            font-size: ${isMobile ? '16px' : '20px'};
                            font-weight: bold;
                            cursor: pointer;
                            transition: all 0.1s ease;
                            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                            ${isMobile ? 'width: 100%; max-width: 250px;' : ''}
                        " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            🙏 КАЯТЬСЯ
                        </button>
                        <button id="spo-service-btn" style="
                            background: linear-gradient(135deg, #e74c3c, #c0392b);
                            color: #fff;
                            border: none;
                            padding: ${isMobile ? '12px 20px' : '15px 25px'};
                            border-radius: ${isMobile ? '10px' : '12px'};
                            font-size: ${isMobile ? '13px' : '16px'};
                            font-weight: bold;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            box-shadow: 0 3px 10px rgba(0,0,0,0.3);
                            ${isMobile ? 'width: 100%; max-width: 250px;' : ''}
                        " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            🏛️ СЛУЖУ СПО!
                        </button>
                    </div>
                </div>
                <div id="click-feedback-container" style="
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    pointer-events: none;
                    z-index: 1;
                "></div>
            `;
            
            repentanceInterface.innerHTML = modalContent;
            document.body.appendChild(repentanceInterface);
            
            const counterEl = document.getElementById('repent-counter');
            const progressEl = document.getElementById('repent-progress');
            const buttonEl = document.getElementById('repent-click-btn');
            const spoButtonEl = document.getElementById('spo-service-btn');
            const feedbackContainer = document.getElementById('click-feedback-container');
            const clicksRequiredEl = document.getElementById('clicks-required');
            const repentDescriptionEl = document.getElementById('repent-description');
            
            // Обработчик кнопки "СЛУЖУ СПО!"
            spoButtonEl.onclick = function() {
                if (spoServiceUsed) return; // Можно использовать только раз
                
                spoServiceUsed = true;
                maxClicks = 100; // Снижаем до 100 кликов
                
                // Обновляем интерфейс
                clicksRequiredEl.textContent = '100';
                counterEl.textContent = `${clickCount} / 100`;
                repentDescriptionEl.innerHTML = `
                    Благодарим за службу СПО!<br>
                    Квота снижена до <span style="color: #ffeb3b; font-weight: bold;">100 кликов</span>
                `;
                
                // Убираем кнопку СПО и показываем сообщение
                spoButtonEl.style.display = 'none';
                
                // Показываем уведомление
                showServiceMessage();
                
                // Обновляем прогресс
                const progress = (clickCount / maxClicks) * 100;
                progressEl.style.width = `${progress}%`;
                
                // Проверяем, достаточно ли уже кликов
                if (clickCount >= maxClicks) {
                    setTimeout(() => {
                        finishRepentance(repentanceInterface, oldBalance, oldInventoryCount);
                    }, 1000);
                }
                
                console.log('🏛️ Служба СПО активирована! Квота снижена с 500 до 100 кликов');
            };
            
            // Обработчик клика по кнопке покаяния
            buttonEl.onclick = function(e) {
                if (clickCount >= maxClicks) return;
                
                clickCount++;
                const progress = (clickCount / maxClicks) * 100;
                
                // Обновляем счётчик и прогресс
                counterEl.textContent = `${clickCount} / ${maxClicks}`;
                progressEl.style.width = `${progress}%`;
                
                // Показываем +1 эффект
                showClickFeedback(e.clientX, e.clientY, feedbackContainer);
                
                // Эффект нажатия кнопки
                buttonEl.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    buttonEl.style.transform = 'scale(1)';
                }, 100);
                
                // Проверяем завершение
                if (clickCount >= maxClicks) {
                    setTimeout(() => {
                        finishRepentance(repentanceInterface, oldBalance, oldInventoryCount);
                    }, 500);
                }
            };
        }
        
        function showServiceMessage() {
            const message = document.createElement('div');
            message.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: linear-gradient(135deg, #e74c3c, #c0392b);
                color: #fff;
                padding: 15px 25px;
                border-radius: 12px;
                font-weight: bold;
                z-index: 10006;
                animation: serviceSlideIn 0.5s ease-out;
                border: 2px solid #fff;
                box-shadow: 0 5px 20px rgba(0,0,0,0.3);
                text-align: center;
                max-width: 90vw;
            `;
            
            message.innerHTML = `
                🏛️ <strong>СЛУЖБА СПО ЗАСЧИТАНА!</strong><br>
                <span style="font-size: 14px; color: #ffeb3b;">Квота покаяния снижена до 100 кликов!</span>
            `;
            
            // Добавляем анимацию появления
            if (!document.getElementById('service-slide-in-style')) {
                const style = document.createElement('style');
                style.id = 'service-slide-in-style';
                style.textContent = `
                    @keyframes serviceSlideIn {
                        0% { transform: translateX(-50%) translateY(-100%); opacity: 0; }
                        100% { transform: translateX(-50%) translateY(0); opacity: 1; }
                    }
                `;
                document.head.appendChild(style);
            }
            
            document.body.appendChild(message);
            
            // Убираем сообщение через 4 секунды
            setTimeout(() => {
                if (document.body.contains(message)) {
                    message.style.animation = 'serviceSlideIn 0.3s ease-out reverse';
                    setTimeout(() => {
                        if (document.body.contains(message)) {
                            document.body.removeChild(message);
                        }
                    }, 300);
                }
            }, 4000);
        }
        
        function showClickFeedback(x, y, container) {
            const feedback = document.createElement('div');
            feedback.style.cssText = `
                position: absolute;
                left: ${x}px;
                top: ${y}px;
                color: #fff;
                font-size: 24px;
                font-weight: bold;
                pointer-events: none;
                animation: clickFadeUp 1s ease-out forwards;
                z-index: 10;
                text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            `;
            feedback.textContent = '+1';
            
            // Добавляем анимацию если её ещё нет
            if (!document.getElementById('click-fade-up-style')) {
                const style = document.createElement('style');
                style.id = 'click-fade-up-style';
                style.textContent = `
                    @keyframes clickFadeUp {
                        0% {
                            opacity: 1;
                            transform: translate(-50%, -50%) scale(1);
                        }
                        100% {
                            opacity: 0;
                            transform: translate(-50%, -150px) scale(1.5);
                        }
                    }
                `;
                document.head.appendChild(style);
            }
            
            container.appendChild(feedback);
            
            // Удаляем элемент после анимации
            setTimeout(() => {
                if (container.contains(feedback)) {
                    container.removeChild(feedback);
                }
            }, 1000);
        }
        
        function finishRepentance(interfaceEl, oldBalance, oldInventoryCount) {
            // Полное покаяние - обнуляем всё!
            balance = 0;
            inventory = []; // Полностью очищаем инвентарь (даже стартовый предмет)
            isBlocked = false;
            hasDebt = false;
            debtCasesLeft = 0;
            // hasBadCredit НЕ сбрасываем - плохой рейтинг остается навсегда!
            
            updateBalance();
            updateInventory();
            updateDebtStatus();
            hideBlockBanner();
            saveGameData();
            
            // 💡 Принудительно проверяем подсказку после покаяния (баланс = 0)
            checkZeroBalance();
            
            // 💡 Также проверяем отложенную подсказку
            checkPendingBonusHint();
            
            // Убираем интерфейс кликов
            document.body.removeChild(interfaceEl);
            
            // Показываем сообщение о покаянии
            showRepentanceMessage(oldBalance, oldInventoryCount);
            
            console.log('🙏 Покаяние совершено - всё обнулено, блокировка снята, но плохой рейтинг остался!');
        }
        
        function showRepentanceMessage(lostBalance, lostItems) {
            const repentance = document.createElement('div');
            repentance.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #27ae60, #229954);
                border: 3px solid #fff;
                border-radius: 20px;
                padding: 30px;
                z-index: 10004;
                text-align: center;
                max-width: 500px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.7);
                animation: repentGlow 2s ease-in-out infinite;
            `;
            
            repentance.innerHTML = `
                <h2 style="color: #fff; font-size: 24px; margin-bottom: 15px;">🙏 ПОКАЯНИЕ ПРИНЯТО 🙏</h2>
                <p style="color: #fff; font-size: 16px; margin-bottom: 20px; line-height: 1.4;">
                    Прощение получено. Баланс обнулён.<br>
                    Инвентарь утилизирован. СПО довольно!<br>
                    <strong style="color: #ffeb3b;">Ваш рейтинг ноль.</strong>
                </p>
                <div style="background: rgba(255,255,255,0.2); border-radius: 10px; padding: 15px; margin-bottom: 20px;">
                    <p style="color: #fff; font-size: 14px; margin: 0;">
                        💸 Потеряно: ${lostBalance} ꙮ<br>
                        📦 Утилизировано: ${lostItems} предметов
                    </p>
                </div>
                <button onclick="this.parentElement.remove()" style="
                    background: #fff; color: #27ae60; border: none; padding: 12px 25px;
                    border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer;
                ">👍 Хорошо</button>
            `;
            
            // Добавляем анимацию свечения
            if (!document.getElementById('repent-glow-style')) {
                const style = document.createElement('style');
                style.id = 'repent-glow-style';
                style.textContent = `
                    @keyframes repentGlow {
                        0%, 100% { 
                            box-shadow: 0 10px 30px rgba(39, 174, 96, 0.7);
                        }
                        50% { 
                            box-shadow: 0 15px 40px rgba(39, 174, 96, 1), 0 0 50px rgba(39, 174, 96, 0.5);
                        }
                    }
                `;
                document.head.appendChild(style);
            }
            
            document.body.appendChild(repentance);
            
            // НЕ убираем автоматически - только по клику на кнопку!
        }
        
        function showDebtPaymentMessage(paidAmount, originalDebt) {
            const paymentModal = document.createElement('div');
            paymentModal.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #27ae60, #229954);
                border: 3px solid #fff;
                border-radius: 20px;
                padding: 30px;
                z-index: 10006;
                text-align: center;
                max-width: 450px;
                width: 90vw;
                box-shadow: 0 10px 30px rgba(0,0,0,0.7);
                animation: successPulse 2s ease-in-out infinite;
            `;
            
            paymentModal.innerHTML = `
                <h2 style="color: #fff; font-size: 24px; margin-bottom: 15px;">✅ ДОЛГ ПОГАШЕН! ✅</h2>
                <p style="color: #fff; font-size: 16px; margin-bottom: 20px; line-height: 1.4;">
                    Госдолг автоматически списан!<br>
                    СПО благодарит за сотрудничество!
                </p>
                <div style="background: rgba(255,255,255,0.2); border-radius: 10px; padding: 15px; margin-bottom: 20px;">
                    <p style="color: #fff; font-size: 14px; margin: 0; line-height: 1.4;">
                        💰 Было: <strong>${originalDebt} ꙮ</strong> долга<br>
                        ✅ Списано: <strong>${paidAmount} ꙮ</strong><br>
                        🎉 Ваш кредитный рейтинг восстановлен!<br>
                        💎 Можете снова брать госдолг при необходимости
                    </p>
                </div>
                <button onclick="this.parentElement.remove()" style="
                    background: #fff; 
                    color: #27ae60; 
                    border: none; 
                    padding: 12px 25px;
                    border-radius: 10px; 
                    font-size: 16px; 
                    font-weight: bold; 
                    cursor: pointer;
                    transition: all 0.3s ease;
                " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                    🎊 ОТЛИЧНО!
                </button>
            `;
            
            // Добавляем анимацию успеха
            if (!document.getElementById('success-pulse-style')) {
                const style = document.createElement('style');
                style.id = 'success-pulse-style';
                style.textContent = `
                    @keyframes successPulse {
                        0%, 100% { 
                            transform: translate(-50%, -50%) scale(1);
                            box-shadow: 0 10px 30px rgba(39, 174, 96, 0.7);
                        }
                        50% { 
                            transform: translate(-50%, -50%) scale(1.02);
                            box-shadow: 0 15px 40px rgba(39, 174, 96, 1), 0 0 50px rgba(39, 174, 96, 0.5);
                        }
                    }
                `;
                document.head.appendChild(style);
            }
            
            document.body.appendChild(paymentModal);
            
            // НЕ убираем автоматически - только по кнопке!
        }
        
        function showDebtMessage(message, type) {
            const msgEl = document.createElement('div');
            msgEl.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 10px;
                color: white;
                font-weight: bold;
                z-index: 10003;
                animation: slideIn 0.3s ease-out;
            `;
            
            if (type === 'success') {
                msgEl.style.background = 'linear-gradient(135deg, #27ae60, #229954)';
            } else if (type === 'error') {
                msgEl.style.background = 'linear-gradient(135deg, #e74c3c, #c0392b)';
            } else {
                msgEl.style.background = 'linear-gradient(135deg, #f39c12, #d68910)';
            }
            
            msgEl.textContent = message;
            
            // Добавляем анимацию появления
            if (!document.getElementById('slideIn-style')) {
                const style = document.createElement('style');
                style.id = 'slideIn-style';
                style.textContent = `
                    @keyframes slideIn {
                        0% { transform: translateX(100%); opacity: 0; }
                        100% { transform: translateX(0); opacity: 1; }
                    }
                `;
                document.head.appendChild(style);
            }
            
            document.body.appendChild(msgEl);
            
            // Убираем сообщение через 4 секунды
            setTimeout(() => {
                if (document.body.contains(msgEl)) {
                    document.body.removeChild(msgEl);
                }
            }, 4000);
        }
        
        // 💡 ФУНКЦИЯ ПРОВЕРКИ НУЛЕВОГО БАЛАНСА
        function checkZeroBalance() {
            console.log(`💡 Проверка баланса: ${balance} ꙮ`);
            
            // Проверяем: баланс = 0 И подсказка ещё не была показана И рулетка НЕ активна
            if (balance === 0 && !bonusHintShown && !isRouletteActive()) {
                console.log('💡 Баланс = 0 и рулетка не активна, показываем менюшку BONUS (первый раз)');
                showBonusModal();
            } else if (balance === 0 && !bonusHintShown && isRouletteActive()) {
                console.log('💡 Баланс = 0, но рулетка активна - ждём её завершения');
                // Устанавливаем флаг для показа после рулетки
                pendingBonusHint = true;
            }
        }
        
        // 💡 ПРОВЕРЯЕМ АКТИВНА ЛИ РУЛЕТКА
        function isRouletteActive() {
            const rouletteSection = document.getElementById('rouletteSection');
            return rouletteSection && rouletteSection.classList.contains('active');
        }
        
        // 💡 ПРОВЕРЯЕМ ОТЛОЖЕННУЮ ПОДСКАЗКУ ПОСЛЕ РУЛЕТКИ
        function checkPendingBonusHint() {
            if (pendingBonusHint && balance === 0 && !bonusHintShown) {
                console.log('💡 Рулетка завершена, показываем отложенную подсказку BONUS');
                pendingBonusHint = false;
                
                // Небольшая задержка для плавности UX
                setTimeout(() => {
                    showBonusModal();
                }, 1000);
            }
        }
        
        function showBonusModal() {
            // Проверяем, нет ли уже модалки
            if (document.getElementById('bonus-modal')) return;
            
            const modal = document.createElement('div');
            modal.id = 'bonus-modal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background: rgba(0, 0, 0, 0.8);
                z-index: 10007;
                display: flex;
                justify-content: center;
                align-items: center;
                flex-direction: column;
                padding: 20px;
                box-sizing: border-box;
            `;
            
            // Определяем мобильную версию
            const isMobile = window.innerWidth <= 768;
            
            modal.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, #f39c12, #e67e22);
                    border: 3px solid #fff;
                    border-radius: ${isMobile ? '15px' : '20px'};
                    padding: ${isMobile ? '25px 20px' : '30px'};
                    text-align: center;
                    max-width: ${isMobile ? '320px' : '450px'};
                    width: ${isMobile ? '90vw' : 'auto'};
                    box-shadow: 0 10px 30px rgba(0,0,0,0.7);
                    animation: bonusModalPulse 2s ease-in-out infinite;
                ">
                    <h2 style="color: #fff; font-size: ${isMobile ? '20px' : '24px'}; margin-bottom: ${isMobile ? '15px' : '20px'}; text-shadow: 2px 2px 4px rgba(0,0,0,0.7);">
                        💡 НЕТ ДЕНЕГ? 💡
                    </h2>
                    <p style="color: #fff; font-size: ${isMobile ? '16px' : '18px'}; margin-bottom: ${isMobile ? '20px' : '25px'}; line-height: 1.4; text-shadow: 1px 1px 2px rgba(0,0,0,0.5);">
                        Не расстраивайся!<br>
                        У нас есть <strong style="color: #ffeb3b;">бесплатный промокод</strong> для тебя!
                    </p>
                    <div style="
                        background: rgba(255,255,255,0.2);
                        border-radius: ${isMobile ? '10px' : '12px'};
                        padding: ${isMobile ? '15px' : '20px'};
                        margin-bottom: ${isMobile ? '20px' : '25px'};
                        border: 1px solid rgba(255,255,255,0.3);
                    ">
                        <p style="color: #fff; font-size: ${isMobile ? '14px' : '16px'}; margin-bottom: 10px;">
                            Введи промокод в настройках профиля:
                        </p>
                        <div style="
                            background: rgba(0,0,0,0.3);
                            border-radius: 8px;
                            padding: 10px;
                            border: 1px solid rgba(255,255,255,0.2);
                        ">
                            <div style="color: #ffeb3b; font-size: ${isMobile ? '18px' : '22px'}; font-weight: bold; text-shadow: 0 0 10px #ffeb3b;">
                                BONUS
                            </div>
                            <div style="color: #fff; font-size: ${isMobile ? '12px' : '14px'}; margin-top: 5px;">
                                +200 ꙮ на баланс!
                            </div>
                        </div>
                    </div>
                    <button onclick="closeBonusModal()" style="
                        background: #fff;
                        color: #f39c12;
                        border: none;
                        padding: ${isMobile ? '12px 25px' : '15px 30px'};
                        border-radius: ${isMobile ? '10px' : '12px'};
                        font-size: ${isMobile ? '16px' : '18px'};
                        font-weight: bold;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        box-shadow: 0 3px 10px rgba(0,0,0,0.3);
                        ${isMobile ? 'width: 100%; max-width: 200px;' : ''}
                    " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                        👍 ПОНЯЛ!
                    </button>
                </div>
            `;
            
            // Добавляем анимацию пульсации
            if (!document.getElementById('bonus-modal-pulse-style')) {
                const style = document.createElement('style');
                style.id = 'bonus-modal-pulse-style';
                style.textContent = `
                    @keyframes bonusModalPulse {
                        0%, 100% { 
                            transform: scale(1);
                            box-shadow: 0 10px 30px rgba(243, 156, 18, 0.7);
                        }
                        50% { 
                            transform: scale(1.02);
                            box-shadow: 0 15px 40px rgba(243, 156, 18, 1), 0 0 50px rgba(243, 156, 18, 0.5);
                        }
                    }
                `;
                document.head.appendChild(style);
            }
            
            document.body.appendChild(modal);
            
            console.log('💡 Показана менюшка с промокодом BONUS');
        }
        
        function closeBonusModal() {
            const modal = document.getElementById('bonus-modal');
            if (modal) {
                document.body.removeChild(modal);
                bonusHintShown = true; // Помечаем что показали
                saveGameData(); // Сохраняем флаг
                console.log('💡 Менюшка BONUS закрыта, больше не показываем');
            }
        }
        
        // Эта функция больше не нужна, но оставляем для совместимости
        function showMisclickPenalty() {
            console.log('🚫 Функция штрафа отключена - рулетка теперь полностью заблокирована');
        }

        // Fallback generated scream sound
        function playGeneratedScream() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // Create multiple oscillators for a scary sound
                const oscillators = [];
                const gainNode = audioContext.createGain();
                gainNode.connect(audioContext.destination);
                
                // Create chaotic frequency sweep
                for (let i = 0; i < 3; i++) {
                    const osc = audioContext.createOscillator();
                    const oscGain = audioContext.createGain();
                    
                    osc.connect(oscGain);
                    oscGain.connect(gainNode);
                    
                    // Scary frequency ranges
                    const startFreq = 100 + (i * 200);
                    const endFreq = 800 + (i * 300);
                    
                    osc.frequency.setValueAtTime(startFreq, audioContext.currentTime);
                    osc.frequency.exponentialRampToValueAtTime(endFreq, audioContext.currentTime + 0.5);
                    osc.frequency.exponentialRampToValueAtTime(startFreq * 0.5, audioContext.currentTime + 1);
                    
                    oscGain.gain.setValueAtTime(0.2, audioContext.currentTime);
                    oscGain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
                    
                    osc.type = i % 2 === 0 ? 'sawtooth' : 'square'; // Harsh waveforms
                    osc.start();
                    osc.stop(audioContext.currentTime + 1);
                    
                    oscillators.push(osc);
                }
                
                // Main volume envelope
                gainNode.gain.setValueAtTime(0.6, audioContext.currentTime); // Loud start
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
                
            } catch (e) {
                console.log('Не удалось воспроизвести звук скримера:', e);
            }
        }

        // 💡 ФЛАГИ ПОКАЗА ПОДСКАЗКИ BONUS
        let bonusHintShown = false; // Показывалась ли уже подсказка BONUS
        let pendingBonusHint = false; // Ожидает ли подсказка завершения рулетки
        
        // LocalStorage functions
        function saveGameData() {
            const gameData = {
                balance: balance,
                inventory: inventory,
                nickname: userNickname,
                avatar: userAvatar,
                winglistItems: winglistItems,
                usedPromocodes: usedPromocodes,
                hasDebt: hasDebt,
                debtCasesLeft: debtCasesLeft,
                debtAmount: debtAmount,
                isBlocked: isBlocked,
                hasBadCredit: hasBadCredit,
                bonusHintShown: bonusHintShown, // Сохраняем флаг показа подсказки
                pendingBonusHint: pendingBonusHint // Сохраняем флаг отложенной подсказки
            };
            localStorage.setItem('caseOpenerGameData', JSON.stringify(gameData));
        }

        function loadGameData() {
            const savedData = localStorage.getItem('caseOpenerGameData');
            if (savedData) {
                try {
                    const gameData = JSON.parse(savedData);
                    balance = gameData.balance || 1000;
                    inventory = gameData.inventory || [
                        { name: 'Стартовый инструмент', image: 'dropcase1_1', rarity: 'common', value: 10 }
                    ];
                    userNickname = gameData.nickname || 'Игрок';
                    userAvatar = gameData.avatar || null;
                    winglistItems = gameData.winglistItems || [];
                    usedPromocodes = gameData.usedPromocodes || [];
                    hasDebt = gameData.hasDebt || false;
                    debtCasesLeft = gameData.debtCasesLeft || 0;
                    debtAmount = gameData.debtAmount || 500;
                    isBlocked = gameData.isBlocked || false;
                    hasBadCredit = gameData.hasBadCredit || false;
                    bonusHintShown = gameData.bonusHintShown || false; // Загружаем флаг показа подсказки
                    pendingBonusHint = gameData.pendingBonusHint || false; // Загружаем флаг отложенной подсказки
                } catch (e) {
                    console.log('Ошибка загрузки данных, используем значения по умолчанию');
                }
            }
        }

        // Winglist functionality
        let winglistItems = [];
        let winglistExpanded = false;

        function addToWinglist(item) {
            winglistItems.unshift({
                user: userNickname,
                item: item,
                timestamp: new Date()
            });
            
            // Keep only last 10 items instead of 5
            if (winglistItems.length > 10) {
                winglistItems = winglistItems.slice(0, 10);
            }
            
            updateWinglist();
        }

        function updateWinglist() {
            const winglistContainer = document.getElementById('winglist-items');
            const winglistToggle = document.getElementById('winglist-toggle');
            winglistContainer.innerHTML = '';
            
            winglistItems.forEach((entry, index) => {
                const itemEl = document.createElement('div');
                itemEl.className = 'winglist-item';
                
                // Hide items after 2nd if not expanded
                if (!winglistExpanded && index >= 2) {
                    itemEl.classList.add('hidden');
                }
                
                itemEl.innerHTML = `
                    <div style="font-weight: bold; color: #fff;">${entry.user}</div>
                    <div style="color: #ffd700;">${entry.item.name}</div>
                    <div style="color: #ccc;">${entry.item.value} ꙮ</div>
                `;
                winglistContainer.appendChild(itemEl);
            });
            
            // Show toggle button only if more than 2 items
            if (winglistItems.length > 2) {
                winglistToggle.style.display = 'block';
                winglistToggle.innerHTML = winglistExpanded ? 
                    'Свернуть ▲' : 
                    `Показать все (${winglistItems.length}) ▼`;
            } else {
                winglistToggle.style.display = 'none';
            }
        }

        function toggleWinglist() {
            winglistExpanded = !winglistExpanded;
            
            const hiddenItems = document.querySelectorAll('.winglist-item.hidden');
            const winglistContainer = document.getElementById('winglist-items');
            
            if (winglistExpanded) {
                // Show all items
                hiddenItems.forEach(item => {
                    item.classList.remove('hidden');
                });
                winglistContainer.classList.add('expanded');
            } else {
                // Hide items after 2nd
                const allItems = document.querySelectorAll('.winglist-item');
                allItems.forEach((item, index) => {
                    if (index >= 2) {
                        item.classList.add('hidden');
                    }
                });
                winglistContainer.classList.remove('expanded');
            }
            
            updateWinglist();
        }

        // Countdown timer
        let countdownTime = 3 * 60 * 60 + 25 * 60; // 3 hours 25 minutes in seconds

        function updateCountdown() {
            const hours = Math.floor(countdownTime / 3600);
            const minutes = Math.floor((countdownTime % 3600) / 60);
            const seconds = countdownTime % 60;
            
            const timerDisplay = document.getElementById('countdownTimer');
            timerDisplay.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            if (countdownTime > 0) {
                countdownTime--;
            } else {
                // Reset timer when it reaches 0
                countdownTime = 3 * 60 * 60 + 25 * 60;
            }
        }

        // Start countdown timer
        setInterval(updateCountdown, 1000);

        // Initialize case images
        function initializeCaseImages() {
            document.querySelectorAll('.case-image').forEach(caseImageEl => {
                const caseNum = caseImageEl.dataset.caseNum;
                const closedImg = new Image();
                const openImg = new Image();
                
                closedImg.onload = () => {
                    caseImageEl.style.backgroundImage = `url('case${caseNum}_closed.png')`;
                };
                closedImg.onerror = () => {
                    // Generate fallback image
                    caseImageEl.style.backgroundImage = `url('keys/case${caseNum}_closed?prompt=treasure%20chest%20case%20box%20closed%20game%20item')`;
                };
                closedImg.src = `case${caseNum}_closed.png`;
                
                // Preload open image
                openImg.src = `case${caseNum}_open.png`;
            });
        }

        // Улучшенная система звуков
        let rollSound = null;
        let dropSound = null;
        let rareDropSound = null;
        let epicDropSound = null;
        let legendaryDropSound = null;
        let expensiveDropSound = null;

        // Sound effect for roulette
        function playRouletteSound() {
            // Создаем новый аудио объект если нужно
            if (!rollSound) {
                rollSound = new Audio();
                rollSound.volume = 0.4;
                rollSound.loop = false; // Не зацикливаем
            }
            
            // Останавливаем предыдущий звук если играет
            if (!rollSound.paused) {
                rollSound.pause();
                rollSound.currentTime = 0;
            }
            
            // Пытаемся загрузить кастомный звук
            rollSound.oncanplaythrough = () => {
                const playPromise = rollSound.play();
                if (playPromise !== undefined) {
                    playPromise.catch(() => {
                        // Если не удалось, используем сгенерированный звук
                        playGeneratedRouletteSound();
                    });
                }
            };
            
            rollSound.onerror = () => {
                // Если кастомный звук не найден, используем сгенерированный
                playGeneratedRouletteSound();
            };
            
            rollSound.src = 'roulette_sound.mp3';
        }

        // Звук выпадения дропа
        function playDropSound() {
            if (!dropSound) {
                dropSound = new Audio();
                dropSound.volume = 0.6;
            }
            
            // Останавливаем звук рулетки если играет
            if (rollSound && !rollSound.paused) {
                rollSound.pause();
                rollSound.currentTime = 0;
            }
            
            dropSound.oncanplaythrough = () => {
                const playPromise = dropSound.play();
                if (playPromise !== undefined) {
                    playPromise.catch(() => {
                        console.log('🎵 Кастомный звук drop_sound.mp3 не найден');
                    });
                }
            };
            
            dropSound.onerror = () => {
                console.log('🎵 drop_sound.mp3 не найден');
            };
            
            dropSound.src = 'drop_sound.mp3';
        }

        // Fallback generated roulette sound
        function playGeneratedRouletteSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // Звук прокрутки рулетки - нарастающий гул
                oscillator.frequency.setValueAtTime(100, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 3);
                oscillator.frequency.exponentialRampToValueAtTime(150, audioContext.currentTime + 5);
                
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.2, audioContext.currentTime + 1);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 5);
                
                oscillator.type = 'sawtooth';
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 5);
            } catch (e) {
                console.log('Не удалось воспроизвести звук рулетки:', e);
            }
        }

        // 🎵 СИСТЕМА ЗВУКОВ ДЛЯ РЕДКИХ ДРОПОВ
        function playDropSoundByRarity(item) {
            const value = item.value;
            const rarity = item.rarity;
            
            console.log(`🎵 Проверяем звук для дропа: ${item.name} (${rarity}, ${value} ꙮ)`);
            
            // Определяем приоритет звуков:
            // 1. Легендарный дроп (legendary)
            // 2. Очень дорогой дроп (500+ ꙮ)
            // 3. Эпический дроп (epic)
            // 4. Дорогой дроп (200+ ꙮ)
            // 5. Редкий дроп (rare)
            // 6. Обычный звук дропа
            
            if (rarity === 'legendary') {
                playLegendaryDropSound();
            } else if (value >= 500) {
                playExpensiveDropSound();
            } else if (rarity === 'epic') {
                playEpicDropSound();
            } else if (value >= 200) {
                playExpensiveDropSound();
            } else if (rarity === 'rare') {
                playRareDropSound();
            } else {
                playDropSound(); // Обычный звук для common дропов
            }
        }
        
        // 🎵 ЗВУК ДЛЯ РЕДКИХ ДРОПОВ (RARE)
        function playRareDropSound() {
            if (!rareDropSound) {
                rareDropSound = new Audio();
                rareDropSound.volume = 0.7;
            }
            
            // Останавливаем звук рулетки
            if (rollSound && !rollSound.paused) {
                rollSound.pause();
                rollSound.currentTime = 0;
            }
            
            rareDropSound.oncanplaythrough = () => {
                const playPromise = rareDropSound.play();
                if (playPromise !== undefined) {
                    playPromise.catch(() => {
                        console.log('🎵 Кастомный звук rare_drop.mp3 не найден');
                    });
                }
            };
            
            rareDropSound.onerror = () => {
                console.log('🎵 rare_drop.mp3 не найден');
            };
            
            console.log('🎵 Пытаемся загрузить rare_drop.mp3...');
            rareDropSound.src = 'rare_drop.mp3';
        }
        
        // 🎵 ЗВУК ДЛЯ ЭПИЧЕСКИХ ДРОПОВ (EPIC)
        function playEpicDropSound() {
            if (!epicDropSound) {
                epicDropSound = new Audio();
                epicDropSound.volume = 0.8;
            }
            
            // Останавливаем звук рулетки
            if (rollSound && !rollSound.paused) {
                rollSound.pause();
                rollSound.currentTime = 0;
            }
            
            epicDropSound.oncanplaythrough = () => {
                const playPromise = epicDropSound.play();
                if (playPromise !== undefined) {
                    playPromise.catch(() => {
                        console.log('🎵 Кастомный звук epic_drop.mp3 не найден');
                    });
                }
            };
            
            epicDropSound.onerror = () => {
                console.log('🎵 epic_drop.mp3 не найден');
            };
            
            console.log('🎵 Пытаемся загрузить epic_drop.mp3...');
            epicDropSound.src = 'epic_drop.mp3';
        }
        
        // 🎵 ЗВУК ДЛЯ ЛЕГЕНДАРНЫХ ДРОПОВ (LEGENDARY)
        function playLegendaryDropSound() {
            if (!legendaryDropSound) {
                legendaryDropSound = new Audio();
                legendaryDropSound.volume = 0.9;
            }
            
            // Останавливаем звук рулетки
            if (rollSound && !rollSound.paused) {
                rollSound.pause();
                rollSound.currentTime = 0;
            }
            
            legendaryDropSound.oncanplaythrough = () => {
                const playPromise = legendaryDropSound.play();
                if (playPromise !== undefined) {
                    playPromise.catch(() => {
                        console.log('🎵 Кастомный звук legendary_drop.mp3 не найден');
                    });
                }
            };
            
            legendaryDropSound.onerror = () => {
                console.log('🎵 legendary_drop.mp3 не найден');
            };
            
            console.log('🎵 Пытаемся загрузить legendary_drop.mp3...');
            legendaryDropSound.src = 'legendary_drop.mp3';
        }
        
        // 🎵 ЗВУК ДЛЯ ДОРОГИХ ДРОПОВ (200+ ꙮ)
        function playExpensiveDropSound() {
            if (!expensiveDropSound) {
                expensiveDropSound = new Audio();
                expensiveDropSound.volume = 0.75;
            }
            
            // Останавливаем звук рулетки
            if (rollSound && !rollSound.paused) {
                rollSound.pause();
                rollSound.currentTime = 0;
            }
            
            expensiveDropSound.oncanplaythrough = () => {
                const playPromise = expensiveDropSound.play();
                if (playPromise !== undefined) {
                    playPromise.catch(() => {
                        console.log('🎵 Кастомный звук expensive_drop.mp3 не найден');
                    });
                }
            };
            
            expensiveDropSound.onerror = () => {
                console.log('🎵 expensive_drop.mp3 не найден');
            };
            
            console.log('🎵 Пытаемся загрузить expensive_drop.mp3...');
            expensiveDropSound.src = 'expensive_drop.mp3';
        }
        




        // 📊 ФУНКЦИЯ СОЗДАНИЯ ВСПЛЫВАЮЩЕЙ ПОДСКАЗКИ ДЛЯ КЕЙСА
        function createCaseTooltip(caseType, casePrice) {
            const caseItems = items[caseType];
            if (!caseItems) return null;
            
            // Подсчитываем шансы по типам дропов
            let lossChance = 0;
            let breakevenChance = 0;
            let profitChance = 0;
            let jackpotChance = 0;
            
            caseItems.forEach(item => {
                const value = item.value;
                if (value < casePrice) {
                    lossChance += item.chance;
                } else if (value >= casePrice && value < casePrice * 2) {
                    breakevenChance += item.chance;
                } else if (value >= casePrice * 2 && value < casePrice * 5) {
                    profitChance += item.chance;
                } else if (value >= casePrice * 5 || item.rarity === 'legendary') {
                    jackpotChance += item.chance; // LEGENDARY всегда считается джекпотом
                }
            });
            
            const tooltip = document.createElement('div');
            tooltip.className = 'case-tooltip';
            
            const isMobile = window.innerWidth <= 768;
            const fontSize = isMobile ? '9px' : '11px';
            const lineHeight = isMobile ? '1.2' : '1.3';
            
            tooltip.innerHTML = `
                <div style="font-size: ${fontSize}; line-height: ${lineHeight}; text-align: left;">
                    <div style="color: #e74c3c; margin-bottom: 2px;">🔴 Убыточные: <strong>${lossChance.toFixed(1)}%</strong></div>
                    <div style="color: #f1c40f; margin-bottom: 2px;">🟡 Окупаемые: <strong>${breakevenChance.toFixed(1)}%</strong></div>
                    <div style="color: #27ae60; margin-bottom: 2px;">🟢 Прибыльные: <strong>${profitChance.toFixed(1)}%</strong></div>
                    <div style="color: #8e44ad;">💎 Джекпоты: <strong>${jackpotChance.toFixed(1)}%</strong></div>
                </div>
            `;
            
            return tooltip;
        }

        // Add event listeners to cases
        document.querySelectorAll('.case').forEach(caseEl => {
            const caseImageEl = caseEl.querySelector('.case-image');
            const caseNum = caseImageEl.dataset.caseNum;
            const caseType = caseEl.dataset.case;
            const casePrice = parseInt(caseEl.dataset.price);
            
            // 💡 ДОБАВЛЯЕМ ВСПЛЫВАЮЩУЮ ПОДСКАЗКУ К КЕЙСУ
            const tooltip = createCaseTooltip(caseType, casePrice);
            if (tooltip) {
                // Добавляем position: relative к кейсу для правильного позиционирования
                caseEl.style.position = 'relative';
                caseEl.appendChild(tooltip);
            }
            
            // Левый клик - открытие кейса
            caseEl.addEventListener('click', () => {
                const caseType = caseEl.dataset.case;
                const price = parseInt(caseEl.dataset.price);
                
                // 🛡️ ПРОВЕРЯЕМ КУЛДАУН ПЕРЕД ВЫЗОВОМ
                const now = Date.now();
                if (caseCooldowns[caseType] && now - caseCooldowns[caseType] < 2000) {
                    const remainingTime = Math.ceil((2000 - (now - caseCooldowns[caseType])) / 1000);
                    console.log(`⏰ Кейс на кулдауне! Осталось: ${remainingTime}с`);
                    
                    // Визуальная обратная связь
                    caseEl.style.transform = 'scale(0.95)';
                    caseEl.style.opacity = '0.6';
                    setTimeout(() => {
                        caseEl.style.transform = '';
                        caseEl.style.opacity = '';
                    }, 200);
                    return;
                }
                
                // Always allow clicks, handle insufficient funds in openCase
                openCase(caseType, price);
            });
            
            // Правый клик - просмотр дропов
            caseEl.addEventListener('contextmenu', (e) => {
                e.preventDefault(); // Отключаем стандартное контекстное меню
                const caseType = caseEl.dataset.case;
                showCaseDrops(caseType);
            });
            
            // 📱 МОБИЛЬНЫЕ СОБЫТИЯ ДЛЯ ПОДСКАЗОК И ДРОПОВ
            let longPressTimer = null;
            let tooltipTimer = null;
            
            caseEl.addEventListener('touchstart', (e) => {
                // Показываем подсказку через 300ms
                tooltipTimer = setTimeout(() => {
                    if (tooltip) {
                        tooltip.style.opacity = '1';
                        tooltip.style.transform = 'translateX(-50%) translateY(-100%) translateY(-5px)';
                    }
                }, 300);
                
                // Долгое нажатие для подробных дропов через 1200ms
                longPressTimer = setTimeout(() => {
                    const caseType = caseEl.dataset.case;
                    showCaseDrops(caseType);
                    
                    // Вибрация на мобильных устройствах
                    if (navigator.vibrate) {
                        navigator.vibrate(150);
                    }
                    
                    // ИСПРАВЛЕНО: Устанавливаем флаг на элементе, а не на событии
                    caseEl.longPressTriggered = true;
                    console.log('📱 ДОЛГОЕ НАЖАТИЕ СРАБОТАЛО - флаг установлен');
                }, 1200);
            });
            
            caseEl.addEventListener('touchend', (e) => {
                const wasMoved = e.touchMoved || false;
                const wasLongPress = caseEl.longPressTriggered || false;
                
                // Останавливаем таймеры
                if (longPressTimer) {
                    clearTimeout(longPressTimer);
                    longPressTimer = null;
                }
                if (tooltipTimer) {
                    clearTimeout(tooltipTimer);
                    tooltipTimer = null;
                }
                
                // Скрываем подсказку
                if (tooltip) {
                    tooltip.style.opacity = '0';
                    tooltip.style.transform = 'translateX(-50%) translateY(-100%)';
                }
                
                // ВАЖНО: Если это был короткий тап БЕЗ долгого нажатия И без движения - открываем кейс!
                if (!wasLongPress && !wasMoved) {
                    const caseType = caseEl.dataset.case;
                    const price = parseInt(caseEl.dataset.price);
                    
                    console.log('📱 КОРОТКИЙ ТАП - открываем кейс:', caseType);
                    
                    // Небольшая задержка чтобы скрыть подсказку
                    setTimeout(() => {
                        openCase(caseType, price);
                    }, 100);
                } else if (wasLongPress) {
                    console.log('📱 ДОЛГОЕ НАЖАТИЕ - НЕ открываем кейс, только показали дропы');
                }
                
                // Сбрасываем флаги после обработки
                caseEl.longPressTriggered = false;
                e.touchMoved = false;
            });
            
            caseEl.addEventListener('touchmove', (e) => {
                // Отмечаем что было движение
                e.touchMoved = true;
                
                // Сбрасываем флаг долгого нажатия при движении
                caseEl.longPressTriggered = false;
                
                if (longPressTimer) {
                    clearTimeout(longPressTimer);
                    longPressTimer = null;
                }
                if (tooltipTimer) {
                    clearTimeout(tooltipTimer);
                    tooltipTimer = null;
                }
                // Скрываем подсказку при движении
                if (tooltip) {
                    tooltip.style.opacity = '0';
                    tooltip.style.transform = 'translateX(-50%) translateY(-100%)';
                }
            });
            
            // Hover effects
            caseEl.addEventListener('mouseenter', () => {
                const openImg = new Image();
                openImg.onload = () => {
                    caseImageEl.style.backgroundImage = `url('case${caseNum}_open.png')`;
                };
                openImg.onerror = () => {
                    caseImageEl.style.backgroundImage = `url('keys/case${caseNum}_open?prompt=treasure%20chest%20case%20box%20open%20game%20item')`;
                };
                openImg.src = `case${caseNum}_open.png`;
            });
            
            caseEl.addEventListener('mouseleave', () => {
                const closedImg = new Image();
                closedImg.onload = () => {
                    caseImageEl.style.backgroundImage = `url('case${caseNum}_closed.png')`;
                };
                closedImg.onerror = () => {
                    caseImageEl.style.backgroundImage = `url('keys/case${caseNum}_closed?prompt=treasure%20chest%20case%20box%20closed%20game%20item')`;
                };
                closedImg.src = `case${caseNum}_closed.png`;
            });
        });

        // Avatar loading
        function loadAvatar() {
            const avatarEl = document.getElementById('profileAvatar');
            
            if (userAvatar) {
                // Загружаем сохранённый аватар пользователя
                avatarEl.style.backgroundImage = `url('${userAvatar}')`;
                avatarEl.style.backgroundSize = 'cover';
                avatarEl.style.backgroundPosition = 'center';
                avatarEl.textContent = '';
                console.log('✅ Загружен сохранённый аватар пользователя');
            } else {
                // Пытаемся загрузить avatar.png как запасной вариант
                const avatarImg = new Image();
                
                avatarImg.onload = () => {
                    avatarEl.style.backgroundImage = `url('avatar.png')`;
                    avatarEl.style.backgroundSize = 'cover';
                    avatarEl.style.backgroundPosition = 'center';
                    avatarEl.textContent = '';
                    console.log('✅ Загружен avatar.png');
                };
                
                avatarImg.onerror = () => {
                    // Оставляем дефолтный аватар
                    avatarEl.style.backgroundImage = 'none';
                    avatarEl.textContent = '👤';
                    console.log('📷 Используется дефолтный аватар');
                };
                
                avatarImg.src = 'avatar.png';
            }
        }

        // 📱 АДАПТАЦИЯ ПОДСКАЗОК ДЛЯ МОБИЛЬНЫХ
        function adaptHintsForMobile() {
            const isMobile = window.innerWidth <= 768;
            const desktopHint = document.getElementById('desktop-hint');
            const mobileHint = document.getElementById('mobile-hint');
            
            if (isMobile) {
                // Показываем мобильную подсказку
                if (desktopHint) desktopHint.style.display = 'none';
                if (mobileHint) mobileHint.style.display = 'block';
                console.log('📱 Переключено на мобильные подсказки');
            } else {
                // Показываем компьютерную подсказку
                if (desktopHint) desktopHint.style.display = 'block';
                if (mobileHint) mobileHint.style.display = 'none';
                console.log('🖥️ Переключено на компьютерные подсказки');
            }
        }

        // Initialize
        loadGameData();
        updateBalance();
        updateInventory();
        updateDebtStatus();
        initializeCaseImages();
        updateWinglist();
        updateCountdown();
        loadAvatar();
        adaptHintsForMobile();
        
        // Проверяем блокировку при загрузке
        if (isBlocked) {
            showBlockBanner();
        }
        
        // 💡 ВАЖНО: Проверяем нулевой баланс при загрузке страницы
        checkZeroBalance();
        
        // 📱 АДАПТАЦИЯ ПРИ ИЗМЕНЕНИИ РАЗМЕРА ЭКРАНА
        window.addEventListener('resize', () => {
            adaptHintsForMobile();
        });
    </script>
</body>
</html>
